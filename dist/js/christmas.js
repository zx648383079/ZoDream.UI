var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var vendors = ['webkit', 'moz'];
for (var x = 0; x < vendors.length && !window.requestAnimationFrame; ++x) {
    window.requestAnimationFrame = window[vendors[x] + 'RequestAnimationFrame'];
    window.cancelAnimationFrame =
        window[vendors[x] + 'CancelAnimationFrame'] || window[vendors[x] + 'CancelRequestAnimationFrame'];
}
if (!window.requestAnimationFrame || !window.cancelAnimationFrame) {
    var lastTime_1 = 0;
    window.requestAnimationFrame = function (callback) {
        var currTime = new Date().getTime();
        //为了使setTimteout的尽可能的接近每秒60帧的效果
        var timeToCall = Math.max(0, 16 - (currTime - lastTime_1));
        var id = window.setTimeout(function () {
            callback(currTime + timeToCall);
        }, timeToCall);
        lastTime_1 = currTime + timeToCall;
        return id;
    };
    window.cancelAnimationFrame = function (id) {
        window.clearTimeout(id);
    };
}
var Time = /** @class */ (function () {
    function Time(callback, space, time) {
        if (space === void 0) { space = 16; }
        if (time === void 0) { time = 0; }
        this.callback = callback;
        this.space = space;
        this.time = time;
        this._index = 0;
        this.isActive = true;
        this._time = 0;
    }
    Time.prototype.run = function () {
        if (!this.isActive) {
            return;
        }
        this._index += 16;
        if (this._index < this.space) {
            return;
        }
        this.callback();
        this._index = 0;
        this._time++;
        if (this.time > 0 && this._time >= this.time) {
            this.isActive = false;
            return;
        }
    };
    return Time;
}());
var Timer = /** @class */ (function () {
    function Timer(callback, space, time) {
        if (space === void 0) { space = 16; }
        if (time === void 0) { time = 0; }
        this.times = [];
        this.isAuto = true;
        if (callback) {
            this.add(callback, space, time);
        }
        if (this.isAuto) {
            this.start();
        }
    }
    Timer.prototype.add = function (callback, space, time) {
        if (space === void 0) { space = 16; }
        if (time === void 0) { time = 0; }
        this.times.push(new Time(callback, space, time));
        return this;
    };
    Timer.prototype.start = function () {
        this._loop();
    };
    Timer.prototype._loop = function () {
        this.stop();
        var instance = this;
        this._handle = window.requestAnimationFrame(function () {
            var isEnd = true;
            instance.times.forEach(function (time) {
                if (time.isActive) {
                    time.run();
                    isEnd = false;
                }
            });
            if (isEnd && instance.isAuto) {
                instance.stop();
                return;
            }
            instance._loop();
        });
    };
    Timer.prototype.stop = function () {
        if (this._handle) {
            window.cancelAnimationFrame(this._handle);
        }
        this._handle = null;
    };
    return Timer;
}());
var Preloader = /** @class */ (function () {
    function Preloader() {
    }
    Preloader.loadImg = function (name, url, cb) {
        var img = new Image();
        img.src = url;
        img.onload = function () {
            cb && cb();
        };
        Preloader.caches[name] = img;
    };
    /**
     * get<T>
     */
    Preloader.get = function (name) {
        return Preloader.caches[name];
    };
    Preloader.caches = {};
    return Preloader;
}());
var Scene = /** @class */ (function () {
    function Scene() {
        this.fps = 60;
        this.children = [];
    }
    Scene.prototype.setFPS = function (fps) {
        this.fps = fps;
    };
    /**
     * addChild
     */
    Scene.prototype.addChild = function (kid) {
        this.children.push(kid);
        return this;
    };
    /**
     * init
     */
    Scene.prototype.init = function () {
        if (!this.canvas) {
            this.canvas = Storyboard.create(this.stage.canvas);
        }
    };
    Scene.prototype.update = function () {
    };
    Scene.prototype.draw = function (ctx) {
        var _this = this;
        this.canvas.clear();
        this.children.forEach(function (item) {
            item.draw(_this.canvas);
        });
        ctx.draw(this.canvas);
    };
    /**
     * destory
     */
    Scene.prototype.destory = function () {
    };
    return Scene;
}());
var Sprite = /** @class */ (function () {
    function Sprite() {
    }
    Sprite.prototype.draw = function (ctx) {
    };
    return Sprite;
}());
var Stage = /** @class */ (function () {
    /**
     *
     */
    function Stage(element) {
        this.canvas = Storyboard.parse(element);
        this.canvas.fullScreen();
        this.init();
    }
    /**
     * init
     */
    Stage.prototype.init = function () {
        this.loop();
    };
    /**
     * loop
     */
    Stage.prototype.loop = function () {
        this.timer = new Timer(this.update.bind(this));
    };
    /**
     * nevigate
     */
    Stage.prototype.nevigate = function (scene) {
        this.scene && this.scene.destory();
        //this.canvas.clear();
        this.scene = scene;
        this.scene.stage = this;
        this.scene.init();
    };
    /**
     * update
     */
    Stage.prototype.update = function () {
        this.scene.update();
        this.draw();
    };
    /**
     * draw
     */
    Stage.prototype.draw = function () {
        this.canvas.clear();
        this.scene.draw(this.canvas);
    };
    return Stage;
}());
var Storyboard = /** @class */ (function () {
    function Storyboard(canvas) {
        this.canvas = canvas;
        this.context = this.canvas.getContext('2d');
    }
    /**
     * width
     */
    Storyboard.prototype.width = function () {
        return this.canvas.width;
    };
    /**
     * height
     */
    Storyboard.prototype.height = function () {
        return this.canvas.height;
    };
    Storyboard.prototype.clear = function () {
        this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
        return this;
    };
    Storyboard.prototype.draw = function (image, x, y) {
        if (x === void 0) { x = 0; }
        if (y === void 0) { y = 0; }
        var args = [];
        for (var _i = 3; _i < arguments.length; _i++) {
            args[_i - 3] = arguments[_i];
        }
        var img = image instanceof Storyboard ? image.canvas : image;
        if (args.length >= 7) {
            var centerX = (args[2] + args[4]), centerY = (args[3] + args[5]);
            this.context.save();
            this.context.translate(centerX, centerY);
            this.context.rotate(args[6]);
            this.context.drawImage(img, x, y, args[0], args[1], 0, 0, args[4], args[5]);
            this.context.restore();
        }
        else if (args.length == 6) {
            this.context.drawImage(img, x, y, args[0], args[1], args[2], args[3], args[4], args[5]);
        }
        else if (args.length >= 2) {
            this.context.drawImage(img, x, y, args[0], args[1]);
        }
        else {
            this.context.drawImage(img, x, y);
        }
        return true;
    };
    /**
     * fullScreen
     */
    Storyboard.prototype.fullScreen = function () {
        this.canvas.width = window.innerWidth;
        this.canvas.height = window.innerHeight;
        return this;
    };
    Storyboard.create = function (width, height) {
        var canvas = document.createElement("canvas");
        if (typeof width == 'object') {
            canvas.width = width.width();
            canvas.height = width.height();
        }
        else {
            canvas.width = width;
            canvas.height = height;
        }
        return new Storyboard(canvas);
    };
    Storyboard.parse = function (element) {
        return new Storyboard(typeof element == 'string' ? document.getElementById(element) : element);
    };
    return Storyboard;
}());
var MainScene = /** @class */ (function (_super) {
    __extends(MainScene, _super);
    function MainScene() {
        var _this = _super !== null && _super.apply(this, arguments) || this;
        _this._time = 0;
        _this._wind = 0;
        return _this;
    }
    /**
     * init
     */
    MainScene.prototype.init = function () {
        _super.prototype.init.call(this);
        this.createSprite();
    };
    MainScene.prototype.createSprite = function () {
        this._time++;
        if (this._time > 1000000) {
            this._time = 0;
        }
        if (this._time % 40 > 0) {
            return;
        }
        var count = Math.floor(Math.random() * this.canvas.width() / 200);
        if (count < 1) {
            return;
        }
        for (; count > 0; count--) {
            this.addChild(new SnowSprite(this.canvas.width(), this.canvas.height()));
        }
    };
    MainScene.prototype.getWind = function () {
        if (this._time % 200 > 0) {
            return this._wind;
        }
        var old_wind = this._wind;
        this._wind = (Math.random() > .5 ? 1 : -1) * Math.random();
        if (Math.abs(old_wind - this._wind) > 1) {
            this._wind = old_wind > 0 ? old_wind - .1 : old_wind + .1;
        }
        return this._wind;
    };
    MainScene.prototype.update = function () {
        var windSpeed = this.getWind(); //Math.random() < 0.5 ? 0.0005 : -0.0005;
        for (var i = this.children.length - 1; i >= 0; i--) {
            var kid = this.children[i];
            if (kid.isOut()) {
                this.children.splice(i, 1);
                return;
            }
            kid.update(windSpeed);
        }
        this.createSprite();
    };
    return MainScene;
}(Scene));
var MainStage = /** @class */ (function (_super) {
    __extends(MainStage, _super);
    function MainStage(element) {
        return _super.call(this, element) || this;
    }
    /**
     * init
     */
    MainStage.prototype.init = function () {
        var _this = this;
        Preloader.loadImg('snow', 'image/snow.png', function () {
            _this.nevigate(new MainScene());
            _super.prototype.init.call(_this);
        });
    };
    return MainStage;
}(Stage));
var SnowSprite = /** @class */ (function () {
    /**
     *
     */
    function SnowSprite(maxWidth, maxHeight) {
        this.maxWidth = maxWidth;
        this.maxHeight = maxHeight;
        this.x = 0;
        this.y = 0;
        this.kind = 0;
        this.size = 0;
        this.speedX = 0;
        this.speedY = 0;
        this.deg = 0;
        this.image = Preloader.get('snow');
        this.reset();
    }
    /**
     * reset
     */
    SnowSprite.prototype.reset = function () {
        this.x = Math.random() * this.maxWidth;
        this.size = Math.random() * 20 + 10;
        //this.speedX = Math.random() * 2 - 1;
        this.speedY = Math.random() * .8 + .2;
        this.kind = Math.floor(Math.random() * 6);
    };
    SnowSprite.prototype.update = function (windSpeed) {
        var degDelta = (windSpeed > 0 ? 1 : -1) * (Math.random() * 0.6 + 0.2);
        this.speedX = windSpeed * (this.kind * .01 + 1 - this.size / 100);
        this.x += this.speedX;
        this.y += this.speedY;
        this.deg += degDelta;
    };
    /**
     * isOut
     */
    SnowSprite.prototype.isOut = function () {
        return this.x < 0 || this.x > this.maxWidth || this.y > this.maxHeight;
    };
    /**
     * draw
     */
    SnowSprite.prototype.draw = function (ctx) {
        if (this.isOut()) {
            return;
        }
        ctx.draw(this.image, this.kind * 200, 0, 200, 200, this.x, this.y, this.size, this.size, this.deg * Math.PI / 180);
    };
    return SnowSprite;
}());

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInJlcXVlc3RBbmltYXRpb25GcmFtZS50cyIsInRpbWVyLnRzIiwicHJlbG9hZGVyLnRzIiwic2NlbmUudHMiLCJzcHJpdGUudHMiLCJzdGFnZS50cyIsInN0b3J5Ym9hcmQudHMiLCJ6bWFpbi1zY2VuZS50cyIsInptYWluLXN0b2dlLnRzIiwienNub3ctc3ByaXRlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7QUFBQSxJQUFBLE9BQUEsR0FBQSxDQUFBLFFBQUEsRUFBQSxLQUFBLENBQUEsQ0FBQTtBQUNBLEtBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxPQUFBLENBQUEsTUFBQSxJQUFBLENBQUEsTUFBQSxDQUFBLHFCQUFBLEVBQUEsRUFBQSxDQUFBLEVBQUE7SUFDQSxNQUFBLENBQUEscUJBQUEsR0FBQSxNQUFBLENBQUEsT0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLHVCQUFBLENBQUEsQ0FBQTtJQUNBLE1BQUEsQ0FBQSxvQkFBQTtRQUNBLE1BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsc0JBQUEsQ0FBQSxJQUFBLE1BQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsNkJBQUEsQ0FBQSxDQUFBO0NBQ0E7QUFFQSxJQUFBLENBQUEsTUFBQSxDQUFBLHFCQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsb0JBQUEsRUFBQTtJQUNBLElBQUEsVUFBQSxHQUFBLENBQUEsQ0FBQTtJQUNBLE1BQUEsQ0FBQSxxQkFBQSxHQUFBLFVBQUEsUUFBQTtRQUNBLElBQUEsUUFBQSxHQUFBLElBQUEsSUFBQSxFQUFBLENBQUEsT0FBQSxFQUFBLENBQUE7UUFDQSwrQkFBQTtRQUNBLElBQUEsVUFBQSxHQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxFQUFBLEVBQUEsR0FBQSxDQUFBLFFBQUEsR0FBQSxVQUFBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxFQUFBLEdBQUEsTUFBQSxDQUFBLFVBQUEsQ0FBQTtZQUNBLFFBQUEsQ0FBQSxRQUFBLEdBQUEsVUFBQSxDQUFBLENBQUE7UUFDQSxDQUFBLEVBQUEsVUFBQSxDQUFBLENBQUE7UUFDQSxVQUFBLEdBQUEsUUFBQSxHQUFBLFVBQUEsQ0FBQTtRQUNBLE9BQUEsRUFBQSxDQUFBO0lBQ0EsQ0FBQSxDQUFBO0lBRUEsTUFBQSxDQUFBLG9CQUFBLEdBQUEsVUFBQSxFQUFBO1FBQ0EsTUFBQSxDQUFBLFlBQUEsQ0FBQSxFQUFBLENBQUEsQ0FBQTtJQUNBLENBQUEsQ0FBQTtDQUNBO0FDdkJBO0lBQ0EsY0FDQSxRQUFBLEVBQ0EsS0FBQSxFQUNBLElBQUE7UUFEQSxzQkFBQSxFQUFBLFVBQUE7UUFDQSxxQkFBQSxFQUFBLFFBQUE7UUFGQSxhQUFBLEdBQUEsUUFBQSxDQUFBO1FBQ0EsVUFBQSxHQUFBLEtBQUEsQ0FBQTtRQUNBLFNBQUEsR0FBQSxJQUFBLENBQUE7UUFLQSxXQUFBLEdBQUEsQ0FBQSxDQUFBO1FBRUEsYUFBQSxHQUFBLElBQUEsQ0FBQTtRQUVBLFVBQUEsR0FBQSxDQUFBLENBQUE7SUFOQSxDQUFBO0lBUUEsa0JBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxFQUFBO1lBQ0EsT0FBQTtTQUNBO1FBQ0EsSUFBQSxDQUFBLE1BQUEsSUFBQSxFQUFBLENBQUE7UUFDQSxJQUFBLElBQUEsQ0FBQSxNQUFBLEdBQUEsSUFBQSxDQUFBLEtBQUEsRUFBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxNQUFBLEdBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsSUFBQSxHQUFBLENBQUEsSUFBQSxJQUFBLENBQUEsS0FBQSxJQUFBLElBQUEsQ0FBQSxJQUFBLEVBQUE7WUFDQSxJQUFBLENBQUEsUUFBQSxHQUFBLEtBQUEsQ0FBQTtZQUNBLE9BQUE7U0FDQTtJQUNBLENBQUE7SUFDQSxXQUFBO0FBQUEsQ0EvQkEsQUErQkEsSUFBQTtBQUVBO0lBQ0EsZUFDQSxRQUFBLEVBQ0EsS0FBQSxFQUNBLElBQUE7UUFEQSxzQkFBQSxFQUFBLFVBQUE7UUFDQSxxQkFBQSxFQUFBLFFBQUE7UUFVQSxVQUFBLEdBQUEsRUFBQSxDQUFBO1FBRUEsV0FBQSxHQUFBLElBQUEsQ0FBQTtRQVZBLElBQUEsUUFBQSxFQUFBO1lBQ0EsSUFBQSxDQUFBLEdBQUEsQ0FBQSxRQUFBLEVBQUEsS0FBQSxFQUFBLElBQUEsQ0FBQSxDQUFBO1NBQ0E7UUFDQSxJQUFBLElBQUEsQ0FBQSxNQUFBLEVBQUE7WUFDQSxJQUFBLENBQUEsS0FBQSxFQUFBLENBQUE7U0FDQTtJQUNBLENBQUE7SUFNQSxtQkFBQSxHQUFBLFVBQUEsUUFBQSxFQUFBLEtBQUEsRUFBQSxJQUFBO1FBQUEsc0JBQUEsRUFBQSxVQUFBO1FBQUEscUJBQUEsRUFBQSxRQUFBO1FBQ0EsSUFBQSxDQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxJQUFBLENBQUEsUUFBQSxFQUFBLEtBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsT0FBQSxJQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEscUJBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQSxxQkFBQSxHQUFBO1FBQ0EsSUFBQSxDQUFBLElBQUEsRUFBQSxDQUFBO1FBQ0EsSUFBQSxRQUFBLEdBQUEsSUFBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLE9BQUEsR0FBQSxNQUFBLENBQUEscUJBQUEsQ0FBQTtZQUNBLElBQUEsS0FBQSxHQUFBLElBQUEsQ0FBQTtZQUNBLFFBQUEsQ0FBQSxLQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLElBQUEsQ0FBQSxRQUFBLEVBQUE7b0JBQ0EsSUFBQSxDQUFBLEdBQUEsRUFBQSxDQUFBO29CQUNBLEtBQUEsR0FBQSxLQUFBLENBQUE7aUJBQ0E7WUFDQSxDQUFBLENBQUEsQ0FBQTtZQUVBLElBQUEsS0FBQSxJQUFBLFFBQUEsQ0FBQSxNQUFBLEVBQUE7Z0JBQ0EsUUFBQSxDQUFBLElBQUEsRUFBQSxDQUFBO2dCQUNBLE9BQUE7YUFDQTtZQUNBLFFBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUlBLG9CQUFBLEdBQUE7UUFDQSxJQUFBLElBQUEsQ0FBQSxPQUFBLEVBQUE7WUFDQSxNQUFBLENBQUEsb0JBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsQ0FBQSxPQUFBLEdBQUEsSUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUNBLFlBQUE7QUFBQSxDQXZEQSxBQXVEQSxJQUFBO0FDeEZBO0lBQUE7SUFvQkEsQ0FBQTtJQWpCQSxpQkFBQSxHQUFBLFVBQUEsSUFBQSxFQUFBLEdBQUEsRUFBQSxFQUFBO1FBQ0EsSUFBQSxHQUFBLEdBQUEsSUFBQSxLQUFBLEVBQUEsQ0FBQTtRQUNBLEdBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBO1FBQ0EsR0FBQSxDQUFBLE1BQUEsR0FBQTtZQUNBLEVBQUEsSUFBQSxFQUFBLEVBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQTtRQUNBLFNBQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsR0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBOztPQUVBO0lBQ0EsYUFBQSxHQUFBLFVBQUEsSUFBQTtRQUNBLE9BQUEsU0FBQSxDQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtJQUNBLENBQUE7SUFoQkEsZ0JBQUEsR0FBQSxFQUFBLENBQUE7SUFtQkEsZ0JBQUE7Q0FwQkEsQUFvQkEsSUFBQTtBQ3BCQTtJQUFBO1FBRUEsUUFBQSxHQUFBLEVBQUEsQ0FBQTtRQUlBLGFBQUEsR0FBQSxFQUFBLENBQUE7SUE0Q0EsQ0FBQTtJQXhDQSxzQkFBQSxHQUFBLFVBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBOztPQUVBO0lBQ0Esd0JBQUEsR0FBQSxVQUFBLEdBQUE7UUFDQSxJQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBOztPQUVBO0lBQ0Esb0JBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxFQUFBO1lBQ0EsSUFBQSxDQUFBLE1BQUEsR0FBQSxVQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7U0FDQTtJQUNBLENBQUE7SUFFQSxzQkFBQSxHQUFBO0lBRUEsQ0FBQTtJQUVBLG9CQUFBLEdBQUEsVUFBQSxHQUFBO1FBQUEsaUJBTUE7UUFMQSxJQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLFFBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxJQUFBO1lBQ0EsSUFBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7UUFDQSxDQUFBLENBQUEsQ0FBQTtRQUNBLEdBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUdBOztPQUVBO0lBQ0EsdUJBQUEsR0FBQTtJQUVBLENBQUE7SUFDQSxZQUFBO0FBQUEsQ0FsREEsQUFrREEsSUFBQTtBQzlDQTtJQUFBO0lBS0EsQ0FBQTtJQUhBLHFCQUFBLEdBQUEsVUFBQSxHQUFBO0lBRUEsQ0FBQTtJQUNBLGFBQUE7QUFBQSxDQUxBLEFBS0EsSUFBQTtBQ1RBO0lBQ0E7O09BRUE7SUFDQSxlQUNBLE9BQUE7UUFFQSxJQUFBLENBQUEsTUFBQSxHQUFBLFVBQUEsQ0FBQSxLQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsTUFBQSxDQUFBLFVBQUEsRUFBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLElBQUEsRUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQVFBOztPQUVBO0lBQ0Esb0JBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQTs7T0FFQTtJQUNBLG9CQUFBLEdBQUE7UUFDQSxJQUFBLENBQUEsS0FBQSxHQUFBLElBQUEsS0FBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUE7O09BRUE7SUFDQSx3QkFBQSxHQUFBLFVBQUEsS0FBQTtRQUNBLElBQUEsQ0FBQSxLQUFBLElBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxPQUFBLEVBQUEsQ0FBQTtRQUNBLHNCQUFBO1FBQ0EsSUFBQSxDQUFBLEtBQUEsR0FBQSxLQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsS0FBQSxDQUFBLEtBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsS0FBQSxDQUFBLElBQUEsRUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBOztPQUVBO0lBQ0Esc0JBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxLQUFBLENBQUEsTUFBQSxFQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsSUFBQSxFQUFBLENBQUE7SUFDQSxDQUFBO0lBRUE7O09BRUE7SUFDQSxvQkFBQSxHQUFBO1FBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxLQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtJQUNBLENBQUE7SUFDQSxZQUFBO0FBQUEsQ0ExREEsQUEwREEsSUFBQTtBQzFEQTtJQUVBLG9CQUNBLE1BQUE7UUFBQSxXQUFBLEdBQUEsTUFBQSxDQUFBO1FBRUEsSUFBQSxDQUFBLE9BQUEsR0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBLFVBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtJQUNBLENBQUE7SUFJQTs7T0FFQTtJQUNBLDBCQUFBLEdBQUE7UUFDQSxPQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsS0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBOztPQUVBO0lBQ0EsMkJBQUEsR0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsMEJBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxLQUFBLEVBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLHlCQUFBLEdBQUEsVUFBQSxLQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUE7UUFBQSxrQkFBQSxFQUFBLEtBQUE7UUFBQSxrQkFBQSxFQUFBLEtBQUE7UUFBQSxjQUFBO2FBQUEsVUFBQSxFQUFBLHFCQUFBLEVBQUEsSUFBQTtZQUFBLDZCQUFBOztRQUNBLElBQUEsR0FBQSxHQUFBLEtBQUEsWUFBQSxVQUFBLENBQUEsQ0FBQSxDQUFBLEtBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQSxDQUFBLEtBQUEsQ0FBQTtRQUNBLElBQUEsSUFBQSxDQUFBLE1BQUEsSUFBQSxDQUFBLEVBQUE7WUFDQSxJQUFBLE9BQUEsR0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxPQUFBLEdBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7WUFDQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsT0FBQSxFQUFBLE9BQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE9BQUEsQ0FBQSxNQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7WUFDQSxJQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLEVBQUEsQ0FBQTtTQUNBO2FBQUEsSUFBQSxJQUFBLENBQUEsTUFBQSxJQUFBLENBQUEsRUFBQTtZQUNBLElBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQSxDQUFBLEdBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7U0FDQTthQUFBLElBQUEsSUFBQSxDQUFBLE1BQUEsSUFBQSxDQUFBLEVBQUE7WUFDQSxJQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7U0FDQTthQUFBO1lBQ0EsSUFBQSxDQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsR0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLENBQUEsQ0FBQTtTQUNBO1FBQ0EsT0FBQSxJQUFBLENBQUE7SUFDQSxDQUFBO0lBRUE7O09BRUE7SUFDQSwrQkFBQSxHQUFBO1FBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxLQUFBLEdBQUEsTUFBQSxDQUFBLFVBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsTUFBQSxHQUFBLE1BQUEsQ0FBQSxXQUFBLENBQUE7UUFDQSxPQUFBLElBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQSxpQkFBQSxHQUFBLFVBQUEsS0FBQSxFQUFBLE1BQUE7UUFDQSxJQUFBLE1BQUEsR0FBQSxRQUFBLENBQUEsYUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxPQUFBLEtBQUEsSUFBQSxRQUFBLEVBQUE7WUFDQSxNQUFBLENBQUEsS0FBQSxHQUFBLEtBQUEsQ0FBQSxLQUFBLEVBQUEsQ0FBQTtZQUNBLE1BQUEsQ0FBQSxNQUFBLEdBQUEsS0FBQSxDQUFBLE1BQUEsRUFBQSxDQUFBO1NBQ0E7YUFBQTtZQUNBLE1BQUEsQ0FBQSxLQUFBLEdBQUEsS0FBQSxDQUFBO1lBQ0EsTUFBQSxDQUFBLE1BQUEsR0FBQSxNQUFBLENBQUE7U0FDQTtRQUNBLE9BQUEsSUFBQSxVQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsZ0JBQUEsR0FBQSxVQUFBLE9BQUE7UUFDQSxPQUFBLElBQUEsVUFBQSxDQUFBLE9BQUEsT0FBQSxJQUFBLFFBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxDQUFBLGNBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBQ0EsaUJBQUE7QUFBQSxDQXhFQSxBQXdFQSxJQUFBO0FDbEVBO0lBQUEsNkJBQUE7SUFBQTtRQUFBLHFFQXNEQTtRQTVDQSxXQUFBLEdBQUEsQ0FBQSxDQUFBO1FBQ0EsV0FBQSxHQUFBLENBQUEsQ0FBQTs7SUEyQ0EsQ0FBQTtJQXBEQTs7T0FFQTtJQUNBLHdCQUFBLEdBQUE7UUFDQSxpQkFBQSxJQUFBLFdBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTtJQUNBLENBQUE7SUFLQSxnQ0FBQSxHQUFBO1FBQ0EsSUFBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsS0FBQSxHQUFBLE9BQUEsRUFBQTtZQUNBLElBQUEsQ0FBQSxLQUFBLEdBQUEsQ0FBQSxDQUFBO1NBQ0E7UUFDQSxJQUFBLElBQUEsQ0FBQSxLQUFBLEdBQUEsRUFBQSxHQUFBLENBQUEsRUFBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsS0FBQSxHQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQSxHQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsS0FBQSxFQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLEtBQUEsR0FBQSxDQUFBLEVBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxPQUFBLEtBQUEsR0FBQSxDQUFBLEVBQUEsS0FBQSxFQUFBLEVBQUE7WUFDQSxJQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsVUFBQSxDQUFBLElBQUEsQ0FBQSxNQUFBLENBQUEsS0FBQSxFQUFBLEVBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQSxDQUFBLENBQUE7U0FDQTtJQUNBLENBQUE7SUFFQSwyQkFBQSxHQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsS0FBQSxHQUFBLEdBQUEsR0FBQSxDQUFBLEVBQUE7WUFDQSxPQUFBLElBQUEsQ0FBQSxLQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsUUFBQSxHQUFBLElBQUEsQ0FBQSxLQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsS0FBQSxHQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQSxHQUFBLEVBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLElBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQTtRQUNBLElBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQTtZQUNBLElBQUEsQ0FBQSxLQUFBLEdBQUEsUUFBQSxHQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxHQUFBLEVBQUEsQ0FBQSxDQUFBLENBQUEsUUFBQSxHQUFBLEVBQUEsQ0FBQTtTQUNBO1FBQ0EsT0FBQSxJQUFBLENBQUEsS0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLDBCQUFBLEdBQUE7UUFDQSxJQUFBLFNBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxFQUFBLENBQUEsQ0FBQSx5Q0FBQTtRQUNBLEtBQUEsSUFBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsSUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLEVBQUE7WUFDQSxJQUFBLEdBQUEsR0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxHQUFBLENBQUEsS0FBQSxFQUFBLEVBQUE7Z0JBQ0EsSUFBQSxDQUFBLFFBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsQ0FBQSxDQUFBO2dCQUNBLE9BQUE7YUFDQTtZQUNBLEdBQUEsQ0FBQSxNQUFBLENBQUEsU0FBQSxDQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsQ0FBQSxZQUFBLEVBQUEsQ0FBQTtJQUNBLENBQUE7SUFDQSxnQkFBQTtBQUFBLENBdERBLEFBc0RBLENBdERBLEtBQUEsR0FzREE7QUM1REE7SUFBQSw2QkFBQTtJQUVBLG1CQUNBLE9BQUE7ZUFFQSxrQkFBQSxPQUFBLENBQUE7SUFDQSxDQUFBO0lBRUE7O09BRUE7SUFDQSx3QkFBQSxHQUFBO1FBQUEsaUJBTUE7UUFMQSxTQUFBLENBQUEsT0FBQSxDQUFBLE1BQUEsRUFBQSxnQkFBQSxFQUFBO1lBQ0EsS0FBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLFNBQUEsRUFBQSxDQUFBLENBQUE7WUFDQSxpQkFBQSxJQUFBLFlBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQSxDQUFBO0lBRUEsQ0FBQTtJQUNBLGdCQUFBO0FBQUEsQ0FsQkEsQUFrQkEsQ0FsQkEsS0FBQSxHQWtCQTtBQ2xCQTtJQUVBOztPQUVBO0lBQ0Esb0JBQ0EsUUFBQSxFQUNBLFNBQUE7UUFEQSxhQUFBLEdBQUEsUUFBQSxDQUFBO1FBQ0EsY0FBQSxHQUFBLFNBQUEsQ0FBQTtRQU1BLE1BQUEsR0FBQSxDQUFBLENBQUE7UUFDQSxNQUFBLEdBQUEsQ0FBQSxDQUFBO1FBQ0EsU0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLFNBQUEsR0FBQSxDQUFBLENBQUE7UUFDQSxXQUFBLEdBQUEsQ0FBQSxDQUFBO1FBQ0EsV0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLFFBQUEsR0FBQSxDQUFBLENBQUE7UUFWQSxJQUFBLENBQUEsS0FBQSxHQUFBLFNBQUEsQ0FBQSxHQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsS0FBQSxFQUFBLENBQUE7SUFDQSxDQUFBO0lBV0E7O09BRUE7SUFDQSwwQkFBQSxHQUFBO1FBQ0EsSUFBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsTUFBQSxFQUFBLEdBQUEsSUFBQSxDQUFBLFFBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxJQUFBLEdBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLENBQUE7UUFDQSxzQ0FBQTtRQUNBLElBQUEsQ0FBQSxNQUFBLEdBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQSxHQUFBLEVBQUEsR0FBQSxFQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsSUFBQSxHQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQSxHQUFBLENBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLDJCQUFBLEdBQUEsVUFBQSxTQUFBO1FBQ0EsSUFBQSxRQUFBLEdBQUEsQ0FBQSxTQUFBLEdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxJQUFBLENBQUEsTUFBQSxFQUFBLEdBQUEsR0FBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLE1BQUEsR0FBQSxTQUFBLEdBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxHQUFBLEdBQUEsR0FBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLElBQUEsR0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxDQUFBLElBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxDQUFBLElBQUEsSUFBQSxDQUFBLE1BQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxHQUFBLElBQUEsUUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBOztPQUVBO0lBQ0EsMEJBQUEsR0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBLENBQUEsR0FBQSxDQUFBLElBQUEsSUFBQSxDQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsUUFBQSxJQUFBLElBQUEsQ0FBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLFNBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQTs7T0FFQTtJQUNBLHlCQUFBLEdBQUEsVUFBQSxHQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsS0FBQSxFQUFBLEVBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxHQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLEVBQUEsSUFBQSxDQUFBLElBQUEsR0FBQSxHQUFBLEVBQUEsQ0FBQSxFQUFBLEdBQUEsRUFBQSxHQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxFQUFBLElBQUEsQ0FBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsR0FBQSxHQUFBLElBQUEsQ0FBQSxFQUFBLEdBQUEsR0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBQ0EsaUJBQUE7QUFBQSxDQXpEQSxBQXlEQSxJQUFBIiwiZmlsZSI6ImNocmlzdG1hcy5qcyIsInNvdXJjZXNDb250ZW50IjpbImNvbnN0IHZlbmRvcnM6IEFycmF5PHN0cmluZz4gPSBbJ3dlYmtpdCcsICdtb3onXTtcclxuZm9yKGxldCB4ID0gMDsgeCA8IHZlbmRvcnMubGVuZ3RoICYmICF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lOyArK3gpIHtcclxuICAgIHdpbmRvdy5yZXF1ZXN0QW5pbWF0aW9uRnJhbWUgPSB3aW5kb3dbdmVuZG9yc1t4XSsnUmVxdWVzdEFuaW1hdGlvbkZyYW1lJ107XHJcbiAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPVxyXG4gICAgICAgIHdpbmRvd1t2ZW5kb3JzW3hdKydDYW5jZWxBbmltYXRpb25GcmFtZSddIHx8IHdpbmRvd1t2ZW5kb3JzW3hdKydDYW5jZWxSZXF1ZXN0QW5pbWF0aW9uRnJhbWUnXTtcclxufVxyXG5cclxuaWYgKCF3aW5kb3cucmVxdWVzdEFuaW1hdGlvbkZyYW1lIHx8ICF3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgKSB7XHJcbiAgICBsZXQgbGFzdFRpbWUgPSAwO1xyXG4gICAgd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZSA9IGZ1bmN0aW9uKGNhbGxiYWNrKTogbnVtYmVyIHtcclxuICAgICAgbGV0IGN1cnJUaW1lOiBudW1iZXIgPSBuZXcgRGF0ZSgpLmdldFRpbWUoKTtcclxuICAgICAgLy/kuLrkuobkvb9zZXRUaW10ZW91dOeahOWwveWPr+iDveeahOaOpei/keavj+enkjYw5bin55qE5pWI5p6cXHJcbiAgICAgIGxldCB0aW1lVG9DYWxsOiBudW1iZXIgPSBNYXRoLm1heCggMCwgMTYgLSAoIGN1cnJUaW1lIC0gbGFzdFRpbWUgKSApOyBcclxuICAgICAgbGV0IGlkOiBudW1iZXIgPSB3aW5kb3cuc2V0VGltZW91dCggZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgY2FsbGJhY2soIGN1cnJUaW1lICsgdGltZVRvQ2FsbCApO1xyXG4gICAgICB9LCB0aW1lVG9DYWxsICk7XHJcbiAgICAgIGxhc3RUaW1lID0gY3VyclRpbWUgKyB0aW1lVG9DYWxsO1xyXG4gICAgICByZXR1cm4gaWQ7XHJcbiAgICB9O1xyXG4gICAgXHJcbiAgICB3aW5kb3cuY2FuY2VsQW5pbWF0aW9uRnJhbWUgPSBmdW5jdGlvbihpZCkge1xyXG4gICAgICB3aW5kb3cuY2xlYXJUaW1lb3V0KGlkKTtcclxuICAgIH07XHJcbn0iLCJjbGFzcyBUaW1lIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBjYWxsYmFjazogRnVuY3Rpb24sXHJcbiAgICAgICAgcHVibGljIHNwYWNlOiBudW1iZXIgPSAxNixcclxuICAgICAgICBwdWJsaWMgdGltZTogbnVtYmVyID0gMFxyXG4gICAgKSB7XHJcblxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2luZGV4OiBudW1iZXIgPSAwO1xyXG5cclxuICAgIHB1YmxpYyBpc0FjdGl2ZTogYm9vbGVhbiA9IHRydWU7XHJcblxyXG4gICAgcHJpdmF0ZSBfdGltZTogbnVtYmVyID0gMDtcclxuXHJcbiAgICBwdWJsaWMgcnVuKCkge1xyXG4gICAgICAgIGlmICghdGhpcy5pc0FjdGl2ZSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2luZGV4ICs9IDE2O1xyXG4gICAgICAgIGlmICh0aGlzLl9pbmRleCA8IHRoaXMuc3BhY2UpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICB0aGlzLmNhbGxiYWNrKCk7XHJcbiAgICAgICAgdGhpcy5faW5kZXggPSAwO1xyXG4gICAgICAgIHRoaXMuX3RpbWUgKys7XHJcbiAgICAgICAgaWYgKHRoaXMudGltZSA+IDAgJiYgdGhpcy5fdGltZSA+PSB0aGlzLnRpbWUpIHtcclxuICAgICAgICAgICAgdGhpcy5pc0FjdGl2ZSA9IGZhbHNlO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5jbGFzcyBUaW1lciB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBjYWxsYmFjaz86IEZ1bmN0aW9uLFxyXG4gICAgICAgIHNwYWNlOiBudW1iZXIgPSAxNixcclxuICAgICAgICB0aW1lOiBudW1iZXIgPSAwXHJcbiAgICApIHtcclxuICAgICAgICBpZiAoY2FsbGJhY2spIHtcclxuICAgICAgICAgICAgdGhpcy5hZGQoY2FsbGJhY2ssIHNwYWNlLCB0aW1lKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuaXNBdXRvKSB7XHJcbiAgICAgICAgICAgIHRoaXMuc3RhcnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRpbWVzOiBBcnJheTxUaW1lPiA9IFtdO1xyXG5cclxuICAgIHB1YmxpYyBpc0F1dG86IGJvb2xlYW4gPSB0cnVlO1xyXG5cclxuICAgIHB1YmxpYyBhZGQoY2FsbGJhY2s6IEZ1bmN0aW9uLCBzcGFjZTogbnVtYmVyID0gMTYsIHRpbWU6IG51bWJlciA9IDApIHtcclxuICAgICAgICB0aGlzLnRpbWVzLnB1c2gobmV3IFRpbWUoY2FsbGJhY2ssIHNwYWNlLCB0aW1lKSk7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0KCkge1xyXG4gICAgICAgIHRoaXMuX2xvb3AoKTtcclxuICAgIH1cclxuXHJcbiAgICBwcml2YXRlIF9sb29wKCkge1xyXG4gICAgICAgIHRoaXMuc3RvcCgpO1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5faGFuZGxlID0gd2luZG93LnJlcXVlc3RBbmltYXRpb25GcmFtZShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgbGV0IGlzRW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgaW5zdGFuY2UudGltZXMuZm9yRWFjaCh0aW1lID0+IHtcclxuICAgICAgICAgICAgICAgIGlmICh0aW1lLmlzQWN0aXZlKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGltZS5ydW4oKTtcclxuICAgICAgICAgICAgICAgICAgICBpc0VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgICAgIGlmIChpc0VuZCAmJiBpbnN0YW5jZS5pc0F1dG8pIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLnN0b3AoKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpbnN0YW5jZS5fbG9vcCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2hhbmRsZTogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBzdG9wKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9oYW5kbGUpIHtcclxuICAgICAgICAgICAgd2luZG93LmNhbmNlbEFuaW1hdGlvbkZyYW1lKHRoaXMuX2hhbmRsZSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2hhbmRsZSA9IG51bGw7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBQcmVsb2FkZXIge1xyXG4gICAgcHJpdmF0ZSBzdGF0aWMgY2FjaGVzOiB7W25hbWU6IHN0cmluZ106IGFueX0gPSB7fTtcclxuXHJcbiAgICBwdWJsaWMgc3RhdGljIGxvYWRJbWcobmFtZTogc3RyaW5nLCB1cmw6IHN0cmluZywgY2I/OiBGdW5jdGlvbikge1xyXG4gICAgICAgIGxldCBpbWcgPSBuZXcgSW1hZ2UoKTtcclxuICAgICAgICBpbWcuc3JjID0gdXJsO1xyXG4gICAgICAgIGltZy5vbmxvYWQgPSAoKSA9PiB7XHJcbiAgICAgICAgICAgIGNiICYmIGNiKCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIFByZWxvYWRlci5jYWNoZXNbbmFtZV0gPSBpbWc7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBnZXQ8VD5cclxuICAgICAqL1xyXG4gICAgcHVibGljIHN0YXRpYyBnZXQ8VD4obmFtZTogc3RyaW5nKTogVCB7XHJcbiAgICAgICAgcmV0dXJuIFByZWxvYWRlci5jYWNoZXNbbmFtZV07XHJcbiAgICB9XHJcblxyXG5cclxufSIsImNsYXNzIFNjZW5lIGltcGxlbWVudHMgSUNhbkRyYXcge1xyXG5cclxuICAgIHByaXZhdGUgZnBzID0gNjA7XHJcblxyXG4gICAgcHVibGljIHN0YWdlOiBTdGFnZTtcclxuXHJcbiAgICBwdWJsaWMgY2hpbGRyZW46IFNwcml0ZVtdID0gW107XHJcblxyXG4gICAgcHVibGljIGNhbnZhczogU3Rvcnlib2FyZDtcclxuXHJcbiAgICBwdWJsaWMgc2V0RlBTKGZwczogbnVtYmVyKSB7XHJcbiAgICAgICAgdGhpcy5mcHMgPSBmcHM7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBhZGRDaGlsZFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgYWRkQ2hpbGQoa2lkOiBTcHJpdGUpIHtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLnB1c2goa2lkKTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGluaXRcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmNhbnZhcykge1xyXG4gICAgICAgICAgICB0aGlzLmNhbnZhcyA9IFN0b3J5Ym9hcmQuY3JlYXRlKHRoaXMuc3RhZ2UuY2FudmFzKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwZGF0ZSgpIHtcclxuXHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGRyYXcoY3R4OiBTdG9yeWJvYXJkKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuY2xlYXIoKTtcclxuICAgICAgICB0aGlzLmNoaWxkcmVuLmZvckVhY2goaXRlbSA9PiB7XHJcbiAgICAgICAgICAgIGl0ZW0uZHJhdyh0aGlzLmNhbnZhcyk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgY3R4LmRyYXcodGhpcy5jYW52YXMpO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICAvKipcclxuICAgICAqIGRlc3RvcnlcclxuICAgICAqL1xyXG4gICAgcHVibGljIGRlc3RvcnkoKSB7XHJcbiAgICAgICAgXHJcbiAgICB9XHJcbn0iLCJpbnRlcmZhY2UgSUNhbkRyYXcge1xyXG5cclxuICAgIGRyYXcoY3R4OiBTdG9yeWJvYXJkKTtcclxufVxyXG5hYnN0cmFjdCBjbGFzcyBTcHJpdGUgaW1wbGVtZW50cyBJQ2FuRHJhdyB7XHJcblxyXG4gICAgZHJhdyhjdHg6IFN0b3J5Ym9hcmQpIHtcclxuICAgICAgICBcclxuICAgIH1cclxufSIsImNsYXNzIFN0YWdlIHtcclxuICAgIC8qKlxyXG4gICAgICpcclxuICAgICAqL1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgZWxlbWVudDogSFRNTENhbnZhc0VsZW1lbnR8c3RyaW5nXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmNhbnZhcyA9IFN0b3J5Ym9hcmQucGFyc2UoZWxlbWVudCk7XHJcbiAgICAgICAgdGhpcy5jYW52YXMuZnVsbFNjcmVlbigpO1xyXG4gICAgICAgIHRoaXMuaW5pdCgpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjYW52YXM6IFN0b3J5Ym9hcmQ7XHJcblxyXG4gICAgcHVibGljIHNjZW5lOiBTY2VuZTtcclxuXHJcbiAgICBwdWJsaWMgdGltZXI6IFRpbWVyO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogaW5pdFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaW5pdCgpIHtcclxuICAgICAgICB0aGlzLmxvb3AoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGxvb3BcclxuICAgICAqL1xyXG4gICAgcHVibGljIGxvb3AoKSB7XHJcbiAgICAgICAgdGhpcy50aW1lciA9IG5ldyBUaW1lcih0aGlzLnVwZGF0ZS5iaW5kKHRoaXMpKVxyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogbmV2aWdhdGVcclxuICAgICAqL1xyXG4gICAgcHVibGljIG5ldmlnYXRlKHNjZW5lOiBTY2VuZSkge1xyXG4gICAgICAgIHRoaXMuc2NlbmUgJiYgdGhpcy5zY2VuZS5kZXN0b3J5KCk7XHJcbiAgICAgICAgLy90aGlzLmNhbnZhcy5jbGVhcigpO1xyXG4gICAgICAgIHRoaXMuc2NlbmUgPSBzY2VuZTtcclxuICAgICAgICB0aGlzLnNjZW5lLnN0YWdlID0gdGhpcztcclxuICAgICAgICB0aGlzLnNjZW5lLmluaXQoKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIHVwZGF0ZVxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgdXBkYXRlKCkge1xyXG4gICAgICAgIHRoaXMuc2NlbmUudXBkYXRlKCk7XHJcbiAgICAgICAgdGhpcy5kcmF3KCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBkcmF3XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBkcmF3KCkge1xyXG4gICAgICAgIHRoaXMuY2FudmFzLmNsZWFyKCk7XHJcbiAgICAgICAgdGhpcy5zY2VuZS5kcmF3KHRoaXMuY2FudmFzKTtcclxuICAgIH1cclxufSIsImNsYXNzIFN0b3J5Ym9hcmQge1xyXG5cclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBjYW52YXM6IEhUTUxDYW52YXNFbGVtZW50XHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmNvbnRleHQgPSB0aGlzLmNhbnZhcy5nZXRDb250ZXh0KCcyZCcpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBjb250ZXh0OiBDYW52YXNSZW5kZXJpbmdDb250ZXh0MkQ7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiB3aWR0aFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgd2lkdGgoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLndpZHRoO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICogaGVpZ2h0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBoZWlnaHQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMuY2FudmFzLmhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgY2xlYXIoKSB7XHJcbiAgICAgICAgdGhpcy5jb250ZXh0LmNsZWFyUmVjdCgwLCAwLCB0aGlzLmNhbnZhcy53aWR0aCwgdGhpcy5jYW52YXMuaGVpZ2h0KTtcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZHJhdyhpbWFnZTogSFRNTEltYWdlRWxlbWVudHxTdG9yeWJvYXJkfEhUTUxDYW52YXNFbGVtZW50LCB4OiBudW1iZXIgPSAwLCB5OiBudW1iZXIgPSAwLCAuLi5hcmdzOiBudW1iZXJbXSk6IGJvb2xlYW4ge1xyXG4gICAgICAgIGNvbnN0IGltZyA9IGltYWdlIGluc3RhbmNlb2YgU3Rvcnlib2FyZCA/IGltYWdlLmNhbnZhcyA6IGltYWdlO1xyXG4gICAgICAgIGlmIChhcmdzLmxlbmd0aCA+PSA3KSB7XHJcbiAgICAgICAgICAgIGxldCBjZW50ZXJYID0gKGFyZ3NbMl0gKyBhcmdzWzRdKSwgY2VudGVyWSA9IChhcmdzWzNdICsgYXJnc1s1XSk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5zYXZlKCk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC50cmFuc2xhdGUoY2VudGVyWCwgY2VudGVyWSk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5yb3RhdGUoYXJnc1s2XSk7XHJcbiAgICAgICAgICAgIHRoaXMuY29udGV4dC5kcmF3SW1hZ2UoaW1nLCB4LCB5LCBhcmdzWzBdLCBhcmdzWzFdLCAwLCAwLCBhcmdzWzRdLCBhcmdzWzVdKTtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0LnJlc3RvcmUoKTtcclxuICAgICAgICB9IGVsc2UgaWYgKGFyZ3MubGVuZ3RoID09IDYpIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShpbWcsIHgsIHksIGFyZ3NbMF0sIGFyZ3NbMV0sIGFyZ3NbMl0sIGFyZ3NbM10sIGFyZ3NbNF0sIGFyZ3NbNV0pO1xyXG4gICAgICAgIH0gZWxzZSBpZiAoYXJncy5sZW5ndGggPj0gMikge1xyXG4gICAgICAgICAgICB0aGlzLmNvbnRleHQuZHJhd0ltYWdlKGltZywgeCwgeSwgYXJnc1swXSwgYXJnc1sxXSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhpcy5jb250ZXh0LmRyYXdJbWFnZShpbWcsIHgsIHkpO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdHJ1ZTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGZ1bGxTY3JlZW5cclxuICAgICAqL1xyXG4gICAgcHVibGljIGZ1bGxTY3JlZW4oKSB7XHJcbiAgICAgICAgdGhpcy5jYW52YXMud2lkdGggPSB3aW5kb3cuaW5uZXJXaWR0aDtcclxuICAgICAgICB0aGlzLmNhbnZhcy5oZWlnaHQgPSB3aW5kb3cuaW5uZXJIZWlnaHQ7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBjcmVhdGUod2lkdGg6IG51bWJlcnxTdG9yeWJvYXJkLCBoZWlnaHQ/OiBudW1iZXIpOiBTdG9yeWJvYXJkIHtcclxuICAgICAgICBsZXQgY2FudmFzID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudChcImNhbnZhc1wiKTtcclxuICAgICAgICBpZiAodHlwZW9mIHdpZHRoID09ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGNhbnZhcy53aWR0aCA9IHdpZHRoLndpZHRoKCk7XHJcbiAgICAgICAgICAgIGNhbnZhcy5oZWlnaHQgPSB3aWR0aC5oZWlnaHQoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBjYW52YXMud2lkdGggPSB3aWR0aDtcclxuICAgICAgICAgICAgY2FudmFzLmhlaWdodCA9IGhlaWdodDtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIG5ldyBTdG9yeWJvYXJkKGNhbnZhcyk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXRpYyBwYXJzZShlbGVtZW50OiBIVE1MQ2FudmFzRWxlbWVudHxzdHJpbmcpOiBTdG9yeWJvYXJkIHtcclxuICAgICAgICByZXR1cm4gbmV3IFN0b3J5Ym9hcmQodHlwZW9mIGVsZW1lbnQgPT0gJ3N0cmluZycgPyBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChlbGVtZW50KSBhcyBIVE1MQ2FudmFzRWxlbWVudCA6IGVsZW1lbnQpO1xyXG4gICAgfVxyXG59IiwiaW50ZXJmYWNlIElUaW1lIHtcclxuICAgIHRpbWU6IG51bWJlcixcclxuICAgIGNvdW50OiBudW1iZXIsXHJcbiAgICBoYW5kbGU6IEZ1bmN0aW9uLFxyXG59XHJcblxyXG5jbGFzcyBNYWluU2NlbmUgZXh0ZW5kcyBTY2VuZSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpbml0XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBpbml0KCkge1xyXG4gICAgICAgIHN1cGVyLmluaXQoKTtcclxuICAgICAgICB0aGlzLmNyZWF0ZVNwcml0ZSgpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3RpbWU6IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIF93aW5kID0gMDtcclxuXHJcbiAgICBwcml2YXRlIGNyZWF0ZVNwcml0ZSgpIHtcclxuICAgICAgICB0aGlzLl90aW1lICsrO1xyXG4gICAgICAgIGlmICh0aGlzLl90aW1lID4gMTAwMDAwMCkge1xyXG4gICAgICAgICAgICB0aGlzLl90aW1lID0gMDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMuX3RpbWUgJSA0MCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgY291bnQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiB0aGlzLmNhbnZhcy53aWR0aCgpIC8gMjAwKTtcclxuICAgICAgICBpZiAoY291bnQgPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgZm9yICg7IGNvdW50ID4gMDsgY291bnQgLS0pIHtcclxuICAgICAgICAgICAgdGhpcy5hZGRDaGlsZChuZXcgU25vd1Nwcml0ZSh0aGlzLmNhbnZhcy53aWR0aCgpLCB0aGlzLmNhbnZhcy5oZWlnaHQoKSkpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgZ2V0V2luZCgpIHtcclxuICAgICAgICBpZiAodGhpcy5fdGltZSAlIDIwMCA+IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIHRoaXMuX3dpbmQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBvbGRfd2luZCA9IHRoaXMuX3dpbmQ7XHJcbiAgICAgICAgdGhpcy5fd2luZCA9IChNYXRoLnJhbmRvbSgpID4gLjUgPyAxIDogLTEpICogTWF0aC5yYW5kb20oKTtcclxuICAgICAgICBpZiAoTWF0aC5hYnMob2xkX3dpbmQgLSB0aGlzLl93aW5kKSA+IDEpIHtcclxuICAgICAgICAgICAgdGhpcy5fd2luZCA9IG9sZF93aW5kID4gMCA/IG9sZF93aW5kIC0gLjEgOiBvbGRfd2luZCArIC4xO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5fd2luZDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlKCkge1xyXG4gICAgICAgIGxldCB3aW5kU3BlZWQgPSB0aGlzLmdldFdpbmQoKTsvL01hdGgucmFuZG9tKCkgPCAwLjUgPyAwLjAwMDUgOiAtMC4wMDA1O1xyXG4gICAgICAgIGZvciAobGV0IGkgPSB0aGlzLmNoaWxkcmVuLmxlbmd0aCAtIDE7IGkgPj0gMDsgaS0tKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IGtpZCA9IHRoaXMuY2hpbGRyZW5baV0gYXMgU25vd1Nwcml0ZTtcclxuICAgICAgICAgICAgaWYgKGtpZC5pc091dCgpKSB7XHJcbiAgICAgICAgICAgICAgICB0aGlzLmNoaWxkcmVuLnNwbGljZShpLCAxKTtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBraWQudXBkYXRlKHdpbmRTcGVlZCk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuY3JlYXRlU3ByaXRlKCk7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBNYWluU3RhZ2UgZXh0ZW5kcyBTdGFnZSB7XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgZWxlbWVudDogSFRNTENhbnZhc0VsZW1lbnR8c3RyaW5nXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcihlbGVtZW50KTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGluaXRcclxuICAgICAqL1xyXG4gICAgcHVibGljIGluaXQoKSB7XHJcbiAgICAgICAgUHJlbG9hZGVyLmxvYWRJbWcoJ3Nub3cnLCAnaW1hZ2Uvc25vdy5wbmcnLCAoKSA9PiB7XHJcbiAgICAgICAgICAgIHRoaXMubmV2aWdhdGUobmV3IE1haW5TY2VuZSgpKTtcclxuICAgICAgICAgICAgc3VwZXIuaW5pdCgpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG59IiwiY2xhc3MgU25vd1Nwcml0ZSB7XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKlxyXG4gICAgICovXHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwcml2YXRlIG1heFdpZHRoOiBudW1iZXIsXHJcbiAgICAgICAgcHJpdmF0ZSBtYXhIZWlnaHQ6IG51bWJlclxyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5pbWFnZSA9IFByZWxvYWRlci5nZXQ8SFRNTEltYWdlRWxlbWVudD4oJ3Nub3cnKTtcclxuICAgICAgICB0aGlzLnJlc2V0KCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHg6IG51bWJlciA9IDA7XHJcbiAgICBwdWJsaWMgeTogbnVtYmVyID0gMDtcclxuICAgIHB1YmxpYyBraW5kOiBudW1iZXIgPSAwO1xyXG4gICAgcHVibGljIHNpemU6IG51bWJlciA9IDA7XHJcbiAgICBwdWJsaWMgc3BlZWRYOiBudW1iZXIgPSAwO1xyXG4gICAgcHVibGljIHNwZWVkWTogbnVtYmVyID0gMDtcclxuICAgIHB1YmxpYyBkZWc6IG51bWJlciA9IDA7XHJcbiAgICBwcml2YXRlIGltYWdlOiBIVE1MSW1hZ2VFbGVtZW50O1xyXG5cclxuICAgIC8qKlxyXG4gICAgICogcmVzZXRcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlc2V0KCkge1xyXG4gICAgICAgIHRoaXMueCA9IE1hdGgucmFuZG9tKCkgKiB0aGlzLm1heFdpZHRoO1xyXG4gICAgICAgIHRoaXMuc2l6ZSA9IE1hdGgucmFuZG9tKCkgKiAyMCArIDEwO1xyXG4gICAgICAgIC8vdGhpcy5zcGVlZFggPSBNYXRoLnJhbmRvbSgpICogMiAtIDE7XHJcbiAgICAgICAgdGhpcy5zcGVlZFkgPSBNYXRoLnJhbmRvbSgpICogLjggKyAuMjtcclxuICAgICAgICB0aGlzLmtpbmQgPSBNYXRoLmZsb29yKE1hdGgucmFuZG9tKCkgKiA2KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBkYXRlKHdpbmRTcGVlZDogbnVtYmVyKSB7XHJcbiAgICAgICAgbGV0IGRlZ0RlbHRhID0gKHdpbmRTcGVlZCA+IDAgPyAxIDogLTEpICogKE1hdGgucmFuZG9tKCkgKiAwLjYgKyAwLjIpO1xyXG4gICAgICAgIHRoaXMuc3BlZWRYID0gd2luZFNwZWVkICogKHRoaXMua2luZCAqIC4wMSArIDEgLSB0aGlzLnNpemUgLyAxMDApO1xyXG4gICAgICAgIHRoaXMueCArPSB0aGlzLnNwZWVkWDtcclxuICAgICAgICB0aGlzLnkgKz0gdGhpcy5zcGVlZFk7XHJcbiAgICAgICAgdGhpcy5kZWcgKz0gZGVnRGVsdGE7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiBpc091dFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgaXNPdXQoKSB7XHJcbiAgICAgICAgcmV0dXJuIHRoaXMueCA8IDAgfHwgdGhpcy54ID4gdGhpcy5tYXhXaWR0aCB8fCB0aGlzLnkgPiB0aGlzLm1heEhlaWdodDtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIGRyYXdcclxuICAgICAqL1xyXG4gICAgcHVibGljIGRyYXcoY3R4OiBTdG9yeWJvYXJkKSB7XHJcbiAgICAgICAgaWYgKHRoaXMuaXNPdXQoKSkge1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGN0eC5kcmF3KHRoaXMuaW1hZ2UsIHRoaXMua2luZCAqIDIwMCwgMCwgMjAwLCAyMDAsIHRoaXMueCwgdGhpcy55LCB0aGlzLnNpemUsIHRoaXMuc2l6ZSwgdGhpcy5kZWcgKiBNYXRoLlBJIC8gMTgwKTtcclxuICAgIH1cclxufSJdfQ==
