var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function o(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),Eve=function(){function t(){}return t.prototype.on=function(t,i){return this.options["on"+t]=i,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var o="on"+t;if(this.hasEvent(t)){return(n=this.options[o]).call.apply(n,[this].concat(i));var n}},t}(),Box=function(t){function i(){return null!==t&&t.apply(this,arguments)||this}return __extends(i,t),i.prototype.showPosition=function(){return this.setPosition(),this.box.show(),this},i.prototype.setPosition=function(){var t=this.element.offset(),i=t.left,e=this.box.outerWidth(),o=$(window).scrollLeft(),n=o+$(window).width();n-e<i&&n<i+e&&(i=n-e);var s=this.box.outerHeight(),r=$(window).scrollTop(),h=$(window).height(),a=this.element.outerHeight(),c=t.top+a;return c+s>r+h&&t.top-s>r&&(c=t.top-s),this.box.css({left:i+"px",top:c+"px"}),this},i.getReal=function(t,i){return i>1?i:t*i},i}(Eve);Date.prototype.getRealMonth=function(){return this.getMonth()+1},Date.prototype.format=function(t){void 0===t&&(t="y年m月d日");var i={"y+":this.getFullYear(),"m+":this.getRealMonth(),"d+":this.getDate(),"h+":this.getHours(),"i+":this.getMinutes(),"s+":this.getSeconds(),"q+":Math.floor((this.getMonth()+3)/3),S:this.getMilliseconds()};for(var e in i)new RegExp("("+e+")").test(t)&&(t=t.replace(RegExp.$1,1==RegExp.$1.length?i[e]:("00"+i[e]).substr((""+i[e]).length)));return t};var DateTimer=function(t){function i(i,e){var o=t.call(this)||this;return o.element=i,o._hasTime=!0,o.options=$.extend({},new DateTimerDefaultOptions,e),"object"!=typeof o.options.min&&(o.options.min=o._tD(o.options.min)),"object"!=typeof o.options.max&&(o.options.max=o._tD(o.options.max)),o.options.format.indexOf("h")<0&&(o._hasTime=!1),o.options.readonly&&o.element.prop("readonly",!0),o.createHtml(),o}return __extends(i,t),i.prototype._getMin=function(){var t=this._tD(this.options.min);if(t)return this._hasTime||t.setHours(23,59,59,99),t},i.prototype._getMax=function(){var t=this._tD(this.options.max);if(t)return this._hasTime||t.setHours(0,0,0,0),t},i.prototype.init=function(t){this.showDate(t),this.open(),this._refreshTime()},i.prototype.createHtml=function(){this.box=$('<div class="datetimer" data-type="datetimer"></div>');var t=this._nLi(60,0),i='<div class="header"><i class="fa fa-backward previousYear"></i><i class="fa fa-chevron-left previousMonth"></i><span></span><i class="fa fa-chevron-right nextMonth"></i><i class="fa fa-forward nextYear"></i></div><div class="body"><div class="month-grid"><ol><li>日</li><li>一</li><li>二</li><li>三</li><li>四</li><li>五</li><li>六</li></ol><ul>'+this._nLi(42,0,!1)+'</ul></div><div class="year-grid"><div class="list-group year"><div class="title">年</div><ul>'+this._nLi(this.options.maxYear+1,this.options.minYear)+'</ul></div><div class="list-group month"><div class="title">月</div><ul>'+this._nLi(13,1)+'</ul></div><i class="fa fa-close"></i></div>';this._hasTime&&(i+='<div class="day-grid"><div class="list-group hour"><div class="title">小时</div><ul>'+this._nLi(24)+'</ul></div><div class="list-group minute"><div class="title">分钟</div><ul>'+t+'</ul></div><div class="list-group second"><div class="title">秒钟</div><ul>'+t+'</ul></div><i class="fa fa-close"></i></div>'),i+="</div>",this._hasTime&&(i+='<div class="footer"><input type="text" class="hour" value="00">:<input type="text" class="minute" value="00">:<input type="text" class="second" value="00"><button>确定</button></div>'),this.box.html(i),$(document.body).append(this.box),this._yearBox=this.box.find(".body .year-grid .year ul"),this._monthBox=this.box.find(".body .year-grid .month ul"),this._yearGrid=this.box.find(".body .year-grid"),this._hasTime&&(this._dayGrid=this.box.find(".body .day-grid"),this._hourBox=this.box.find(".body .day-grid .hour ul"),this._minuteBox=this.box.find(".body .day-grid .minute ul"),this._secondBox=this.box.find(".body .day-grid .second ul")),this._bindEvent()},i.prototype._iTs=function(t){return t<10?"0"+t:t.toString()},i.prototype._nLi=function(t,i,e){void 0===i&&(i=0),void 0===e&&(e=!0);for(var o="";i<t;i++)o+=e?"<li>"+this._iTs(i)+"</li>":"<li></li>";return o},i.prototype.open=function(){if("fixed"==this.box.css("position"))return void this.box.attr("style","").show();this.showPosition()},i.prototype.getCurrentDate=function(){return this._currentDate?this._currentDate:this._currentDate=this._tD(this.box.data("date"))},i.prototype.getDateOrNull=function(){if(this._currentDate)return this._currentDate},i.prototype.previousYear=function(){this._changeYear(this.getCurrentDate().getFullYear()-1)},i.prototype.nextYear=function(){this._changeYear(this.getCurrentDate().getFullYear()+1)},i.prototype.previousMonth=function(){this._changeMonth(this.getCurrentDate().getMonth())},i.prototype.nextMonth=function(){this._changeMonth(this.getCurrentDate().getMonth()+2)},i.prototype.showDate=function(t,i){this._currentDate=this._tD(t,i),this._hasTime||this._currentDate.setHours(12,0,0,0),this.box.data("date",this._currentDate),this._refreshDay()},i.prototype._refreshYearList=function(){this.options.min instanceof i&&this.options.max instanceof i&&this._yearBox.html(this._nLi(this._getMax().getFullYear()+1,this._getMin().getFullYear()))},i.prototype._refreshYearGrid=function(){this._refreshYearList(),this._changeListGroup(this._yearBox,this._currentDate.getFullYear()-this._getMin().getFullYear()),this._changeListGroup(this._monthBox,this._currentDate.getMonth())},i.prototype._refreshDayGrid=function(){this._changeListGroup(this._hourBox,this._currentDate.getHours()),this._changeListGroup(this._minuteBox,this._currentDate.getMinutes()),this._changeListGroup(this._secondBox,this._currentDate.getSeconds())},i.prototype._changeListGroup=function(t,i){var e=t.find("li").eq(i);e.addClass("active").siblings().removeClass("active"),t.scrollTop(e.offset().top-t.offset().top+t.scrollTop()-t.height()/2)},i.prototype._changeYear=function(t){this._currentDate.setFullYear(t),this._refreshDay(),this._changeListGroup(this._yearBox,t-this.options.minYear)},i.prototype._changeMonth=function(t){this._currentDate.setMonth(t-1),this._refreshDay(),this._changeListGroup(this._yearBox,this._currentDate.getFullYear()-this.options.minYear),this._changeListGroup(this._monthBox,this._currentDate.getMonth())},i.prototype._changeHour=function(t){this._currentDate.setHours(t),this.box.find(".footer .hour").val(this._iTs(t)),this._changeListGroup(this._hourBox,t)},i.prototype._changeMinute=function(t){this._currentDate.setMinutes(t),this.box.find(".footer .minute").val(this._iTs(t)),this._changeListGroup(this._minuteBox,t)},i.prototype._changeSecond=function(t){this._currentDate.setSeconds(t),this.box.find(".footer .second").val(this._iTs(t)),this._changeListGroup(this._secondBox,t)},i.prototype._refreshDay=function(){this.box.find(".header span").text(this._currentDate.format(this.options.title));var t=this._mLi(this._currentDate.getFullYear(),this._currentDate.getRealMonth()),i=this.box.find(".body .month-grid ul li");i.removeClass("active").removeClass("disable");var e=this,o=this._currentDate.getDate();t.forEach(function(t,n){var s=i.eq(n).text(e._iTs(t));t-10>n||t+10<n?s.addClass("disable"):t==o&&s.addClass("active")})},i.prototype._refreshTime=function(){this._hasTime&&(this._changeHour(this.getCurrentDate().getHours()),this._changeMinute(this.getCurrentDate().getMinutes()),this._changeSecond(this.getCurrentDate().getSeconds()))},i.prototype._mLi=function(t,i){var e,o=[],n=this._mD(t,i),s=n[0],r=n[1];if(s>0){var h=this._yD(t,i-1);for(e=h-s+2;e<=h;e++)o.push(e)}for(e=1;e<=r;e++)o.push(e);if(s+r<43){var a=42-s-r+1;for(e=1;e<=a;e++)o.push(e)}return o},i.prototype._bindEvent=function(){var t=this;this.box.find(".month-grid li").click(function(){t._clickDay($(this))}),this.box.find(".previousYear").click(function(){t.previousYear()}),this.box.find(".previousMonth").click(function(){t.previousMonth()}),this.box.find(".nextMonth").click(function(){t.nextMonth()}),this.box.find(".nextYear").click(function(){t.nextYear()}),this.box.find(".header span").click(function(){if(!t._yearGrid.is(":hidden"))return void t._yearGrid.hide();t._hasTime&&t._dayGrid.hide(),t._yearGrid.show(),t._refreshYearGrid()}),this._yearBox.find("li").click(function(){t._changeYear(parseInt($(this).text()))}),this._monthBox.find("li").click(function(){t._changeMonth(parseInt($(this).text()))}),this._yearGrid.find(".fa-close").click(function(){t._yearGrid.hide()}),this._hasTime&&(this.box.find(".footer button").click(function(){t.output(!0)}),this.box.find(".footer input").click(function(){if(t._dayGrid.is(":hidden"))return t._yearGrid.hide(),t._dayGrid.show(),void t._refreshDayGrid();t._dayGrid.hide()}),this._hourBox.find("li").click(function(){t._changeHour(parseInt($(this).text()))}),this._minuteBox.find("li").click(function(){t._changeMinute(parseInt($(this).text()))}),this._secondBox.find("li").click(function(){t._changeSecond(parseInt($(this).text()))}),this._dayGrid.find(".fa-close").click(function(){t._dayGrid.hide()})),this.box.click(function(t){t.stopPropagation()}),this.element&&this.element.click(function(i){i.stopPropagation(),$("[data-type=datetimer]").hide(),t.init($(this).val())}),$(document).click(function(){t.box.hide()}),"object"==typeof this.options.min&&this.options.min instanceof i&&this.options.min.done(function(){t._currentDate&&!t.checkDate(t._currentDate)&&t.clear()}),"object"==typeof this.options.max&&this.options.max instanceof i&&this.options.max.done(function(){t._currentDate&&!t.checkDate(t._currentDate)&&t.clear()}),$.fn.swipe&&this.box.swipe({swipeLeft:function(){t.nextMonth()},swipeRight:function(){t.previousMonth()}})},i.prototype._clickDay=function(t){var i=parseInt(t.text()),e=new Date(this._currentDate);if(t.hasClass("disable")?i>t.index()?(e.setMonth(e.getMonth()-1),e.setDate(i)):(e.setMonth(e.getMonth()+1),e.setDate(i)):e.setDate(i),0!=this.trigger("click",e,t)){if(!this.checkDate(e))return void this.trigger("error",e);e.getMonth()==this._currentDate.getMonth()?(t.addClass("active").siblings().removeClass("active"),this._currentDate=e):this.showDate(e),this.output()}},i.prototype._yD=function(t,i){return new Date(t,i,0).getDate()},i.prototype._mD=function(t,i){var e=new Date(t,i,0),o=e.getDate();return e.setDate(1),[e.getDay(),o]},i.prototype.val=function(){return this.getCurrentDate().format(this.options.format)},i.prototype.checkDate=function(t){var i=this._getMin();if(i&&t<=i)return!1;var e=this._getMax();return!e||t<e},i.prototype.clear=function(){this._currentDate=void 0,this.element.val("")},i.prototype.output=function(t){if(void 0===t&&(t=!1),!this.checkDate(this.getCurrentDate()))return void this.trigger("error",this.getCurrentDate());0!=this.trigger("done")&&(this.element.val(this.val()),this._hasTime&&!t||this.box.hide())},i.prototype._tD=function(t,e){if(!t)return new Date;if("object"==typeof t)return t instanceof i?t.getDateOrNull():t;if("number"==typeof t&&"number"==typeof e)return new Date(t,e-1,1);"string"==typeof t&&t.indexOf("-")>0&&t.replace("-","/");var o=new Date(t);return isNaN(o.getTime())?new Date:o},i.prototype.done=function(t){return this.on("done",t)},i}(Box),DateTimerDefaultOptions=function(){function t(){this.format="y-m-d h:i:s",this.min="1900/01/01 00:00:00",this.max="2099/12/31 23:59:59",this.title="y年m月",this.readonly=!1,this.minYear=1900,this.maxYear=2099}return t}();!function(t){t.fn.datetimer=function(t){return new DateTimer(this,t)}}(jQuery);