var __extends=this&&this.__extends||function(){var t=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,i){t.__proto__=i}||function(t,i){for(var e in i)i.hasOwnProperty(e)&&(t[e]=i[e])};return function(i,e){function n(){this.constructor=i}t(i,e),i.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}}(),Eve=function(){function t(){}return t.prototype.on=function(t,i){return this.options["on"+t]=i,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var i=[],e=1;e<arguments.length;e++)i[e-1]=arguments[e];var n="on"+t;if(this.hasEvent(t)){return(o=this.options[n]).call.apply(o,[this].concat(i));var o}},t}(),Point=function(){function t(t,i,e,n){if(this.index=t,this.width=e,this.height=n,this.elements=[],"number"==typeof i)return void(this.x=i);this.elements.push(i),o=this.getElementWidthAndHeight(),this.width=o[0],this.height=o[1],this.x=-this.width;var o}return t.prototype.getLeft=function(t){return this.x-(this.width-t)/2},t.prototype.getElementWidthAndHeight=function(){return[this.elements[0].width(),this.elements[0].height()]},t.prototype.applyWidthAndHeight=function(){var t=this,i=this.getElementWidthAndHeight(),e=i[0],n=i[1];n==this.height&&this.width!=e&&(this.height=this.width*n/e),$.each(this.elements,function(i,e){e.width(t.width),e.height(t.height)})},t}(),SliderItem=function(t){function i(i,e){var n=t.call(this)||this;if(n.element=i,n.options=e,n._data=[],n._length=0,n._index=0,n.element.attr("data-slider"))return n;var o=n.element.find(n.options.item);return o.length<2?n:(n._length=o.length,n._box=o.parent(),n._init(o),n.element.attr("data-slider",1),n)}return __extends(i,t),i.prototype._timeCallback=function(){this.options.auto&&this.next()},i.prototype._init=function(t){var i=this;t.each(function(t,e){var n=new Point(t,$(e));i._data.push(n)});for(var e=0;e<2;e++)for(var n=0,o=t.length;n<o;n++){var h=$(t[n].cloneNode(!0));this._data[n].elements.push(h),this._box.append(h)}this.resize(),i.options.hasPoint&&this._addListPoint(),this._bindEvent(),this._setTime()},i.prototype._bindEvent=function(){var t=this;this.element.find(this.options.previous).click(function(){t.previous()}),this.element.find(this.options.next).click(function(){t.next()}),$(window).resize(function(){t.resize()}),$.fn.swipe&&this.element.swipe({swipeLeft:function(){t.next()},swipeRight:function(){t.previous()}})},i.prototype._getWidth=function(t){return t>1?t:this.element.width()*t},i.prototype._setTime=function(){this._time=(this.options.spaceTime+this.options.animationTime)/16},i.prototype._addListPoint=function(){for(var t="",i=this._length;i>0;i--)t+="<li></i>";this.element.append('<ul class="slider-point">'+t+"</ul>");var e=this;this.element.on("click",".slider-point li",function(){e.index=$(this).index()+1})},i.prototype.resize=function(){var t=this,i=this.element.width(),e=0;$.each(this._data,function(i,n){t.options.width>0&&(n.width=t._getWidth(t.options.width)),t.options.height>0&&(n.height=t._getWidth(t.options.height)),n.applyWidthAndHeight(),e+=n.width,n.x=-e}),$.each(this._data,function(t,i){i.x-=e}),this._box.css({left:this._data[this._index].getLeft(i)+"px"}),this._box.width(3*e),this.index=this._index},Object.defineProperty(i.prototype,"index",{get:function(){return this._index},set:function(t){this.goto(t)},enumerable:!0,configurable:!0}),i.prototype.next=function(){this.index++},i.prototype.previous=function(){this.index--},i.prototype._getPoint=function(t){if(t<0){var i=this._data[this._data.length-1],e=new Point(t,this._data[0].x+i.width,i.width,i.height);return[e,i]}if(t>=this._data.length){var n=this._data[0],e=new Point(t,this._data[this._data.length-1].x-n.width,n.width,n.height);return[e,n]}return[this._data[t],this._data[t]]},i.prototype.goto=function(t){this._setTime();var i=this._getPoint(t),e=this.element.width();this.element.height(i[0].height);var n=this;this._goAndCallback(i[0].getLeft(e),function(){i[0].index!=i[1].index&&n._box.css({left:i[1].getLeft(e)+"px"}),n._index=i[1].index}),this.trigger.apply(this,["change"].concat(i)),this.options.hasPoint&&this.element.find(".slider-point li").eq(t-1).addClass("active").siblings().removeClass("active")},i.prototype._goAndCallback=function(t,i){this._box.animate({left:t+"px"},this.options.animationTime,this.options.animationMode,i)},i.prototype.run=function(){this._length<1||--this._time<=0&&this._timeCallback()},i}(Eve),Slider=function(){function t(t,i){var e=this;this.element=t,this._data=[],this.options=$.extend({},new SliderDefaultOptions,i),0!=this.element.length&&(this.element.each(function(t,i){e.addItem($(i))}),this._runTimer())}return t.prototype.addItem=function(t){if(t instanceof SliderItem)return void this._data.push(t);this._data.push(new SliderItem(t,this.options))},t.prototype.map=function(t,i){var e=this;if(void 0===i&&(i=this._data.length-1),"number"!=typeof i)return void i.forEach(function(i){i<0||i>=e._data.length||t(e._data[i],i)});for(i>=this._data.length&&(i=this._data.length-1);i>=0;i--){var n=this._data[i],o=t(n,i);if(1==o&&this._data.splice(i,1),0==o)return}},t.prototype._runTimer=function(){var t=this;this._timer=requestAnimationFrame(function(){t.map(function(t){t.run()}),t._runTimer()})},t.prototype._cancelTimer=function(){this._timer&&cancelAnimationFrame(this._timer)},t}(),SliderDefaultOptions=function(){function t(){this.item="li",this.spaceTime=3e3,this.animationTime=1e3,this.animationMode="swing",this.previous=".slider-previous",this.next=".slider-next",this.hasPoint=!0,this.auto=!0}return t}();!function(t){t.fn.slider=function(t){return new Slider(this,t)}}(jQuery);
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV2ZW50LnRzIiwicG9pbnQudHMiLCJpdGVtLnRzIiwianF1ZXJ5LnNsaWRlci50cyJdLCJuYW1lcyI6WyJFdmUiLCJwcm90b3R5cGUiLCJvbiIsImV2ZW50IiwiY2FsbGJhY2siLCJ0aGlzIiwib3B0aW9ucyIsImhhc0V2ZW50IiwiaGFzT3duUHJvcGVydHkiLCJ0cmlnZ2VyIiwiYXJncyIsIl9pIiwiYXJndW1lbnRzIiwibGVuZ3RoIiwicmVhbEV2ZW50IiwiX2EiLCJjYWxsIiwiYXBwbHkiLCJjb25jYXQiLCJQb2ludCIsImluZGV4IiwieCIsIndpZHRoIiwiaGVpZ2h0IiwiZWxlbWVudHMiLCJwdXNoIiwiZ2V0RWxlbWVudFdpZHRoQW5kSGVpZ2h0IiwiZ2V0TGVmdCIsImFwcGx5V2lkdGhBbmRIZWlnaHQiLCJpbnN0YW5jZSIsIiQiLCJlYWNoIiwiaSIsImVsZSIsIlNsaWRlckl0ZW0iLCJfc3VwZXIiLCJlbGVtZW50IiwiX3RoaXMiLCJfZGF0YSIsIl9sZW5ndGgiLCJfaW5kZXgiLCJhdHRyIiwiaXRlbXMiLCJmaW5kIiwiaXRlbSIsIl9ib3giLCJwYXJlbnQiLCJfaW5pdCIsIl9fZXh0ZW5kcyIsIl90aW1lQ2FsbGJhY2siLCJhdXRvIiwibmV4dCIsInBvaW50IiwiaiIsImxlbmd0aF8xIiwibmV3TGkiLCJjbG9uZU5vZGUiLCJhcHBlbmQiLCJyZXNpemUiLCJoYXNQb2ludCIsIl9hZGRMaXN0UG9pbnQiLCJfYmluZEV2ZW50IiwiX3NldFRpbWUiLCJwcmV2aW91cyIsImNsaWNrIiwid2luZG93IiwiZm4iLCJzd2lwZSIsInN3aXBlTGVmdCIsInN3aXBlUmlnaHQiLCJfZ2V0V2lkdGgiLCJyZWx0aXZlIiwiX3RpbWUiLCJzcGFjZVRpbWUiLCJhbmltYXRpb25UaW1lIiwiaHRtbCIsImNvdW50IiwibWF4V2lkdGgiLCJjc3MiLCJsZWZ0IiwiT2JqZWN0IiwiZGVmaW5lUHJvcGVydHkiLCJnb3RvIiwiX2dldFBvaW50IiwibGFzdCIsImZpcnN0IiwicG9pbnRzIiwiX2dvQW5kQ2FsbGJhY2siLCJlcSIsImFkZENsYXNzIiwic2libGluZ3MiLCJyZW1vdmVDbGFzcyIsImFuaW1hdGUiLCJhbmltYXRpb25Nb2RlIiwicnVuIiwiU2xpZGVyIiwiZXh0ZW5kIiwiU2xpZGVyRGVmYXVsdE9wdGlvbnMiLCJhZGRJdGVtIiwiX3J1blRpbWVyIiwibWFwIiwiZm9yRWFjaCIsInJlc3VsdCIsInNwbGljZSIsIl90aW1lciIsInJlcXVlc3RBbmltYXRpb25GcmFtZSIsIl9jYW5jZWxUaW1lciIsImNhbmNlbEFuaW1hdGlvbkZyYW1lIiwic2xpZGVyIiwialF1ZXJ5Il0sIm1hcHBpbmdzIjoiK1VBQUFBLElBQUEsV0FBQSxRQUFBQSxNQW1CQSxNQWhCQUEsR0FBQUMsVUFBQUMsR0FBQSxTQUFBQyxFQUFBQyxHQUVBLE1BREFDLE1BQUFDLFFBQUEsS0FBQUgsR0FBQUMsRUFDQUMsTUFHQUwsRUFBQUMsVUFBQU0sU0FBQSxTQUFBSixHQUNBLE1BQUFFLE1BQUFDLFFBQUFFLGVBQUEsS0FBQUwsSUFHQUgsRUFBQUMsVUFBQVEsUUFBQSxTQUFBTixPQUFBLEdBQUFPLE1BQUFDLEVBQUEsRUFBQUEsRUFBQUMsVUFBQUMsT0FBQUYsSUFBQUQsRUFBQUMsRUFBQSxHQUFBQyxVQUFBRCxFQUNBLElBQUFHLEdBQUEsS0FBQVgsQ0FDQSxJQUFBRSxLQUFBRSxTQUFBSixHQUFBLENBR0EsT0FBQVksRUFBQVYsS0FBQUMsUUFBQVEsSUFBQUUsS0FBQUMsTUFBQUYsR0FBQVYsTUFBQWEsT0FBQVIsWUFFQVYsS0NuQkFtQixNQUFBLFdBQ0EsUUFBQUEsR0FDQUMsRUFDQUMsRUFDQUMsRUFDQUMsR0FFQSxHQUxBbEIsS0FBQWUsTUFBQUEsRUFFQWYsS0FBQWlCLE1BQUFBLEVBQ0FqQixLQUFBa0IsT0FBQUEsRUFhQWxCLEtBQUFtQixZQVhBLGdCQUFBSCxHQUVBLFlBREFoQixLQUFBZ0IsRUFBQUEsRUFHQWhCLE1BQUFtQixTQUFBQyxLQUFBSixHQUNBTixFQUFBVixLQUFBcUIsMkJBQUFyQixLQUFBaUIsTUFBQVAsRUFBQSxHQUFBVixLQUFBa0IsT0FBQVIsRUFBQSxHQUNBVixLQUFBZ0IsR0FBQWhCLEtBQUFpQixZQXFDQSxNQTFCQUgsR0FBQWxCLFVBQUEwQixRQUFBLFNBQUFMLEdBQ0EsTUFBQWpCLE1BQUFnQixHQUFBaEIsS0FBQWlCLE1BQUFBLEdBQUEsR0FNQUgsRUFBQWxCLFVBQUF5Qix5QkFBQSxXQUNBLE9BQUFyQixLQUFBbUIsU0FBQSxHQUFBRixRQUFBakIsS0FBQW1CLFNBQUEsR0FBQUQsV0FNQUosRUFBQWxCLFVBQUEyQixvQkFBQSxXQUNBLEdBQUFDLEdBQUF4QixLQUNBVSxFQUFBVixLQUFBcUIsMkJBQUFKLEVBQUFQLEVBQUEsR0FBQVEsRUFBQVIsRUFBQSxFQUNBUSxJQUFBbEIsS0FBQWtCLFFBQUFsQixLQUFBaUIsT0FBQUEsSUFFQWpCLEtBQUFrQixPQUFBbEIsS0FBQWlCLE1BQUFDLEVBQUFELEdBRUFRLEVBQUFDLEtBQUExQixLQUFBbUIsU0FBQSxTQUFBUSxFQUFBQyxHQUNBQSxFQUFBWCxNQUFBTyxFQUFBUCxPQUNBVyxFQUFBVixPQUFBTSxFQUFBTixXQUdBSixLQ2xEQWUsV0FBQSxTQUFBQyxHQUNBLFFBQUFELEdBQ0FFLEVBQ0E5QixHQUZBLEdBQUErQixHQUlBRixFQUFBbkIsS0FBQVgsT0FBQUEsSUFDQSxJQUpBZ0MsRUFBQUQsUUFBQUEsRUFDQUMsRUFBQS9CLFFBQUFBLEVBZ0JBK0IsRUFBQUMsU0FFQUQsRUFBQUUsUUFBQSxFQUVBRixFQUFBRyxPQUFBLEVBakJBSCxFQUFBRCxRQUFBSyxLQUFBLHVCQUdBLElBQUFDLEdBQUFMLEVBQUFELFFBQUFPLEtBQUFOLEVBQUEvQixRQUFBc0MsS0FDQSxPQUFBRixHQUFBN0IsT0FBQSxLQUdBd0IsRUFBQUUsUUFBQUcsRUFBQTdCLE9BQ0F3QixFQUFBUSxLQUFBSCxFQUFBSSxTQUNBVCxFQUFBVSxNQUFBTCxHQUNBTCxFQUFBRCxRQUFBSyxLQUFBLGNBQUEsTUFnTkEsTUFoT0FPLFdBQUFkLEVBQUFDLEdBNkJBRCxFQUFBakMsVUFBQWdELGNBQUEsV0FDQTVDLEtBQUFDLFFBQUE0QyxNQUNBN0MsS0FBQThDLFFBSUFqQixFQUFBakMsVUFBQThDLE1BQUEsU0FBQUwsR0FDQSxHQUFBYixHQUFBeEIsSUFDQXFDLEdBQUFYLEtBQUEsU0FBQUMsRUFBQVksR0FDQSxHQUFBUSxHQUFBLEdBQUFqQyxPQUFBYSxFQUFBRixFQUFBYyxHQUNBZixHQUFBUyxNQUFBYixLQUFBMkIsSUFLQSxLQUFBLEdBQUFDLEdBQUEsRUFBQUEsRUFBQSxFQUFBQSxJQUNBLElBQUEsR0FBQXJCLEdBQUEsRUFBQXNCLEVBQUFaLEVBQUE3QixPQUFBbUIsRUFBQXNCLEVBQUF0QixJQUFBLENBQ0EsR0FBQXVCLEdBQUF6QixFQUFBWSxFQUFBVixHQUFBd0IsV0FBQSxHQUNBbkQsTUFBQWlDLE1BQUFOLEdBQUFSLFNBQUFDLEtBQUE4QixHQUNBbEQsS0FBQXdDLEtBQUFZLE9BQUFGLEdBR0FsRCxLQUFBcUQsU0FFQTdCLEVBQUF2QixRQUFBcUQsVUFDQXRELEtBQUF1RCxnQkFFQXZELEtBQUF3RCxhQUNBeEQsS0FBQXlELFlBSUE1QixFQUFBakMsVUFBQTRELFdBQUEsV0FDQSxHQUFBaEMsR0FBQXhCLElBQ0FBLE1BQUErQixRQUFBTyxLQUFBdEMsS0FBQUMsUUFBQXlELFVBQUFDLE1BQUEsV0FDQW5DLEVBQUFrQyxhQUVBMUQsS0FBQStCLFFBQUFPLEtBQUF0QyxLQUFBQyxRQUFBNkMsTUFBQWEsTUFBQSxXQUNBbkMsRUFBQXNCLFNBRUFyQixFQUFBbUMsUUFBQVAsT0FBQSxXQUNBN0IsRUFBQTZCLFdBRUE1QixFQUFBb0MsR0FBQUMsT0FHQTlELEtBQUErQixRQUFBK0IsT0FDQUMsVUFBQSxXQUNBdkMsRUFBQXNCLFFBRUFrQixXQUFBLFdBQ0F4QyxFQUFBa0MsZUFLQTdCLEVBQUFqQyxVQUFBcUUsVUFBQSxTQUFBQyxHQUNBLE1BQUFBLEdBQUEsRUFDQUEsRUFFQWxFLEtBQUErQixRQUFBZCxRQUFBaUQsR0FHQXJDLEVBQUFqQyxVQUFBNkQsU0FBQSxXQUNBekQsS0FBQW1FLE9BQUFuRSxLQUFBQyxRQUFBbUUsVUFBQXBFLEtBQUFDLFFBQUFvRSxlQUFBLElBT0F4QyxFQUFBakMsVUFBQTJELGNBQUEsV0FHQSxJQUZBLEdBQUFlLEdBQUEsR0FDQUMsRUFBQXZFLEtBQUFrQyxRQUNBcUMsRUFBQSxFQUFBQSxJQUNBRCxHQUFBLFVBRUF0RSxNQUFBK0IsUUFBQXFCLE9BQUEsNEJBQUFrQixFQUFBLFFBQ0EsSUFBQTlDLEdBQUF4QixJQUNBQSxNQUFBK0IsUUFBQWxDLEdBQUEsUUFBQSxtQkFBQSxXQUNBMkIsRUFBQVQsTUFBQVUsRUFBQXpCLE1BQUFlLFFBQUEsS0FPQWMsRUFBQWpDLFVBQUF5RCxPQUFBLFdBQ0EsR0FBQTdCLEdBQUF4QixLQUNBd0UsRUFBQXhFLEtBQUErQixRQUFBZCxRQUNBQSxFQUFBLENBQ0FRLEdBQUFDLEtBQUExQixLQUFBaUMsTUFBQSxTQUFBTixFQUFBb0IsR0FDQXZCLEVBQUF2QixRQUFBZ0IsTUFBQSxJQUNBOEIsRUFBQTlCLE1BQUFPLEVBQUF5QyxVQUFBekMsRUFBQXZCLFFBQUFnQixRQUVBTyxFQUFBdkIsUUFBQWlCLE9BQUEsSUFDQTZCLEVBQUE3QixPQUFBTSxFQUFBeUMsVUFBQXpDLEVBQUF2QixRQUFBaUIsU0FFQTZCLEVBQUF4QixzQkFDQU4sR0FBQThCLEVBQUE5QixNQUNBOEIsRUFBQS9CLEdBQUFDLElBRUFRLEVBQUFDLEtBQUExQixLQUFBaUMsTUFBQSxTQUFBTixFQUFBb0IsR0FDQUEsRUFBQS9CLEdBQUFDLElBRUFqQixLQUFBd0MsS0FBQWlDLEtBQUFDLEtBQUExRSxLQUFBaUMsTUFBQWpDLEtBQUFtQyxRQUFBYixRQUFBa0QsR0FBQSxPQUNBeEUsS0FBQXdDLEtBQUF2QixNQUFBLEVBQUFBLEdBQ0FqQixLQUFBZSxNQUFBZixLQUFBbUMsUUFHQXdDLE9BQUFDLGVBQUEvQyxFQUFBakMsVUFBQSxhQUFBLFdBQ0EsTUFBQUksTUFBQW1DLFlBR0EsU0FBQXBCLEdBQ0FmLEtBQUE2RSxLQUFBOUQsb0NBTUFjLEVBQUFqQyxVQUFBa0QsS0FBQSxXQUNBOUMsS0FBQWUsU0FNQWMsRUFBQWpDLFVBQUE4RCxTQUFBLFdBQ0ExRCxLQUFBZSxTQU9BYyxFQUFBakMsVUFBQWtGLFVBQUEsU0FBQS9ELEdBQ0EsR0FBQUEsRUFBQSxFQUFBLENBQ0EsR0FBQWdFLEdBQUEvRSxLQUFBaUMsTUFBQWpDLEtBQUFpQyxNQUFBekIsT0FBQSxHQUNBdUMsRUFBQSxHQUFBakMsT0FBQUMsRUFBQWYsS0FBQWlDLE1BQUEsR0FBQWpCLEVBQUErRCxFQUFBOUQsTUFBQThELEVBQUE5RCxNQUFBOEQsRUFBQTdELE9BQ0EsUUFBQTZCLEVBQUFnQyxHQUVBLEdBQUFoRSxHQUFBZixLQUFBaUMsTUFBQXpCLE9BQUEsQ0FDQSxHQUFBd0UsR0FBQWhGLEtBQUFpQyxNQUFBLEdBQ0FjLEVBQUEsR0FBQWpDLE9BQUFDLEVBQUFmLEtBQUFpQyxNQUFBakMsS0FBQWlDLE1BQUF6QixPQUFBLEdBQUFRLEVBQUFnRSxFQUFBL0QsTUFBQStELEVBQUEvRCxNQUFBK0QsRUFBQTlELE9BQ0EsUUFBQTZCLEVBQUFpQyxHQUVBLE9BQUFoRixLQUFBaUMsTUFBQWxCLEdBQUFmLEtBQUFpQyxNQUFBbEIsS0FPQWMsRUFBQWpDLFVBQUFpRixLQUFBLFNBQUE5RCxHQUNBZixLQUFBeUQsVUFDQSxJQUFBd0IsR0FBQWpGLEtBQUE4RSxVQUFBL0QsR0FDQUUsRUFBQWpCLEtBQUErQixRQUFBZCxPQUNBakIsTUFBQStCLFFBQUFiLE9BQUErRCxFQUFBLEdBQUEvRCxPQUNBLElBQUFNLEdBQUF4QixJQUNBQSxNQUFBa0YsZUFBQUQsRUFBQSxHQUFBM0QsUUFBQUwsR0FBQSxXQUNBZ0UsRUFBQSxHQUFBbEUsT0FBQWtFLEVBQUEsR0FBQWxFLE9BQ0FTLEVBQUFnQixLQUFBaUMsS0FBQUMsS0FBQU8sRUFBQSxHQUFBM0QsUUFBQUwsR0FBQSxPQUVBTyxFQUFBVyxPQUFBOEMsRUFBQSxHQUFBbEUsUUFFQWYsS0FBQUksUUFBQVEsTUFBQVosTUFBQSxVQUFBYSxPQUFBb0UsSUFDQWpGLEtBQUFDLFFBQUFxRCxVQUNBdEQsS0FBQStCLFFBQUFPLEtBQUEsb0JBQUE2QyxHQUFBcEUsRUFBQSxHQUFBcUUsU0FBQSxVQUFBQyxXQUFBQyxZQUFBLFdBU0F6RCxFQUFBakMsVUFBQXNGLGVBQUEsU0FBQVIsRUFBQTNFLEdBQ0FDLEtBQUF3QyxLQUFBK0MsU0FDQWIsS0FBQUEsRUFBQSxNQUNBMUUsS0FBQUMsUUFBQW9FLGNBQ0FyRSxLQUFBQyxRQUFBdUYsY0FDQXpGLElBSUE4QixFQUFBakMsVUFBQTZGLElBQUEsV0FDQXpGLEtBQUFrQyxRQUFBLEtBR0FsQyxLQUFBbUUsT0FDQSxHQUNBbkUsS0FBQTRDLGlCQUdBZixHQWhPQWxDLEtDT0ErRixPQUFBLFdBQ0EsUUFBQUEsR0FDQTNELEVBQ0E5QixHQUZBLEdBQUErQixHQUFBaEMsSUFDQUEsTUFBQStCLFFBQUFBLEVBZUEvQixLQUFBaUMsU0FaQWpDLEtBQUFDLFFBQUF3QixFQUFBa0UsVUFBQSxHQUFBQyxzQkFBQTNGLEdBQ0EsR0FBQUQsS0FBQStCLFFBQUF2QixTQUdBUixLQUFBK0IsUUFBQUwsS0FBQSxTQUFBQyxFQUFBWSxHQUNBUCxFQUFBNkQsUUFBQXBFLEVBQUFjLE1BRUF2QyxLQUFBOEYsYUE4REEsTUFyREFKLEdBQUE5RixVQUFBaUcsUUFBQSxTQUFBdEQsR0FDQSxHQUFBQSxZQUFBVixZQUVBLFdBREE3QixNQUFBaUMsTUFBQWIsS0FBQW1CLEVBR0F2QyxNQUFBaUMsTUFBQWIsS0FBQSxHQUFBUyxZQUFBVSxFQUFBdkMsS0FBQUMsV0FRQXlGLEVBQUE5RixVQUFBbUcsSUFBQSxTQUFBaEcsRUFBQTRCLEdBQUEsR0FBQUssR0FBQWhDLElBQ0EsUUFEQSxLQUFBMkIsSUFBQUEsRUFBQTNCLEtBQUFpQyxNQUFBekIsT0FBQSxHQUNBLGdCQUFBbUIsR0FPQSxXQU5BQSxHQUFBcUUsUUFBQSxTQUFBaEQsR0FDQUEsRUFBQSxHQUFBQSxHQUFBaEIsRUFBQUMsTUFBQXpCLFFBR0FULEVBQUFpQyxFQUFBQyxNQUFBZSxHQUFBQSxJQU9BLEtBSEFyQixHQUFBM0IsS0FBQWlDLE1BQUF6QixTQUNBbUIsRUFBQTNCLEtBQUFpQyxNQUFBekIsT0FBQSxHQUVBbUIsR0FBQSxFQUFBQSxJQUFBLENBQ0EsR0FBQVksR0FBQXZDLEtBQUFpQyxNQUFBTixHQUNBc0UsRUFBQWxHLEVBQUF3QyxFQUFBWixFQUlBLElBSEEsR0FBQXNFLEdBQ0FqRyxLQUFBaUMsTUFBQWlFLE9BQUF2RSxFQUFBLEdBRUEsR0FBQXNFLEVBQ0EsU0FLQVAsRUFBQTlGLFVBQUFrRyxVQUFBLFdBQ0EsR0FBQXRFLEdBQUF4QixJQUNBQSxNQUFBbUcsT0FBQUMsc0JBQUEsV0FDQTVFLEVBQUF1RSxJQUFBLFNBQUF4RCxHQUNBQSxFQUFBa0QsUUFFQWpFLEVBQUFzRSxlQUlBSixFQUFBOUYsVUFBQXlHLGFBQUEsV0FDQXJHLEtBQUFtRyxRQUNBRyxxQkFBQXRHLEtBQUFtRyxTQUdBVCxLQWlCQUUscUJBQUEsV0FBQSxRQUFBQSxLQUNBNUYsS0FBQXVDLEtBQUEsS0FDQXZDLEtBQUFvRSxVQUFBLElBQ0FwRSxLQUFBcUUsY0FBQSxJQUNBckUsS0FBQXdGLGNBQUEsUUFDQXhGLEtBQUEwRCxTQUFBLG1CQUNBMUQsS0FBQThDLEtBQUEsZUFDQTlDLEtBQUFzRCxVQUFBLEVBQ0F0RCxLQUFBNkMsTUFBQSxFQUNBLE1BQUErQyxPQUdBLFNBQUFuRSxHQUNBQSxFQUFBb0MsR0FBQTBDLE9BQUEsU0FBQXRHLEdBQ0EsTUFBQSxJQUFBeUYsUUFBQTFGLEtBQUFDLEtBRUF1RyIsImZpbGUiOiJqcXVlcnkuc2xpZGVyLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYWJzdHJhY3QgY2xhc3MgRXZlIHtcclxuICAgIHB1YmxpYyBvcHRpb25zOiBhbnk7XHJcblxyXG4gICAgcHVibGljIG9uKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbik6IHRoaXMge1xyXG4gICAgICAgIHRoaXMub3B0aW9uc1snb24nICsgZXZlbnRdID0gY2FsbGJhY2s7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhhc0V2ZW50KGV2ZW50OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhhc093blByb3BlcnR5KCdvbicgKyBldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRyaWdnZXIoZXZlbnQ6IHN0cmluZywgLi4uIGFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgbGV0IHJlYWxFdmVudCA9ICdvbicgKyBldmVudDtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzRXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9uc1tyZWFsRXZlbnRdLmNhbGwodGhpcywgLi4uYXJncyk7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBQb2ludCB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgaW5kZXg6IG51bWJlcixcclxuICAgICAgICB4OiBudW1iZXIgfCBKUXVlcnksXHJcbiAgICAgICAgcHVibGljIHdpZHRoPzogbnVtYmVyLFxyXG4gICAgICAgIHB1YmxpYyBoZWlnaHQ/OiBudW1iZXJcclxuICAgICkge1xyXG4gICAgICAgIGlmICh0eXBlb2YgeCA9PSAnbnVtYmVyJykge1xyXG4gICAgICAgICAgICB0aGlzLnggPSB4O1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudHMucHVzaCh4KTtcclxuICAgICAgICBbdGhpcy53aWR0aCwgdGhpcy5oZWlnaHRdID0gdGhpcy5nZXRFbGVtZW50V2lkdGhBbmRIZWlnaHQoKTtcclxuICAgICAgICB0aGlzLnggPSAtdGhpcy53aWR0aDtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgeDogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBlbGVtZW50czogQXJyYXk8SlF1ZXJ5PiA9IFtdO1xyXG5cclxuICAgIC8qKlxyXG4gICAgICog5Y+W5YWD57Sg55qEeFxyXG4gICAgICogQHBhcmFtIHdpZHRoIFxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgZ2V0TGVmdCh3aWR0aDogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICByZXR1cm4gdGhpcy54IC0gKHRoaXMud2lkdGggLSB3aWR0aCkgLyAyO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog6I635Y+W5YWD57Sg55qE5a695ZKM6auYXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBnZXRFbGVtZW50V2lkdGhBbmRIZWlnaHQoKTogW251bWJlciwgbnVtYmVyXSB7XHJcbiAgICAgICAgcmV0dXJuIFt0aGlzLmVsZW1lbnRzWzBdLndpZHRoKCksIHRoaXMuZWxlbWVudHNbMF0uaGVpZ2h0KCldO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKlxyXG4gICAgICog5bqU55So5b2T5YmN55qE5a695ZKM6auYXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBhcHBseVdpZHRoQW5kSGVpZ2h0KCkge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgbGV0IFt3aWR0aCwgaGVpZ2h0XSA9IHRoaXMuZ2V0RWxlbWVudFdpZHRoQW5kSGVpZ2h0KCk7XHJcbiAgICAgICAgaWYgKGhlaWdodCA9PSB0aGlzLmhlaWdodCAmJiB0aGlzLndpZHRoICE9IHdpZHRoKSB7XHJcbiAgICAgICAgICAgIC8vIOetieavlOS+i+e8qeaUvlxyXG4gICAgICAgICAgICB0aGlzLmhlaWdodCA9IHRoaXMud2lkdGggKiBoZWlnaHQgLyB3aWR0aDtcclxuICAgICAgICB9XHJcbiAgICAgICAgJC5lYWNoKHRoaXMuZWxlbWVudHMsIGZ1bmN0aW9uKGksIGVsZSkge1xyXG4gICAgICAgICAgICBlbGUud2lkdGgoaW5zdGFuY2Uud2lkdGgpO1xyXG4gICAgICAgICAgICBlbGUuaGVpZ2h0KGluc3RhbmNlLmhlaWdodCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcbn0iLCJjbGFzcyBTbGlkZXJJdGVtIGV4dGVuZHMgRXZlIHtcclxuICAgIGNvbnN0cnVjdG9yKFxyXG4gICAgICAgIHB1YmxpYyBlbGVtZW50OiBKUXVlcnksXHJcbiAgICAgICAgcHVibGljIG9wdGlvbnM6IFNsaWRlck9wdGlvbnNcclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgaWYgKHRoaXMuZWxlbWVudC5hdHRyKCdkYXRhLXNsaWRlcicpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGl0ZW1zID0gdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLml0ZW0pO1xyXG4gICAgICAgIGlmIChpdGVtcy5sZW5ndGggPCAyKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fbGVuZ3RoID0gaXRlbXMubGVuZ3RoO1xyXG4gICAgICAgIHRoaXMuX2JveCA9IGl0ZW1zLnBhcmVudCgpO1xyXG4gICAgICAgIHRoaXMuX2luaXQoaXRlbXMpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hdHRyKCdkYXRhLXNsaWRlcicsIDEpO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2RhdGE6IEFycmF5PFBvaW50PiA9IFtdO1xyXG5cclxuICAgIHByaXZhdGUgX2xlbmd0aDogbnVtYmVyID0gMDtcclxuXHJcbiAgICBwcml2YXRlIF9pbmRleDogbnVtYmVyID0gMDtcclxuXHJcbiAgICBwcml2YXRlIF9ib3g6IEpRdWVyeTtcclxuXHJcbiAgICBwcml2YXRlIF90aW1lOiBudW1iZXI7XHJcblxyXG4gICAgcHJpdmF0ZSBfdGltZUNhbGxiYWNrKCkge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYXV0bykge1xyXG4gICAgICAgICAgICB0aGlzLm5leHQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfaW5pdChpdGVtczogSlF1ZXJ5KSB7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gdGhpcztcclxuICAgICAgICBpdGVtcy5lYWNoKChpLCBpdGVtKT0+IHtcclxuICAgICAgICAgICAgbGV0IHBvaW50ID0gbmV3IFBvaW50KGksICQoaXRlbSkpO1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5fZGF0YS5wdXNoKHBvaW50KTtcclxuICAgICAgICB9KTtcclxuICAgICAgICAvKipcclxuICAgICAgICAgKiDlpI3liLbkuKTmrKFcclxuICAgICAgICAgKi9cclxuICAgICAgICBmb3IgKGxldCBqID0gMDsgaiA8IDI7IGogKyspIHtcclxuICAgICAgICAgICAgZm9yKGxldCBpID0gMCwgbGVuZ3RoID0gaXRlbXMubGVuZ3RoOyBpIDwgbGVuZ3RoOyBpICsrKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgbmV3TGkgPSAkKGl0ZW1zW2ldLmNsb25lTm9kZSh0cnVlKSk7XHJcbiAgICAgICAgICAgICAgICB0aGlzLl9kYXRhW2ldLmVsZW1lbnRzLnB1c2gobmV3TGkpO1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fYm94LmFwcGVuZChuZXdMaSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5yZXNpemUoKTtcclxuICAgICAgICAvLyDovpPlh7rlj6/ngrnlh7vnmoTliJfooahcclxuICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5oYXNQb2ludCkge1xyXG4gICAgICAgICAgICB0aGlzLl9hZGRMaXN0UG9pbnQoKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fYmluZEV2ZW50KCk7XHJcbiAgICAgICAgdGhpcy5fc2V0VGltZSgpO1xyXG4gICAgICAgIFxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2JpbmRFdmVudCgpIHtcclxuICAgICAgICBsZXQgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5maW5kKHRoaXMub3B0aW9ucy5wcmV2aW91cykuY2xpY2soZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnByZXZpb3VzKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmZpbmQodGhpcy5vcHRpb25zLm5leHQpLmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5uZXh0KCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgJCh3aW5kb3cpLnJlc2l6ZShmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgaW5zdGFuY2UucmVzaXplKCk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKCEkLmZuLnN3aXBlKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LnN3aXBlKHtcclxuICAgICAgICAgICAgc3dpcGVMZWZ0OiBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLm5leHQoKTtcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgc3dpcGVSaWdodDogZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5wcmV2aW91cygpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfZ2V0V2lkdGgocmVsdGl2ZTogbnVtYmVyKTogbnVtYmVyIHtcclxuICAgICAgICBpZiAocmVsdGl2ZSA+IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHJlbHRpdmU7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiB0aGlzLmVsZW1lbnQud2lkdGgoKSAqIHJlbHRpdmU7XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSBfc2V0VGltZSgpIHtcclxuICAgICAgICB0aGlzLl90aW1lID0gKHRoaXMub3B0aW9ucy5zcGFjZVRpbWUgKyB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uVGltZSkgLyAxNjtcclxuICAgIH1cclxuXHJcbiAgICAgICAvKipcclxuICAgICAqIOa3u+WKoOi3s+i9rOeCuVxyXG4gICAgICogQHBhcmFtIGNvdW50IFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9hZGRMaXN0UG9pbnQoKSB7XHJcbiAgICAgICAgbGV0IGh0bWwgPSAnJztcclxuICAgICAgICBsZXQgY291bnQgPSB0aGlzLl9sZW5ndGg7XHJcbiAgICAgICAgZm9yKDsgY291bnQgPiAwOyBjb3VudCAtLSkge1xyXG4gICAgICAgICAgICBodG1sICs9ICc8bGk+PC9pPic7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuZWxlbWVudC5hcHBlbmQoJzx1bCBjbGFzcz1cInNsaWRlci1wb2ludFwiPicrIGh0bWwgKyc8L3VsPicpO1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50Lm9uKFwiY2xpY2tcIiwgXCIuc2xpZGVyLXBvaW50IGxpXCIsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5pbmRleCA9ICQodGhpcykuaW5kZXgoKSArIDE7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDmtY/op4jlmajlsLrlr7jlj5jljJZcclxuICAgICAqL1xyXG4gICAgcHVibGljIHJlc2l6ZSgpIHtcclxuICAgICAgICBsZXQgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIGxldCBtYXhXaWR0aCA9IHRoaXMuZWxlbWVudC53aWR0aCgpO1xyXG4gICAgICAgIGxldCB3aWR0aCA9IDA7XHJcbiAgICAgICAgJC5lYWNoKHRoaXMuX2RhdGEsIGZ1bmN0aW9uKGksIHBvaW50KSB7XHJcbiAgICAgICAgICAgIGlmIChpbnN0YW5jZS5vcHRpb25zLndpZHRoID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcG9pbnQud2lkdGggPSBpbnN0YW5jZS5fZ2V0V2lkdGgoaW5zdGFuY2Uub3B0aW9ucy53aWR0aCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKGluc3RhbmNlLm9wdGlvbnMuaGVpZ2h0ID4gMCkge1xyXG4gICAgICAgICAgICAgICAgcG9pbnQuaGVpZ2h0ID0gaW5zdGFuY2UuX2dldFdpZHRoKGluc3RhbmNlLm9wdGlvbnMuaGVpZ2h0KTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBwb2ludC5hcHBseVdpZHRoQW5kSGVpZ2h0KCk7XHJcbiAgICAgICAgICAgIHdpZHRoICs9IHBvaW50LndpZHRoO1xyXG4gICAgICAgICAgICBwb2ludC54ID0gLXdpZHRoO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgICQuZWFjaCh0aGlzLl9kYXRhLCBmdW5jdGlvbihpLCBwb2ludCkge1xyXG4gICAgICAgICAgICBwb2ludC54IC09IHdpZHRoO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX2JveC5jc3Moe2xlZnQ6IHRoaXMuX2RhdGFbdGhpcy5faW5kZXhdLmdldExlZnQobWF4V2lkdGgpICsgXCJweFwifSk7XHJcbiAgICAgICAgdGhpcy5fYm94LndpZHRoKHdpZHRoICogMyk7XHJcbiAgICAgICAgdGhpcy5pbmRleCA9IHRoaXMuX2luZGV4O1xyXG4gICAgfVxyXG5cclxuICAgIGdldCBpbmRleCgpOiBudW1iZXIge1xyXG4gICAgICAgIHJldHVybiB0aGlzLl9pbmRleDtcclxuICAgIH1cclxuXHJcbiAgICBzZXQgaW5kZXgoaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuZ290byhpbmRleCk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDkuIvkuIDkuKpcclxuICAgICAqL1xyXG4gICAgcHVibGljIG5leHQoKSB7XHJcbiAgICAgICAgdGhpcy5pbmRleCArKztcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOS4iuS4gOS4qlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgcHJldmlvdXMoKSB7XHJcbiAgICAgICAgdGhpcy5pbmRleCAtLTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOiOt+WPlui1t+Wni+eCueWSjOe7iOeCuVxyXG4gICAgICogQHBhcmFtIGluZGV4IFxyXG4gICAgICovXHJcbiAgICBwcml2YXRlIF9nZXRQb2ludChpbmRleDogbnVtYmVyKTogUG9pbnRbXSB7XHJcbiAgICAgICAgaWYgKGluZGV4IDwgMCkge1xyXG4gICAgICAgICAgICBsZXQgbGFzdCA9IHRoaXMuX2RhdGFbdGhpcy5fZGF0YS5sZW5ndGggLSAxXTtcclxuICAgICAgICAgICAgbGV0IHBvaW50ID0gbmV3IFBvaW50KGluZGV4LCB0aGlzLl9kYXRhWzBdLnggKyBsYXN0LndpZHRoLCBsYXN0LndpZHRoLCBsYXN0LmhlaWdodCk7XHJcbiAgICAgICAgICAgIHJldHVybiBbcG9pbnQsIGxhc3RdO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoaW5kZXggPj0gdGhpcy5fZGF0YS5sZW5ndGgpIHtcclxuICAgICAgICAgICAgbGV0IGZpcnN0ID0gdGhpcy5fZGF0YVswXTtcclxuICAgICAgICAgICAgbGV0IHBvaW50ID0gbmV3IFBvaW50KGluZGV4LCB0aGlzLl9kYXRhW3RoaXMuX2RhdGEubGVuZ3RoIC0gMV0ueCAtIGZpcnN0LndpZHRoLCBmaXJzdC53aWR0aCwgZmlyc3QuaGVpZ2h0KTtcclxuICAgICAgICAgICAgcmV0dXJuIFtwb2ludCwgZmlyc3RdO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gW3RoaXMuX2RhdGFbaW5kZXhdLCB0aGlzLl9kYXRhW2luZGV4XV07XHJcbiAgICB9XHJcblxyXG4gICAgLyoqXHJcbiAgICAgKiDot7PovaxcclxuICAgICAqIEBwYXJhbSBpbmRleCBcclxuICAgICAqL1xyXG4gICAgcHVibGljIGdvdG8oaW5kZXg6IG51bWJlcikge1xyXG4gICAgICAgIHRoaXMuX3NldFRpbWUoKTtcclxuICAgICAgICBsZXQgcG9pbnRzID0gdGhpcy5fZ2V0UG9pbnQoaW5kZXgpO1xyXG4gICAgICAgIGxldCB3aWR0aCA9IHRoaXMuZWxlbWVudC53aWR0aCgpO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5oZWlnaHQocG9pbnRzWzBdLmhlaWdodCk7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gdGhpcztcclxuICAgICAgICB0aGlzLl9nb0FuZENhbGxiYWNrKHBvaW50c1swXS5nZXRMZWZ0KHdpZHRoKSwgZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGlmIChwb2ludHNbMF0uaW5kZXggIT0gcG9pbnRzWzFdLmluZGV4KSB7XHJcbiAgICAgICAgICAgICAgICBpbnN0YW5jZS5fYm94LmNzcyh7bGVmdDogcG9pbnRzWzFdLmdldExlZnQod2lkdGgpICsgJ3B4J30pO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluc3RhbmNlLl9pbmRleCA9IHBvaW50c1sxXS5pbmRleDtcclxuICAgICAgICB9KTtcclxuICAgICAgICB0aGlzLnRyaWdnZXIoJ2NoYW5nZScsIC4uLnBvaW50cyk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5oYXNQb2ludCkge1xyXG4gICAgICAgICAgICB0aGlzLmVsZW1lbnQuZmluZChcIi5zbGlkZXItcG9pbnQgbGlcIikuZXEoaW5kZXggLSAxKS5hZGRDbGFzcyhcImFjdGl2ZVwiKS5zaWJsaW5ncygpLnJlbW92ZUNsYXNzKFwiYWN0aXZlXCIpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOenu+WKqOWKqOeUu+WPiuWbnuiwg1xyXG4gICAgICogQHBhcmFtIGxlZnQgXHJcbiAgICAgKiBAcGFyYW0gY2FsbGJhY2sgXHJcbiAgICAgKi9cclxuICAgIHByaXZhdGUgX2dvQW5kQ2FsbGJhY2sobGVmdDogbnVtYmVyLCBjYWxsYmFjazogRnVuY3Rpb24pIHtcclxuICAgICAgICB0aGlzLl9ib3guYW5pbWF0ZShcclxuICAgICAgICAgICAge2xlZnQ6IGxlZnQgKyBcInB4XCJ9LCBcclxuICAgICAgICAgICAgdGhpcy5vcHRpb25zLmFuaW1hdGlvblRpbWUsIFxyXG4gICAgICAgICAgICB0aGlzLm9wdGlvbnMuYW5pbWF0aW9uTW9kZSwgXHJcbiAgICAgICAgICAgIGNhbGxiYWNrXHJcbiAgICAgICAgKTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcnVuKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl9sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5fdGltZSAtLTtcclxuICAgICAgICBpZiAodGhpcy5fdGltZSA8PSAwKSB7XHJcbiAgICAgICAgICAgIHRoaXMuX3RpbWVDYWxsYmFjaygpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxufSIsIi8qIVxyXG4gKiBqcXVlcnkuc2xpZGVyIC0gaHR0cHM6Ly9naXRodWIuY29tL3p4NjQ4MzgzMDc5L1pvRHJlYW0uVUlcclxuICogVmVyc2lvbiAtIDEuMFxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgLSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXHJcbiAqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNyBab0RyZWFtXHJcbiAqL1xyXG5jbGFzcyBTbGlkZXIge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIGVsZW1lbnQ6IEpRdWVyeSxcclxuICAgICAgICBvcHRpb25zPzogU2xpZGVyT3B0aW9uc1xyXG4gICAgKSB7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIG5ldyBTbGlkZXJEZWZhdWx0T3B0aW9ucygpLCBvcHRpb25zKTtcclxuICAgICAgICBpZiAodGhpcy5lbGVtZW50Lmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmVhY2goKGksIGl0ZW0pID0+IHtcclxuICAgICAgICAgICAgdGhpcy5hZGRJdGVtKCQoaXRlbSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgICAgIHRoaXMuX3J1blRpbWVyKCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9wdGlvbnM6IFNsaWRlck9wdGlvbnM7XHJcblxyXG4gICAgcHJpdmF0ZSBfZGF0YTogQXJyYXk8U2xpZGVySXRlbT4gPSBbXTtcclxuXHJcbiAgICBwcml2YXRlIF90aW1lcjogbnVtYmVyO1xyXG5cclxuICAgIHB1YmxpYyBhZGRJdGVtKGl0ZW06IFNsaWRlckl0ZW0gfCBKUXVlcnkpIHtcclxuICAgICAgICBpZiAoaXRlbSBpbnN0YW5jZW9mIFNsaWRlckl0ZW0pIHtcclxuICAgICAgICAgICAgdGhpcy5fZGF0YS5wdXNoKGl0ZW0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHRoaXMuX2RhdGEucHVzaChuZXcgU2xpZGVySXRlbShpdGVtLCB0aGlzLm9wdGlvbnMpKTtcclxuICAgIH1cclxuXHJcbiAgICAvKipcclxuICAgICAqIOWAkuW6j+W+queOr1xyXG4gICAgICogQHBhcmFtIGNhbGxiYWNrIOi/lOWbnmZhbHNlIOe7k+adn+W+queOr++8jOi/lOWbniB0cnVlIOWIoOmZpFxyXG4gICAgICogQHBhcmFtIGkg5Yid5aeL5YC8XHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBtYXAoY2FsbGJhY2s6IChpdGVtOiBTbGlkZXJJdGVtLCBpbmRleDogbnVtYmVyKSA9PiBhbnksIGk6IG51bWJlciB8IG51bWJlcltdID0gdGhpcy5fZGF0YS5sZW5ndGggLSAxKSB7XHJcbiAgICAgICAgaWYgKHR5cGVvZiBpICE9ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIGkuZm9yRWFjaChqID0+IHtcclxuICAgICAgICAgICAgICAgIGlmIChqIDwgMCB8fCBqID49IHRoaXMuX2RhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgY2FsbGJhY2sodGhpcy5fZGF0YVtqXSwgaik7XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChpID49IHRoaXMuX2RhdGEubGVuZ3RoKSB7XHJcbiAgICAgICAgICAgIGkgPSB0aGlzLl9kYXRhLmxlbmd0aCAtIDE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGZvciAoOyBpID49IDA7IGkgLS0pIHtcclxuICAgICAgICAgICAgbGV0IGl0ZW0gPSB0aGlzLl9kYXRhW2ldO1xyXG4gICAgICAgICAgICBsZXQgcmVzdWx0ID0gY2FsbGJhY2soaXRlbSwgaSk7XHJcbiAgICAgICAgICAgIGlmIChyZXN1bHQgPT0gdHJ1ZSkge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5fZGF0YS5zcGxpY2UoaSwgMSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaWYgKHJlc3VsdCA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX3J1blRpbWVyKCkge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5fdGltZXIgPSByZXF1ZXN0QW5pbWF0aW9uRnJhbWUoZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLm1hcChpdGVtPT4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbS5ydW4oKTtcclxuICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLl9ydW5UaW1lcigpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHByaXZhdGUgX2NhbmNlbFRpbWVyKCkge1xyXG4gICAgICAgIGlmICh0aGlzLl90aW1lcikge1xyXG4gICAgICAgICAgICBjYW5jZWxBbmltYXRpb25GcmFtZSh0aGlzLl90aW1lcik7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59XHJcblxyXG5pbnRlcmZhY2UgU2xpZGVyT3B0aW9ucyB7XHJcbiAgICBpdGVtPzogc3RyaW5nLFxyXG4gICAgYm94Pzogc3RyaW5nLFxyXG4gICAgd2lkdGg/OiBudW1iZXIsICAgLy/nu5/kuIDmjIflrprlrr3luqZcclxuICAgIGhlaWdodD86IG51bWJlciwgIC8v57uf5LiA5oyH5a6a6auY5bqm77yMIOWwj+aVsOaXtuW3smJveOeahOWuveW6puS4uuWHhlxyXG4gICAgc3BhY2VUaW1lPzogbnVtYmVyLFxyXG4gICAgYW5pbWF0aW9uVGltZT86IG51bWJlcixcclxuICAgIGFuaW1hdGlvbk1vZGU/OiBzdHJpbmcsXHJcbiAgICBwcmV2aW91cz86IHN0cmluZyxcclxuICAgIG5leHQ/OiBzdHJpbmcsXHJcbiAgICBoYXNQb2ludD86IGJvb2xlYW4sICAgLy/mmK/lkKbmnInngrnlh7vot7PovaxcclxuICAgIGF1dG8/OiBib29sZWFuLCAgLy/mmK/lkKboh6rliqjmkq3mlL5cclxuICAgIG9uY2hhbmdlPzogKHN0YXJ0OiBQb2ludCwgZW5kOiBQb2ludCkgPT4gYW55OyAvL+WIh+aNouS6i+S7tlxyXG59XHJcblxyXG5jbGFzcyBTbGlkZXJEZWZhdWx0T3B0aW9ucyBpbXBsZW1lbnRzIFNsaWRlck9wdGlvbnMge1xyXG4gICAgaXRlbTogc3RyaW5nID0gJ2xpJztcclxuICAgIHNwYWNlVGltZTogbnVtYmVyID0gMzAwMDtcclxuICAgIGFuaW1hdGlvblRpbWU6IG51bWJlciA9IDEwMDA7XHJcbiAgICBhbmltYXRpb25Nb2RlOiBzdHJpbmcgPSBcInN3aW5nXCI7XHJcbiAgICBwcmV2aW91czogc3RyaW5nID0gXCIuc2xpZGVyLXByZXZpb3VzXCI7XHJcbiAgICBuZXh0OiBzdHJpbmcgPSBcIi5zbGlkZXItbmV4dFwiO1xyXG4gICAgaGFzUG9pbnQ6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgYXV0bzogYm9vbGVhbiA9IHRydWU7XHJcbn1cclxuXHJcblxyXG4gOyhmdW5jdGlvbigkOiBhbnkpIHtcclxuICAkLmZuLnNsaWRlciA9IGZ1bmN0aW9uKG9wdGlvbnMgPzogU2xpZGVyT3B0aW9ucykge1xyXG4gICAgcmV0dXJuIG5ldyBTbGlkZXIodGhpcywgb3B0aW9ucyk7IFxyXG4gIH07XHJcbn0pKGpRdWVyeSk7Il19
