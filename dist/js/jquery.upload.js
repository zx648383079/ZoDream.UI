var __extends = (this && this.__extends) || (function () {
    var extendStatics = function (d, b) {
        extendStatics = Object.setPrototypeOf ||
            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
            function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
        return extendStatics(d, b);
    };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var __spreadArrays = (this && this.__spreadArrays) || function () {
    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;
    for (var r = Array(s), k = 0, i = 0; i < il; i++)
        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)
            r[k] = a[j];
    return r;
};
var Eve = /** @class */ (function () {
    function Eve() {
    }
    Eve.prototype.on = function (event, callback) {
        this.options['on' + event] = callback;
        return this;
    };
    Eve.prototype.hasEvent = function (event) {
        return this.options.hasOwnProperty('on' + event);
    };
    Eve.prototype.trigger = function (event) {
        var _a;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var realEvent = 'on' + event;
        if (!this.hasEvent(event)) {
            return;
        }
        return (_a = this.options[realEvent]).call.apply(_a, __spreadArrays([this], args));
    };
    return Eve;
}());
/*!
 * jquery.upload - https://github.com/zx648383079/ZoDream.UI
 * Version - 1.0
 * Licensed under the MIT license - http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2017 ZoDream
 */
/**
 * EXAMPLE:
 * $('#upload').upload({
 *      url: 'upload.php',
 *      name: 'file',
 *      template: '{url}',
 *      grid: '.img'
 * });
 */
var Upload = /** @class */ (function (_super) {
    __extends(Upload, _super);
    function Upload(element, option) {
        var _this_1 = _super.call(this) || this;
        _this_1.element = element;
        _this_1.options = $.extend({}, new UploadDefaultOption(), option);
        _this_1.options.data = $.extend({}, _this_1.options.data, _this_1.getData());
        _this_1.getElement = _this_1.options.getElement.bind(_this_1);
        if (_this_1.element) {
            _this_1.addEvent();
        }
        return _this_1;
    }
    Upload.prototype.addEvent = function () {
        var _this = this;
        this.element.click(function () {
            _this.start($(this));
        });
        if (this.options.grid) {
            $(this.options.grid).on('click', this.options.removeTag, this.options.removeCallback);
        }
    };
    Upload.prototype.start = function (currentElement) {
        this.currentElement = currentElement;
        var _this = this;
        var element = $('.' + this.options.fileClass);
        if (element.length < 1) {
            var file = document.createElement('input');
            file.type = 'file';
            file.className = this.options.fileClass;
            file.multiple = this.options.multiple;
            file.accept = this.options.filter;
            document.body.appendChild(file);
            element = $(file).bind('change', function () {
                _this.uploadFiles(this.files);
            }).hide();
        }
        else {
            element.val('');
            element.attr('multiple', this.options.multiple ? 'true' : 'false');
            element.attr('accept', this.options.filter);
            if (this.options.dynamic) {
                element.unbind('change').bind('change', function () {
                    _this.uploadFiles(this.files);
                });
            }
        }
        element.click();
    };
    Upload.prototype.uploadFiles = function (files) {
        if (this.options.allowMultiple) {
            this.uploadMany(files);
            return;
        }
        var _this = this;
        $.each(files, function (i, file) {
            _this.uploadOne(file);
        });
    };
    Upload.prototype.uploadMany = function (files) {
        var _this = this, data;
        if (this.options.ondealfile) {
            data = this.options.ondealfiles.call(this, files);
        }
        else {
            data = new FormData();
            $.each(files, function (i, file) {
                data.append(_this.options.name, file);
            });
        }
        if (this.trigger('before', data, this.currentElement) === false) {
            console.log('before upload is false');
            return;
        }
        this.uploadForm(data, function (data) {
            if (data instanceof Array) {
                $.each(data, function (i, item) {
                    _this.deal($.extend({}, _this.options.data, item));
                });
                return;
            }
            _this.deal($.extend({}, _this.options.data, data));
        });
    };
    Upload.prototype.uploadOne = function (file) {
        var _this = this, data, deal_data = this.trigger('dealfile', file);
        if (deal_data === false) {
            console.log('deal file is false');
            return;
        }
        if (deal_data) {
            data = deal_data;
        }
        else {
            data = new FormData();
            data.append(this.options.name, file);
        }
        if (this.trigger('before', data, this.currentElement) === false) {
            console.log('before upload is false');
            return;
        }
        this.uploadForm(data, function (data) {
            _this.deal($.extend({}, _this.options.data, data));
        });
    };
    Upload.prototype.uploadForm = function (data, cb) {
        var _this = this;
        var opts = {
            url: this.options.url,
            type: 'POST',
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                data = _this.trigger('after', data, _this.currentElement);
                if (data == false) {
                    console.log('after upload is false');
                    return;
                }
                cb && cb(data);
            }
        };
        if (this.options.timeout) {
            opts['timeout'] = this.options.timeout;
        }
        if (_this.options.onprogress) {
            opts['xhr'] = function () {
                var xhr = $.ajaxSettings.xhr();
                if (_this.options.onprogress && xhr.upload) {
                    xhr.upload.addEventListener('progress', _this.options.onprogress, false);
                }
                return xhr;
            };
        }
        $.ajax(opts);
    };
    Upload.prototype.formatFileSize = function (fileSize) {
        var sizeUnitArr = ['Byte', 'KB', 'MB', 'GB'];
        if (fileSize == 0) {
            return "0 KB";
        }
        var i = Math.floor(Math.log(fileSize) / Math.log(1024));
        if (i == 0) {
            return fileSize + sizeUnitArr[i];
        }
        return (fileSize / Math.pow(1024, i)).toFixed(1) + sizeUnitArr[i];
    };
    Upload.prototype.sliceUpload = function (file, cb) {
        var maxLength = 1024 * 1024, _this = this, totalSize = file.size, name, chunks = Math.ceil(totalSize / maxLength), chunk = 0, startUpload = function () {
            var blobFrom = chunk * maxLength, blobTo = Math.min((chunk + 1) * maxLength, totalSize), data = new FormData();
            data.append(_this.options.name, file.slice(blobFrom, blobTo));
            if (name) {
                data.append('name', name);
            }
            data.append('real_name', file.name);
            data.append('total', totalSize + '');
            data.append('status', (chunk == (chunks - 1) ? 2 : (chunk == 0 ? 0 : 1)) + '');
            _this.uploadForm(data, function (res) {
                cb && cb({
                    total: totalSize,
                    size: blobTo
                }, _this.currentElement);
                if (chunk === (chunks - 1)) {
                    _this.deal($.extend({}, _this.options.data, res));
                    return;
                }
                name = res.name;
                chunk++;
                startUpload();
            });
        };
        startUpload();
    };
    /** 图片压缩 start  */
    Upload.prototype.photoCompress = function (file, options, cb) {
        var ready = new FileReader(), _this = this;
        /*开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个data: URL格式的字符串以表示所读取文件的内容.*/
        ready.readAsDataURL(file);
        ready.onload = function () {
            var re = this.result;
            _this._canvasDataURL(re, options, cb);
        };
    };
    Upload.prototype._canvasDataURL = function (path, obj, callback) {
        var img = new Image();
        img.src = path;
        img.onload = function () {
            var that = this;
            // 默认按比例压缩
            var w = that.width, h = that.height, scale = w / h;
            w = obj.width || w;
            h = obj.height || (w / scale);
            var quality = 0.7; // 默认图片质量为0.7
            //生成canvas
            var canvas = document.createElement('canvas'), ctx = canvas.getContext('2d');
            // 创建属性节点
            var anw = document.createAttribute("width");
            anw.nodeValue = w + '';
            var anh = document.createAttribute("height");
            anh.nodeValue = h + '';
            canvas.setAttributeNode(anw);
            canvas.setAttributeNode(anh);
            ctx.drawImage(that, 0, 0, w, h);
            // 图像质量
            if (obj.quality && obj.quality <= 1 && obj.quality > 0) {
                quality = obj.quality;
            }
            // quality值越小，所绘制出的图像越模糊
            var base64 = canvas.toDataURL('image/jpeg', quality);
            // 回调函数返回base64的值
            callback(base64);
        };
    };
    /**
     * 将以base64的图片url数据转换为Blob
     * @param urlData
     *            用url方式表示的base64图片数据
     */
    Upload.prototype.convertBase64UrlToBlob = function (urlData) {
        var arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
        while (n--) {
            u8arr[n] = bstr.charCodeAt(n);
        }
        return new Blob([u8arr], { type: mime });
    };
    /** 压缩处理end  */
    Upload.prototype.deal = function (data) {
        var value = typeof this.options.template == 'function' ? this.options.template.call(this, data) : this.replace(data);
        if (value == false) {
            console.log('template is false');
            return;
        }
        if (false === this.trigger('success', data, this.currentElement)) {
            console.log('success is false');
            return;
        }
        var urlFor = this.options.grid;
        if (this.currentElement && this.currentElement.length > 0) {
            urlFor = this.currentElement.attr('data-grid') || this.options.grid;
        }
        if (!urlFor) {
            console.log('grid element is false');
            return;
        }
        var tags = urlFor.split('|');
        var _this = this;
        tags.forEach(function (tag) {
            var item = _this.getElement(tag, _this.currentElement);
            if (item.length == 0) {
                return;
            }
            item.each(function (i, element) {
                var ele = $(element);
                if (ele.is('input') || ele.is('textarea')) {
                    ele.val(value);
                    return;
                }
                if (ele.is('img')) {
                    ele.attr('src', value);
                    return;
                }
                if (_this.options.isAppend) {
                    ele.append(value);
                }
                else {
                    ele.prepend(value);
                }
            });
        });
    };
    Upload.prototype.getData = function () {
        if (!this.element || this.element.length < 1) {
            return {};
        }
        var data = {};
        var arg = this.element.attr('data-data');
        if (!arg) {
            return data;
        }
        var args = arg.split(',');
        args.forEach(function (item) {
            var keyValue = item.split(':');
            var key = keyValue[0].trim();
            if (key) {
                data[key] = keyValue[1].trim();
            }
        });
        return data;
    };
    Upload.prototype.replace = function (data) {
        var html = typeof this.options.template == 'function' ? this.options.template.call(this, data) : this.options.template;
        for (var i in data) {
            if (data.hasOwnProperty(i)) {
                html = html.replace(new RegExp('{' + i + '}', 'g'), data[i]);
            }
        }
        return html;
    };
    return Upload;
}(Eve));
var UploadDefaultOption = /** @class */ (function () {
    function UploadDefaultOption() {
        this.name = 'file';
        this.isAppend = true;
        this.template = '{url}';
        //grid: string = '.zdGrid';
        this.removeTag = '.delete';
        this.removeCallback = function () {
            $(this).parent().remove();
        };
        this.multiple = false;
        this.allowMultiple = false;
        this.data = {};
        this.fileClass = 'zdUploadFile';
        this.filter = '';
        this.onafter = function (data) {
            // 防止ajax自动转化json
            if (typeof data != 'object') {
                data = JSON.parse(data);
            }
            if (data.code == 0) {
                return data.data;
            }
            return false;
        };
        this.dynamic = true;
        this.getElement = function (tag) {
            return $(tag);
        };
        // ondealfile: (file: File) => FormData| void = function(file: File) {
        //     if(file.size/1024 > 1025) { //大于1M，进行压缩上传
        //         this.photoCompress(file, {
        //             quality: 0.2
        //         }, function(base64Codes){
        //             //console.log("压缩后：" + base.length / 1024 + " " + base);
        //             let data = new FormData();
        //             let bl = this.convertBase64UrlToBlob(base64Codes);
        //             data.append("file", bl, "file_"+new Date().getTime()+".jpg"); // 文件对象
        //             this.uploadForm(data);
        //         });
        //         return;
        //     }
        // }
    }
    return UploadDefaultOption;
}());
;
(function ($) {
    $.fn.upload = function (option) {
        return new Upload(this, option);
    };
})(jQuery);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV2ZW50LnRzIiwianF1ZXJ5LnVwbG9hZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7Ozs7Ozs7Ozs7OztBQUFBO0lBQUE7SUFtQkEsQ0FBQTtJQWhCQSxnQkFBQSxHQUFBLFVBQUEsS0FBQSxFQUFBLFFBQUE7UUFDQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsR0FBQSxLQUFBLENBQUEsR0FBQSxRQUFBLENBQUE7UUFDQSxPQUFBLElBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQSxzQkFBQSxHQUFBLFVBQUEsS0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsSUFBQSxHQUFBLEtBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLHFCQUFBLEdBQUEsVUFBQSxLQUFBOztRQUFBLGNBQUE7YUFBQSxVQUFBLEVBQUEscUJBQUEsRUFBQSxJQUFBO1lBQUEsNkJBQUE7O1FBQ0EsSUFBQSxTQUFBLEdBQUEsSUFBQSxHQUFBLEtBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFBO1lBQ0EsT0FBQTtTQUNBO1FBQ0EsT0FBQSxDQUFBLEtBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsMkJBQUEsSUFBQSxHQUFBLElBQUEsR0FBQTtJQUNBLENBQUE7SUFDQSxVQUFBO0FBQUEsQ0FuQkEsQUFtQkEsSUFBQTtBQ25CQTs7Ozs7O0dBTUE7QUFDQTs7Ozs7Ozs7R0FRQTtBQUNBO0lBQUEsMEJBQUE7SUFDQSxnQkFDQSxPQUFBLEVBQ0EsTUFBQTtRQUZBLGNBSUEsaUJBQUEsU0FPQTtRQVZBLGVBQUEsR0FBQSxPQUFBLENBQUE7UUFJQSxPQUFBLENBQUEsT0FBQSxHQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsRUFBQSxFQUFBLElBQUEsbUJBQUEsRUFBQSxFQUFBLE1BQUEsQ0FBQSxDQUFBO1FBQ0EsT0FBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLEdBQUEsQ0FBQSxDQUFBLE1BQUEsQ0FBQSxFQUFBLEVBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLEVBQUEsT0FBQSxDQUFBLE9BQUEsRUFBQSxDQUFBLENBQUE7UUFDQSxPQUFBLENBQUEsVUFBQSxHQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsT0FBQSxDQUFBLE9BQUEsRUFBQTtZQUNBLE9BQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQTtTQUNBOztJQUNBLENBQUE7SUFVQSx5QkFBQSxHQUFBO1FBQ0EsSUFBQSxLQUFBLEdBQUEsSUFBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBLENBQUE7WUFDQSxLQUFBLENBQUEsS0FBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBO1lBQ0EsQ0FBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsRUFBQSxDQUFBLE9BQUEsRUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsRUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBO1NBQ0E7SUFDQSxDQUFBO0lBRUEsc0JBQUEsR0FBQSxVQUFBLGNBQUE7UUFDQSxJQUFBLENBQUEsY0FBQSxHQUFBLGNBQUEsQ0FBQTtRQUNBLElBQUEsS0FBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLElBQUEsT0FBQSxHQUFBLENBQUEsQ0FBQSxHQUFBLEdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsT0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLEVBQUE7WUFDQSxJQUFBLElBQUEsR0FBQSxRQUFBLENBQUEsYUFBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLElBQUEsR0FBQSxNQUFBLENBQUE7WUFDQSxJQUFBLENBQUEsU0FBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLFFBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQTtZQUNBLElBQUEsQ0FBQSxNQUFBLEdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxNQUFBLENBQUE7WUFDQSxRQUFBLENBQUEsSUFBQSxDQUFBLFdBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUEsR0FBQSxDQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQTtnQkFDQSxLQUFBLENBQUEsV0FBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsQ0FBQTtZQUNBLENBQUEsQ0FBQSxDQUFBLElBQUEsRUFBQSxDQUFBO1NBQ0E7YUFBQTtZQUNBLE9BQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxDQUFBLENBQUE7WUFDQSxPQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsRUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLENBQUEsTUFBQSxDQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUEsQ0FBQSxJQUFBLENBQUEsUUFBQSxFQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7WUFDQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxFQUFBO2dCQUNBLE9BQUEsQ0FBQSxNQUFBLENBQUEsUUFBQSxDQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQTtvQkFDQSxLQUFBLENBQUEsV0FBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsQ0FBQTtnQkFDQSxDQUFBLENBQUEsQ0FBQTthQUNBO1NBQ0E7UUFDQSxPQUFBLENBQUEsS0FBQSxFQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsNEJBQUEsR0FBQSxVQUFBLEtBQUE7UUFDQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsYUFBQSxFQUFBO1lBQ0EsSUFBQSxDQUFBLFVBQUEsQ0FBQSxLQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsS0FBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQSxJQUFBLENBQUEsS0FBQSxFQUFBLFVBQUEsQ0FBQSxFQUFBLElBQUE7WUFDQSxLQUFBLENBQUEsU0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsMkJBQUEsR0FBQSxVQUFBLEtBQUE7UUFDQSxJQUFBLEtBQUEsR0FBQSxJQUFBLEVBQ0EsSUFBQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsRUFBQTtZQUNBLElBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFdBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxFQUFBLEtBQUEsQ0FBQSxDQUFBO1NBQ0E7YUFBQTtZQUNBLElBQUEsR0FBQSxJQUFBLFFBQUEsRUFBQSxDQUFBO1lBQ0EsQ0FBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLEVBQUEsVUFBQSxDQUFBLEVBQUEsSUFBQTtnQkFDQSxJQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBO1lBQ0EsQ0FBQSxDQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxjQUFBLENBQUEsS0FBQSxLQUFBLEVBQUE7WUFDQSxPQUFBLENBQUEsR0FBQSxDQUFBLHdCQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsQ0FBQSxVQUFBLENBQUEsSUFBQSxFQUFBLFVBQUEsSUFBQTtZQUNBLElBQUEsSUFBQSxZQUFBLEtBQUEsRUFBQTtnQkFDQSxDQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsRUFBQSxVQUFBLENBQUEsRUFBQSxJQUFBO29CQUNBLEtBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLE1BQUEsQ0FBQSxFQUFBLEVBQUEsS0FBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQTtnQkFDQSxDQUFBLENBQUEsQ0FBQTtnQkFDQSxPQUFBO2FBQ0E7WUFDQSxLQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsRUFBQSxFQUFBLEtBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUE7UUFDQSxDQUFBLENBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQSwwQkFBQSxHQUFBLFVBQUEsSUFBQTtRQUNBLElBQUEsS0FBQSxHQUFBLElBQUEsRUFDQSxJQUFBLEVBQ0EsU0FBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxTQUFBLEtBQUEsS0FBQSxFQUFBO1lBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSxvQkFBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxJQUFBLFNBQUEsRUFBQTtZQUNBLElBQUEsR0FBQSxTQUFBLENBQUE7U0FDQTthQUFBO1lBQ0EsSUFBQSxHQUFBLElBQUEsUUFBQSxFQUFBLENBQUE7WUFDQSxJQUFBLENBQUEsTUFBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBO1NBQ0E7UUFFQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsY0FBQSxDQUFBLEtBQUEsS0FBQSxFQUFBO1lBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSx3QkFBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxJQUFBLENBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxVQUFBLElBQUE7WUFDQSxLQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsRUFBQSxFQUFBLEtBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUE7UUFDQSxDQUFBLENBQUEsQ0FBQTtJQUNBLENBQUE7SUFFQSwyQkFBQSxHQUFBLFVBQUEsSUFBQSxFQUFBLEVBQUE7UUFDQSxJQUFBLEtBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxJQUFBLElBQUEsR0FBQTtZQUNBLEdBQUEsRUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLEdBQUE7WUFDQSxJQUFBLEVBQUEsTUFBQTtZQUNBLElBQUEsRUFBQSxJQUFBO1lBQ0EsS0FBQSxFQUFBLEtBQUE7WUFDQSxXQUFBLEVBQUEsS0FBQTtZQUNBLFdBQUEsRUFBQSxLQUFBO1lBQ0EsT0FBQSxFQUFBLFVBQUEsSUFBQTtnQkFDQSxJQUFBLEdBQUEsS0FBQSxDQUFBLE9BQUEsQ0FBQSxPQUFBLEVBQUEsSUFBQSxFQUFBLEtBQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtnQkFDQSxJQUFBLElBQUEsSUFBQSxLQUFBLEVBQUE7b0JBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSx1QkFBQSxDQUFBLENBQUE7b0JBQ0EsT0FBQTtpQkFDQTtnQkFDQSxFQUFBLElBQUEsRUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO1lBQ0EsQ0FBQTtTQUNBLENBQUE7UUFDQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxFQUFBO1lBQ0EsSUFBQSxDQUFBLFNBQUEsQ0FBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBO1NBQ0E7UUFDQSxJQUFBLEtBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxFQUFBO1lBQ0EsSUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBO2dCQUNBLElBQUEsR0FBQSxHQUFBLENBQUEsQ0FBQSxZQUFBLENBQUEsR0FBQSxFQUFBLENBQUE7Z0JBQ0EsSUFBQSxLQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsSUFBQSxHQUFBLENBQUEsTUFBQSxFQUFBO29CQUNBLEdBQUEsQ0FBQSxNQUFBLENBQUEsZ0JBQUEsQ0FBQSxVQUFBLEVBQUEsS0FBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUEsS0FBQSxDQUFBLENBQUE7aUJBQ0E7Z0JBQ0EsT0FBQSxHQUFBLENBQUE7WUFDQSxDQUFBLENBQUE7U0FDQTtRQUNBLENBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsK0JBQUEsR0FBQSxVQUFBLFFBQUE7UUFDQSxJQUFBLFdBQUEsR0FBQSxDQUFBLE1BQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxRQUFBLElBQUEsQ0FBQSxFQUFBO1lBQ0EsT0FBQSxNQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsQ0FBQSxHQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxRQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsR0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsSUFBQSxDQUFBLEVBQUE7WUFDQSxPQUFBLFFBQUEsR0FBQSxXQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7U0FDQTtRQUNBLE9BQUEsQ0FBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsV0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUdBLDRCQUFBLEdBQUEsVUFBQSxJQUFBLEVBQUEsRUFBQTtRQUNBLElBQUEsU0FBQSxHQUFBLElBQUEsR0FBQSxJQUFBLEVBQ0EsS0FBQSxHQUFBLElBQUEsRUFDQSxTQUFBLEdBQUEsSUFBQSxDQUFBLElBQUEsRUFDQSxJQUFBLEVBQ0EsTUFBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLENBQUEsU0FBQSxHQUFBLFNBQUEsQ0FBQSxFQUNBLEtBQUEsR0FBQSxDQUFBLEVBQ0EsV0FBQSxHQUFBO1lBQ0EsSUFBQSxRQUFBLEdBQUEsS0FBQSxHQUFBLFNBQUEsRUFDQSxNQUFBLEdBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLEtBQUEsR0FBQSxDQUFBLENBQUEsR0FBQSxTQUFBLEVBQUEsU0FBQSxDQUFBLEVBQ0EsSUFBQSxHQUFBLElBQUEsUUFBQSxFQUFBLENBQUE7WUFDQSxJQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsUUFBQSxFQUFBLE1BQUEsQ0FBQSxDQUFBLENBQUE7WUFDQSxJQUFBLElBQUEsRUFBQTtnQkFDQSxJQUFBLENBQUEsTUFBQSxDQUFBLE1BQUEsRUFBQSxJQUFBLENBQUEsQ0FBQTthQUNBO1lBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxXQUFBLEVBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxPQUFBLEVBQUEsU0FBQSxHQUFBLEVBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxRQUFBLEVBQUEsQ0FBQSxLQUFBLElBQUEsQ0FBQSxNQUFBLEdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsRUFBQSxDQUFBLENBQUE7WUFDQSxLQUFBLENBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxVQUFBLEdBQUE7Z0JBQ0EsRUFBQSxJQUFBLEVBQUEsQ0FBQTtvQkFDQSxLQUFBLEVBQUEsU0FBQTtvQkFDQSxJQUFBLEVBQUEsTUFBQTtpQkFDQSxFQUFBLEtBQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtnQkFDQSxJQUFBLEtBQUEsS0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLENBQUEsRUFBQTtvQkFDQSxLQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsRUFBQSxFQUFBLEtBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLEdBQUEsQ0FBQSxDQUFBLENBQUE7b0JBQ0EsT0FBQTtpQkFDQTtnQkFDQSxJQUFBLEdBQUEsR0FBQSxDQUFBLElBQUEsQ0FBQTtnQkFDQSxLQUFBLEVBQUEsQ0FBQTtnQkFDQSxXQUFBLEVBQUEsQ0FBQTtZQUNBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBO1FBQ0EsV0FBQSxFQUFBLENBQUE7SUFDQSxDQUFBO0lBR0Esa0JBQUE7SUFFQSw4QkFBQSxHQUFBLFVBQUEsSUFBQSxFQUFBLE9BQUEsRUFBQSxFQUFBO1FBQ0EsSUFBQSxLQUFBLEdBQUEsSUFBQSxVQUFBLEVBQUEsRUFDQSxLQUFBLEdBQUEsSUFBQSxDQUFBO1FBQ0EsbUlBQUE7UUFDQSxLQUFBLENBQUEsYUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO1FBQ0EsS0FBQSxDQUFBLE1BQUEsR0FBQTtZQUNBLElBQUEsRUFBQSxHQUFBLElBQUEsQ0FBQSxNQUFBLENBQUE7WUFDQSxLQUFBLENBQUEsY0FBQSxDQUFBLEVBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQSxDQUFBLENBQUE7UUFDQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBQ0EsK0JBQUEsR0FBQSxVQUFBLElBQUEsRUFBQSxHQUFBLEVBQUEsUUFBQTtRQUNBLElBQUEsR0FBQSxHQUFBLElBQUEsS0FBQSxFQUFBLENBQUE7UUFDQSxHQUFBLENBQUEsR0FBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLEdBQUEsQ0FBQSxNQUFBLEdBQUE7WUFDQSxJQUFBLElBQUEsR0FBQSxJQUFBLENBQUE7WUFDQSxVQUFBO1lBQ0EsSUFBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLEtBQUEsRUFDQSxDQUFBLEdBQUEsSUFBQSxDQUFBLE1BQUEsRUFDQSxLQUFBLEdBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtZQUNBLENBQUEsR0FBQSxHQUFBLENBQUEsS0FBQSxJQUFBLENBQUEsQ0FBQTtZQUNBLENBQUEsR0FBQSxHQUFBLENBQUEsTUFBQSxJQUFBLENBQUEsQ0FBQSxHQUFBLEtBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxPQUFBLEdBQUEsR0FBQSxDQUFBLENBQUEsYUFBQTtZQUNBLFVBQUE7WUFDQSxJQUFBLE1BQUEsR0FBQSxRQUFBLENBQUEsYUFBQSxDQUFBLFFBQUEsQ0FBQSxFQUNBLEdBQUEsR0FBQSxNQUFBLENBQUEsVUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO1lBQ0EsU0FBQTtZQUNBLElBQUEsR0FBQSxHQUFBLFFBQUEsQ0FBQSxlQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7WUFDQSxHQUFBLENBQUEsU0FBQSxHQUFBLENBQUEsR0FBQSxFQUFBLENBQUE7WUFDQSxJQUFBLEdBQUEsR0FBQSxRQUFBLENBQUEsZUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBO1lBQ0EsR0FBQSxDQUFBLFNBQUEsR0FBQSxDQUFBLEdBQUEsRUFBQSxDQUFBO1lBQ0EsTUFBQSxDQUFBLGdCQUFBLENBQUEsR0FBQSxDQUFBLENBQUE7WUFDQSxNQUFBLENBQUEsZ0JBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtZQUNBLEdBQUEsQ0FBQSxTQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsQ0FBQSxDQUFBO1lBQ0EsT0FBQTtZQUNBLElBQUEsR0FBQSxDQUFBLE9BQUEsSUFBQSxHQUFBLENBQUEsT0FBQSxJQUFBLENBQUEsSUFBQSxHQUFBLENBQUEsT0FBQSxHQUFBLENBQUEsRUFBQTtnQkFDQSxPQUFBLEdBQUEsR0FBQSxDQUFBLE9BQUEsQ0FBQTthQUNBO1lBQ0Esd0JBQUE7WUFDQSxJQUFBLE1BQUEsR0FBQSxNQUFBLENBQUEsU0FBQSxDQUFBLFlBQUEsRUFBQSxPQUFBLENBQUEsQ0FBQTtZQUNBLGlCQUFBO1lBQ0EsUUFBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUNBOzs7O09BSUE7SUFDQSx1Q0FBQSxHQUFBLFVBQUEsT0FBQTtRQUNBLElBQUEsR0FBQSxHQUFBLE9BQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsSUFBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxLQUFBLENBQUEsU0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEVBQ0EsSUFBQSxHQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLE1BQUEsRUFBQSxLQUFBLEdBQUEsSUFBQSxVQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7UUFDQSxPQUFBLENBQUEsRUFBQSxFQUFBO1lBQ0EsS0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLElBQUEsQ0FBQSxVQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7U0FDQTtRQUNBLE9BQUEsSUFBQSxJQUFBLENBQUEsQ0FBQSxLQUFBLENBQUEsRUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLEVBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLGVBQUE7SUFFQSxxQkFBQSxHQUFBLFVBQUEsSUFBQTtRQUNBLElBQUEsS0FBQSxHQUFBLE9BQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLElBQUEsVUFBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsQ0FBQSxJQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxLQUFBLElBQUEsS0FBQSxFQUFBO1lBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSxtQkFBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxJQUFBLEtBQUEsS0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLGNBQUEsQ0FBQSxFQUFBO1lBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSxrQkFBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxJQUFBLE1BQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQTtRQUNBLElBQUEsSUFBQSxDQUFBLGNBQUEsSUFBQSxJQUFBLENBQUEsY0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLEVBQUE7WUFDQSxNQUFBLEdBQUEsSUFBQSxDQUFBLGNBQUEsQ0FBQSxJQUFBLENBQUEsV0FBQSxDQUFBLElBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsQ0FBQSxNQUFBLEVBQUE7WUFDQSxPQUFBLENBQUEsR0FBQSxDQUFBLHVCQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsSUFBQSxHQUFBLE1BQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLEtBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsR0FBQTtZQUNBLElBQUEsSUFBQSxHQUFBLEtBQUEsQ0FBQSxVQUFBLENBQUEsR0FBQSxFQUFBLEtBQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtZQUNBLElBQUEsSUFBQSxDQUFBLE1BQUEsSUFBQSxDQUFBLEVBQUE7Z0JBQ0EsT0FBQTthQUNBO1lBQ0EsSUFBQSxDQUFBLElBQUEsQ0FBQSxVQUFBLENBQUEsRUFBQSxPQUFBO2dCQUNBLElBQUEsR0FBQSxHQUFBLENBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTtnQkFDQSxJQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxVQUFBLENBQUEsRUFBQTtvQkFDQSxHQUFBLENBQUEsR0FBQSxDQUFBLEtBQUEsQ0FBQSxDQUFBO29CQUNBLE9BQUE7aUJBQ0E7Z0JBQ0EsSUFBQSxHQUFBLENBQUEsRUFBQSxDQUFBLEtBQUEsQ0FBQSxFQUFBO29CQUNBLEdBQUEsQ0FBQSxJQUFBLENBQUEsS0FBQSxFQUFBLEtBQUEsQ0FBQSxDQUFBO29CQUNBLE9BQUE7aUJBQ0E7Z0JBQ0EsSUFBQSxLQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsRUFBQTtvQkFDQSxHQUFBLENBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxDQUFBO2lCQUNBO3FCQUFBO29CQUNBLEdBQUEsQ0FBQSxPQUFBLENBQUEsS0FBQSxDQUFBLENBQUE7aUJBQ0E7WUFDQSxDQUFBLENBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLHdCQUFBLEdBQUE7UUFDQSxJQUFBLENBQUEsSUFBQSxDQUFBLE9BQUEsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLE1BQUEsR0FBQSxDQUFBLEVBQUE7WUFDQSxPQUFBLEVBQUEsQ0FBQTtTQUNBO1FBQ0EsSUFBQSxJQUFBLEdBQUEsRUFBQSxDQUFBO1FBQ0EsSUFBQSxHQUFBLEdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLENBQUEsV0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsR0FBQSxFQUFBO1lBQ0EsT0FBQSxJQUFBLENBQUE7U0FDQTtRQUNBLElBQUEsSUFBQSxHQUFBLEdBQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsSUFBQTtZQUNBLElBQUEsUUFBQSxHQUFBLElBQUEsQ0FBQSxLQUFBLENBQUEsR0FBQSxDQUFBLENBQUE7WUFDQSxJQUFBLEdBQUEsR0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxFQUFBLENBQUE7WUFDQSxJQUFBLEdBQUEsRUFBQTtnQkFDQSxJQUFBLENBQUEsR0FBQSxDQUFBLEdBQUEsUUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsRUFBQSxDQUFBO2FBQ0E7UUFDQSxDQUFBLENBQUEsQ0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLHdCQUFBLEdBQUEsVUFBQSxJQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUEsT0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsSUFBQSxVQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxDQUFBO1FBQ0EsS0FBQSxJQUFBLENBQUEsSUFBQSxJQUFBLEVBQUE7WUFDQSxJQUFBLElBQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQSxDQUFBLEVBQUE7Z0JBQ0EsSUFBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxNQUFBLENBQUEsR0FBQSxHQUFBLENBQUEsR0FBQSxHQUFBLEVBQUEsR0FBQSxDQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUE7YUFDQTtTQUNBO1FBQ0EsT0FBQSxJQUFBLENBQUE7SUFDQSxDQUFBO0lBQ0EsYUFBQTtBQUFBLENBaFZBLEFBZ1ZBLENBaFZBLEdBQUEsR0FnVkE7QUEyQkE7SUFBQTtRQUVBLFNBQUEsR0FBQSxNQUFBLENBQUE7UUFDQSxhQUFBLEdBQUEsSUFBQSxDQUFBO1FBQ0EsYUFBQSxHQUFBLE9BQUEsQ0FBQTtRQUNBLDJCQUFBO1FBQ0EsY0FBQSxHQUFBLFNBQUEsQ0FBQTtRQUNBLG1CQUFBLEdBQUE7WUFDQSxDQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsTUFBQSxFQUFBLENBQUEsTUFBQSxFQUFBLENBQUE7UUFDQSxDQUFBLENBQUE7UUFDQSxhQUFBLEdBQUEsS0FBQSxDQUFBO1FBQ0Esa0JBQUEsR0FBQSxLQUFBLENBQUE7UUFDQSxTQUFBLEdBQUEsRUFBQSxDQUFBO1FBQ0EsY0FBQSxHQUFBLGNBQUEsQ0FBQTtRQUNBLFdBQUEsR0FBQSxFQUFBLENBQUE7UUFDQSxZQUFBLEdBQUEsVUFBQSxJQUFBO1lBQ0EsaUJBQUE7WUFDQSxJQUFBLE9BQUEsSUFBQSxJQUFBLFFBQUEsRUFBQTtnQkFDQSxJQUFBLEdBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTthQUNBO1lBQ0EsSUFBQSxJQUFBLENBQUEsSUFBQSxJQUFBLENBQUEsRUFBQTtnQkFDQSxPQUFBLElBQUEsQ0FBQSxJQUFBLENBQUE7YUFDQTtZQUNBLE9BQUEsS0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBO1FBQ0EsWUFBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLGVBQUEsR0FBQSxVQUFBLEdBQUE7WUFDQSxPQUFBLENBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQTtRQUNBLHNFQUFBO1FBQ0EsZ0RBQUE7UUFDQSxxQ0FBQTtRQUNBLDJCQUFBO1FBQ0Esb0NBQUE7UUFDQSx1RUFBQTtRQUNBLHlDQUFBO1FBQ0EsaUVBQUE7UUFDQSxvRkFBQTtRQUNBLHFDQUFBO1FBQ0EsY0FBQTtRQUNBLGtCQUFBO1FBQ0EsUUFBQTtRQUNBLElBQUE7SUFDQSxDQUFBO0lBQUEsMEJBQUE7QUFBQSxDQTNDQSxBQTJDQSxJQUFBO0FBR0EsQ0FBQTtBQUFBLENBQUEsVUFBQSxDQUFBO0lBQ0EsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxNQUFBLEdBQUEsVUFBQSxNQUFBO1FBQ0EsT0FBQSxJQUFBLE1BQUEsQ0FBQSxJQUFBLEVBQUEsTUFBQSxDQUFBLENBQUE7SUFDQSxDQUFBLENBQUE7QUFDQSxDQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsQ0FBQSIsImZpbGUiOiJqcXVlcnkudXBsb2FkLmpzIiwic291cmNlc0NvbnRlbnQiOlsiYWJzdHJhY3QgY2xhc3MgRXZlIHtcclxuICAgIHB1YmxpYyBvcHRpb25zOiBhbnk7XHJcblxyXG4gICAgcHVibGljIG9uKGV2ZW50OiBzdHJpbmcsIGNhbGxiYWNrOiBGdW5jdGlvbik6IHRoaXMge1xyXG4gICAgICAgIHRoaXMub3B0aW9uc1snb24nICsgZXZlbnRdID0gY2FsbGJhY2s7XHJcbiAgICAgICAgcmV0dXJuIHRoaXM7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGhhc0V2ZW50KGV2ZW50OiBzdHJpbmcpOiBib29sZWFuIHtcclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zLmhhc093blByb3BlcnR5KCdvbicgKyBldmVudCk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHRyaWdnZXIoZXZlbnQ6IHN0cmluZywgLi4uIGFyZ3M6IGFueVtdKSB7XHJcbiAgICAgICAgbGV0IHJlYWxFdmVudCA9ICdvbicgKyBldmVudDtcclxuICAgICAgICBpZiAoIXRoaXMuaGFzRXZlbnQoZXZlbnQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIHRoaXMub3B0aW9uc1tyZWFsRXZlbnRdLmNhbGwodGhpcywgLi4uYXJncyk7XHJcbiAgICB9XHJcbn0iLCIvKiFcclxuICoganF1ZXJ5LnVwbG9hZCAtIGh0dHBzOi8vZ2l0aHViLmNvbS96eDY0ODM4MzA3OS9ab0RyZWFtLlVJXHJcbiAqIFZlcnNpb24gLSAxLjBcclxuICogTGljZW5zZWQgdW5kZXIgdGhlIE1JVCBsaWNlbnNlIC0gaHR0cDovL29wZW5zb3VyY2Uub3JnL2xpY2Vuc2VzL01JVFxyXG4gKlxyXG4gKiBDb3B5cmlnaHQgKGMpIDIwMTcgWm9EcmVhbVxyXG4gKi9cclxuLyoqXHJcbiAqIEVYQU1QTEU6XHJcbiAqICQoJyN1cGxvYWQnKS51cGxvYWQoe1xyXG4gKiAgICAgIHVybDogJ3VwbG9hZC5waHAnLFxyXG4gKiAgICAgIG5hbWU6ICdmaWxlJyxcclxuICogICAgICB0ZW1wbGF0ZTogJ3t1cmx9JyxcclxuICogICAgICBncmlkOiAnLmltZydcclxuICogfSk7XHJcbiAqL1xyXG5jbGFzcyBVcGxvYWQgZXh0ZW5kcyBFdmUge1xyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgcHVibGljIGVsZW1lbnQ/OiBKUXVlcnksXHJcbiAgICAgICAgb3B0aW9uPzogVXBsb2FkT3B0aW9uXHJcbiAgICApIHtcclxuICAgICAgICBzdXBlcigpO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucyA9ICQuZXh0ZW5kKHt9LCBuZXcgVXBsb2FkRGVmYXVsdE9wdGlvbigpLCBvcHRpb24pO1xyXG4gICAgICAgIHRoaXMub3B0aW9ucy5kYXRhID0gJC5leHRlbmQoe30sIHRoaXMub3B0aW9ucy5kYXRhLCB0aGlzLmdldERhdGEoKSk7XHJcbiAgICAgICAgdGhpcy5nZXRFbGVtZW50ID0gdGhpcy5vcHRpb25zLmdldEVsZW1lbnQuYmluZCh0aGlzKTtcclxuICAgICAgICBpZiAodGhpcy5lbGVtZW50KSB7XHJcbiAgICAgICAgICAgIHRoaXMuYWRkRXZlbnQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIG9wdGlvbnM6IFVwbG9hZE9wdGlvbjtcclxuXHJcbiAgICBwdWJsaWMgc3VjY2VzczogKGRhdGE6IGFueSwgY3VycmVudEVsZW1lbnQ6IEpRdWVyeSkgPT4gYm9vbGVhbjtcclxuXHJcbiAgICBwdWJsaWMgZ2V0RWxlbWVudDogKHRhZzogc3RyaW5nLCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiBKUXVlcnk7XHJcblxyXG4gICAgcHJpdmF0ZSBjdXJyZW50RWxlbWVudDogSlF1ZXJ5O1xyXG5cclxuICAgIHB1YmxpYyBhZGRFdmVudCgpIHtcclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIHRoaXMuZWxlbWVudC5jbGljayhmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgX3RoaXMuc3RhcnQoJCh0aGlzKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5ncmlkKSB7XHJcbiAgICAgICAgICAgICQodGhpcy5vcHRpb25zLmdyaWQpLm9uKCdjbGljaycsIHRoaXMub3B0aW9ucy5yZW1vdmVUYWcsIHRoaXMub3B0aW9ucy5yZW1vdmVDYWxsYmFjayk7XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBzdGFydChjdXJyZW50RWxlbWVudD86IEpRdWVyeSkge1xyXG4gICAgICAgIHRoaXMuY3VycmVudEVsZW1lbnQgPSBjdXJyZW50RWxlbWVudDtcclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGxldCBlbGVtZW50ID0gJCgnLicgKyB0aGlzLm9wdGlvbnMuZmlsZUNsYXNzKTtcclxuICAgICAgICBpZiAoZWxlbWVudC5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIGxldCBmaWxlID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnaW5wdXQnKTtcclxuICAgICAgICAgICAgZmlsZS50eXBlID0gJ2ZpbGUnO1xyXG4gICAgICAgICAgICBmaWxlLmNsYXNzTmFtZSA9IHRoaXMub3B0aW9ucy5maWxlQ2xhc3M7XHJcbiAgICAgICAgICAgIGZpbGUubXVsdGlwbGUgPSB0aGlzLm9wdGlvbnMubXVsdGlwbGU7XHJcbiAgICAgICAgICAgIGZpbGUuYWNjZXB0ID0gdGhpcy5vcHRpb25zLmZpbHRlcjtcclxuICAgICAgICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChmaWxlKTtcclxuICAgICAgICAgICAgZWxlbWVudCA9ICQoZmlsZSkuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24odGhpczogSFRNTElucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgX3RoaXMudXBsb2FkRmlsZXModGhpcy5maWxlcyk7XHJcbiAgICAgICAgICAgIH0pLmhpZGUoKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBlbGVtZW50LnZhbCgnJyk7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYXR0cignbXVsdGlwbGUnLCB0aGlzLm9wdGlvbnMubXVsdGlwbGUgPyAndHJ1ZScgOiAnZmFsc2UnKTtcclxuICAgICAgICAgICAgZWxlbWVudC5hdHRyKCdhY2NlcHQnLCB0aGlzLm9wdGlvbnMuZmlsdGVyKTtcclxuICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5keW5hbWljKSB7XHJcbiAgICAgICAgICAgICAgICBlbGVtZW50LnVuYmluZCgnY2hhbmdlJykuYmluZCgnY2hhbmdlJywgZnVuY3Rpb24odGhpczogSFRNTElucHV0RWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgICAgIF90aGlzLnVwbG9hZEZpbGVzKHRoaXMuZmlsZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudC5jbGljaygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGxvYWRGaWxlcyhmaWxlcykge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWxsb3dNdWx0aXBsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZE1hbnkoZmlsZXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgJC5lYWNoKGZpbGVzLCBmdW5jdGlvbihpLCBmaWxlKSB7XHJcbiAgICAgICAgICAgIF90aGlzLnVwbG9hZE9uZShmaWxlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBsb2FkTWFueShmaWxlcykge1xyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXMsXHJcbiAgICAgICAgICAgIGRhdGE6IEZvcm1EYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25kZWFsZmlsZSkge1xyXG4gICAgICAgICAgICBkYXRhID0gdGhpcy5vcHRpb25zLm9uZGVhbGZpbGVzLmNhbGwodGhpcywgZmlsZXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgJC5lYWNoKGZpbGVzLCBmdW5jdGlvbihpLCBmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZChfdGhpcy5vcHRpb25zLm5hbWUsIGZpbGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudHJpZ2dlcignYmVmb3JlJywgZGF0YSwgdGhpcy5jdXJyZW50RWxlbWVudCkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmUgdXBsb2FkIGlzIGZhbHNlJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGxvYWRGb3JtKGRhdGEsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uKGksIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBfdGhpcy5kZWFsKCQuZXh0ZW5kKHt9LCBfdGhpcy5vcHRpb25zLmRhdGEsIGl0ZW0pKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIF90aGlzLmRlYWwoJC5leHRlbmQoe30sIF90aGlzLm9wdGlvbnMuZGF0YSwgZGF0YSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGxvYWRPbmUoZmlsZTogRmlsZSkge1xyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXMsXHJcbiAgICAgICAgICAgIGRhdGE6IEZvcm1EYXRhLFxyXG4gICAgICAgICAgICBkZWFsX2RhdGEgPSB0aGlzLnRyaWdnZXIoJ2RlYWxmaWxlJywgZmlsZSk7XHJcbiAgICAgICAgaWYgKGRlYWxfZGF0YSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RlYWwgZmlsZSBpcyBmYWxzZScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZWFsX2RhdGEpIHtcclxuICAgICAgICAgICAgZGF0YSA9IGRlYWxfZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGRhdGEuYXBwZW5kKHRoaXMub3B0aW9ucy5uYW1lLCBmaWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRoaXMudHJpZ2dlcignYmVmb3JlJywgZGF0YSwgdGhpcy5jdXJyZW50RWxlbWVudCkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmUgdXBsb2FkIGlzIGZhbHNlJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGxvYWRGb3JtKGRhdGEsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgX3RoaXMuZGVhbCgkLmV4dGVuZCh7fSwgX3RoaXMub3B0aW9ucy5kYXRhLCBkYXRhKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwbG9hZEZvcm0oZGF0YTogRm9ybURhdGEsIGNiPzogKGRhdGE6IGFueSk9PnZvaWQpIHtcclxuICAgICAgICBsZXQgX3RoaXMgPSB0aGlzO1xyXG4gICAgICAgIGxldCBvcHRzID0ge1xyXG4gICAgICAgICAgICB1cmw6IHRoaXMub3B0aW9ucy51cmwsXHJcbiAgICAgICAgICAgIHR5cGU6J1BPU1QnLFxyXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSwgICAgLy/kuI3lj6/nvLpcclxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLCAgICAvL+S4jeWPr+e8ulxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gX3RoaXMudHJpZ2dlcignYWZ0ZXInLCBkYXRhLCBfdGhpcy5jdXJyZW50RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZnRlciB1cGxvYWQgaXMgZmFsc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYiAmJiBjYihkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50aW1lb3V0KSB7XHJcbiAgICAgICAgICAgIG9wdHNbJ3RpbWVvdXQnXSA9IHRoaXMub3B0aW9ucy50aW1lb3V0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoX3RoaXMub3B0aW9ucy5vbnByb2dyZXNzKSB7XHJcbiAgICAgICAgICAgIG9wdHNbJ3hociddID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgICAgIGxldCB4aHIgPSAkLmFqYXhTZXR0aW5ncy54aHIoKTtcclxuICAgICAgICAgICAgICAgIGlmKF90aGlzLm9wdGlvbnMub25wcm9ncmVzcyAmJiB4aHIudXBsb2FkKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgeGhyLnVwbG9hZC5hZGRFdmVudExpc3RlbmVyKCdwcm9ncmVzcycgLCBfdGhpcy5vcHRpb25zLm9ucHJvZ3Jlc3MsIGZhbHNlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIHJldHVybiB4aHI7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgfVxyXG4gICAgICAgICQuYWpheChvcHRzIGFzIGFueSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIGZvcm1hdEZpbGVTaXplKGZpbGVTaXplKTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgc2l6ZVVuaXRBcnIgPSBbJ0J5dGUnLCdLQicsJ01CJywnR0InXTtcclxuICAgICAgICBpZiAoZmlsZVNpemUgPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gXCIwIEtCXCI7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpID0gTWF0aC5mbG9vcihNYXRoLmxvZyhmaWxlU2l6ZSkgLyBNYXRoLmxvZygxMDI0KSk7XHJcbiAgICAgICAgaWYgKGkgPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZmlsZVNpemUgKyBzaXplVW5pdEFycltpXTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIChmaWxlU2l6ZSAvIE1hdGgucG93KDEwMjQsIGkpKS50b0ZpeGVkKDEpICsgc2l6ZVVuaXRBcnJbaV07XHJcbiAgICB9XHJcblxyXG5cclxuICAgIHB1YmxpYyBzbGljZVVwbG9hZChmaWxlOiBGaWxlLCBjYj86IChkYXRhOiBhbnksIGN1cnJlbnRFbGVtZW50OiBKUXVlcnkpID0+IHZvaWQpIHtcclxuICAgICAgICBsZXQgbWF4TGVuZ3RoID0gMTAyNCAqIDEwMjQsXHJcbiAgICAgICAgICAgIF90aGlzID0gdGhpcyxcclxuICAgICAgICAgICAgdG90YWxTaXplID0gZmlsZS5zaXplLFxyXG4gICAgICAgICAgICBuYW1lOiBzdHJpbmcsXHJcbiAgICAgICAgICAgIGNodW5rcyA9IE1hdGguY2VpbCh0b3RhbFNpemUgLyBtYXhMZW5ndGgpLFxyXG4gICAgICAgICAgICBjaHVuayA9IDAsXHJcbiAgICAgICAgICAgIHN0YXJ0VXBsb2FkID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgYmxvYkZyb20gPSBjaHVuayAqIG1heExlbmd0aCxcclxuICAgICAgICAgICAgICAgICAgICBibG9iVG8gPSBNYXRoLm1pbigoY2h1bmsgKyAxKSAqIG1heExlbmd0aCwgdG90YWxTaXplKSxcclxuICAgICAgICAgICAgICAgICAgICBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZChfdGhpcy5vcHRpb25zLm5hbWUsIGZpbGUuc2xpY2UoYmxvYkZyb20sIGJsb2JUbykpO1xyXG4gICAgICAgICAgICAgICAgaWYgKG5hbWUpIHtcclxuICAgICAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgnbmFtZScsIG5hbWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ3JlYWxfbmFtZScsIGZpbGUubmFtZSk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgndG90YWwnLCB0b3RhbFNpemUgKyAnJyk7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZCgnc3RhdHVzJywgKGNodW5rID09IChjaHVua3MgLSAxKSA/IDIgOiAoY2h1bmsgPT0gMCA/IDAgOiAxKSkgKyAnJyk7XHJcbiAgICAgICAgICAgICAgICBfdGhpcy51cGxvYWRGb3JtKGRhdGEsIChyZXMpID0+IHtcclxuICAgICAgICAgICAgICAgICAgICBjYiAmJiBjYih7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHRvdGFsOiB0b3RhbFNpemUsXHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNpemU6IGJsb2JUb1xyXG4gICAgICAgICAgICAgICAgICAgIH0sIF90aGlzLmN1cnJlbnRFbGVtZW50KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoY2h1bmsgPT09IChjaHVua3MgLSAxKSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBfdGhpcy5kZWFsKCQuZXh0ZW5kKHt9LCBfdGhpcy5vcHRpb25zLmRhdGEsIHJlcykpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG5hbWUgPSByZXMubmFtZTtcclxuICAgICAgICAgICAgICAgICAgICBjaHVuayArKztcclxuICAgICAgICAgICAgICAgICAgICBzdGFydFVwbG9hZCgpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH07XHJcbiAgICAgICAgc3RhcnRVcGxvYWQoKTtcclxuICAgIH1cclxuXHJcblxyXG4gICAgLyoqIOWbvueJh+WOi+e8qSBzdGFydCAgKi9cclxuXHJcbiAgICBwdWJsaWMgcGhvdG9Db21wcmVzcyhmaWxlOiBGaWxlLCBvcHRpb25zOiBhbnksIGNiOiAoZGF0YTogc3RyaW5nKSA9PiB2b2lkKXtcclxuICAgICAgICBsZXQgcmVhZHkgPSBuZXcgRmlsZVJlYWRlcigpLFxyXG4gICAgICAgICAgICBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgLyrlvIDlp4vor7vlj5bmjIflrprnmoRCbG9i5a+56LGh5oiWRmlsZeWvueixoeS4reeahOWGheWuuS4g5b2T6K+75Y+W5pON5L2c5a6M5oiQ5pe2LHJlYWR5U3RhdGXlsZ7mgKfnmoTlgLzkvJrmiJDkuLpET05FLOWmguaenOiuvue9ruS6hm9ubG9hZGVuZOS6i+S7tuWkhOeQhueoi+W6jyzliJnosIPnlKjkuYsu5ZCM5pe2LHJlc3VsdOWxnuaAp+S4reWwhuWMheWQq+S4gOS4qmRhdGE6IFVSTOagvOW8j+eahOWtl+espuS4suS7peihqOekuuaJgOivu+WPluaWh+S7tueahOWGheWuuS4qL1xyXG4gICAgICAgIHJlYWR5LnJlYWRBc0RhdGFVUkwoZmlsZSk7XHJcbiAgICAgICAgcmVhZHkub25sb2FkID0gZnVuY3Rpb24oKXtcclxuICAgICAgICAgICAgbGV0IHJlID0gdGhpcy5yZXN1bHQ7XHJcbiAgICAgICAgICAgIF90aGlzLl9jYW52YXNEYXRhVVJMKHJlIGFzIHN0cmluZywgb3B0aW9ucywgY2IpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBfY2FudmFzRGF0YVVSTChwYXRoOiBzdHJpbmcsIG9iajogYW55LCBjYWxsYmFjazogKGRhdGE6IHN0cmluZykgPT4gdm9pZCl7XHJcbiAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgIGltZy5zcmMgPSBwYXRoO1xyXG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbih0aGlzOiBIVE1MSW1hZ2VFbGVtZW50KXtcclxuICAgICAgICAgICAgbGV0IHRoYXQgPSB0aGlzO1xyXG4gICAgICAgICAgICAvLyDpu5jorqTmjInmr5TkvovljovnvKlcclxuICAgICAgICAgICAgbGV0IHcgPSB0aGF0LndpZHRoLFxyXG4gICAgICAgICAgICAgICAgaCA9IHRoYXQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgc2NhbGUgPSB3IC8gaDtcclxuICAgICAgICAgICAgdyA9IG9iai53aWR0aCB8fCB3O1xyXG4gICAgICAgICAgICBoID0gb2JqLmhlaWdodCB8fCAodyAvIHNjYWxlKTtcclxuICAgICAgICAgICAgbGV0IHF1YWxpdHkgPSAwLjc7ICAvLyDpu5jorqTlm77niYfotKjph4/kuLowLjdcclxuICAgICAgICAgICAgLy/nlJ/miJBjYW52YXNcclxuICAgICAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLFxyXG4gICAgICAgICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgIC8vIOWIm+W7uuWxnuaAp+iKgueCuVxyXG4gICAgICAgICAgICBsZXQgYW53ID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKFwid2lkdGhcIik7XHJcbiAgICAgICAgICAgIGFudy5ub2RlVmFsdWUgPSB3ICsgJyc7XHJcbiAgICAgICAgICAgIGxldCBhbmggPSBkb2N1bWVudC5jcmVhdGVBdHRyaWJ1dGUoXCJoZWlnaHRcIik7XHJcbiAgICAgICAgICAgIGFuaC5ub2RlVmFsdWUgPSBoICsgJyc7XHJcbiAgICAgICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGVOb2RlKGFudyk7XHJcbiAgICAgICAgICAgIGNhbnZhcy5zZXRBdHRyaWJ1dGVOb2RlKGFuaCk7XHJcbiAgICAgICAgICAgIGN0eC5kcmF3SW1hZ2UodGhhdCwgMCwgMCwgdywgaCk7XHJcbiAgICAgICAgICAgIC8vIOWbvuWDj+i0qOmHj1xyXG4gICAgICAgICAgICBpZihvYmoucXVhbGl0eSAmJiBvYmoucXVhbGl0eSA8PSAxICYmIG9iai5xdWFsaXR5ID4gMCl7XHJcbiAgICAgICAgICAgICAgICBxdWFsaXR5ID0gb2JqLnF1YWxpdHk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgLy8gcXVhbGl0eeWAvOi2iuWwj++8jOaJgOe7mOWItuWHuueahOWbvuWDj+i2iuaooeezilxyXG4gICAgICAgICAgICBsZXQgYmFzZTY0ID0gY2FudmFzLnRvRGF0YVVSTCgnaW1hZ2UvanBlZycsIHF1YWxpdHkpO1xyXG4gICAgICAgICAgICAvLyDlm57osIPlh73mlbDov5Tlm55iYXNlNjTnmoTlgLxcclxuICAgICAgICAgICAgY2FsbGJhY2soYmFzZTY0KTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcbiAgICAvKipcclxuICAgICAqIOWwhuS7pWJhc2U2NOeahOWbvueJh3VybOaVsOaNrui9rOaNouS4ukJsb2JcclxuICAgICAqIEBwYXJhbSB1cmxEYXRhXHJcbiAgICAgKiAgICAgICAgICAgIOeUqHVybOaWueW8j+ihqOekuueahGJhc2U2NOWbvueJh+aVsOaNrlxyXG4gICAgICovXHJcbiAgICBwdWJsaWMgY29udmVydEJhc2U2NFVybFRvQmxvYih1cmxEYXRhOiBzdHJpbmcpe1xyXG4gICAgICAgIHZhciBhcnIgPSB1cmxEYXRhLnNwbGl0KCcsJyksIG1pbWUgPSBhcnJbMF0ubWF0Y2goLzooLio/KTsvKVsxXSxcclxuICAgICAgICAgICAgYnN0ciA9IGF0b2IoYXJyWzFdKSwgbiA9IGJzdHIubGVuZ3RoLCB1OGFyciA9IG5ldyBVaW50OEFycmF5KG4pO1xyXG4gICAgICAgIHdoaWxlKG4tLSl7XHJcbiAgICAgICAgICAgIHU4YXJyW25dID0gYnN0ci5jaGFyQ29kZUF0KG4pO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gbmV3IEJsb2IoW3U4YXJyXSwge3R5cGU6bWltZX0pO1xyXG4gICAgfVxyXG5cclxuICAgIC8qKiDljovnvKnlpITnkIZlbmQgICovXHJcblxyXG4gICAgcHVibGljIGRlYWwoZGF0YTogYW55KSB7XHJcbiAgICAgICAgbGV0IHZhbHVlID0gdHlwZW9mIHRoaXMub3B0aW9ucy50ZW1wbGF0ZSA9PSAnZnVuY3Rpb24nID8gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmNhbGwodGhpcywgZGF0YSkgOiB0aGlzLnJlcGxhY2UoZGF0YSk7XHJcbiAgICAgICAgaWYgKHZhbHVlID09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCd0ZW1wbGF0ZSBpcyBmYWxzZScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChmYWxzZSA9PT0gdGhpcy50cmlnZ2VyKCdzdWNjZXNzJywgZGF0YSwgdGhpcy5jdXJyZW50RWxlbWVudCkpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3N1Y2Nlc3MgaXMgZmFsc2UnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdXJsRm9yID0gdGhpcy5vcHRpb25zLmdyaWQ7XHJcbiAgICAgICAgaWYgKHRoaXMuY3VycmVudEVsZW1lbnQgJiYgdGhpcy5jdXJyZW50RWxlbWVudC5sZW5ndGggPiAwKSB7XHJcbiAgICAgICAgICAgIHVybEZvciA9IHRoaXMuY3VycmVudEVsZW1lbnQuYXR0cignZGF0YS1ncmlkJykgfHwgdGhpcy5vcHRpb25zLmdyaWQ7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmICghdXJsRm9yKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdncmlkIGVsZW1lbnQgaXMgZmFsc2UnKTtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgdGFncyA9IHVybEZvci5zcGxpdCgnfCcpO1xyXG4gICAgICAgIGxldCBfdGhpcyA9IHRoaXM7XHJcbiAgICAgICAgdGFncy5mb3JFYWNoKGZ1bmN0aW9uKHRhZykge1xyXG4gICAgICAgICAgICBsZXQgaXRlbSA9IF90aGlzLmdldEVsZW1lbnQodGFnLCBfdGhpcy5jdXJyZW50RWxlbWVudCk7XHJcbiAgICAgICAgICAgIGlmIChpdGVtLmxlbmd0aCA9PSAwKSB7XHJcbiAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgaXRlbS5lYWNoKGZ1bmN0aW9uKGksIGVsZW1lbnQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBlbGUgPSAkKGVsZW1lbnQpO1xyXG4gICAgICAgICAgICAgICAgaWYgKGVsZS5pcygnaW5wdXQnKSB8fCBlbGUuaXMoJ3RleHRhcmVhJykpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGUudmFsKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlLmlzKCdpbWcnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZS5hdHRyKCdzcmMnLCB2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgaWYgKF90aGlzLm9wdGlvbnMuaXNBcHBlbmQpIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGUuYXBwZW5kKHZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlLnByZXBlbmQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgZ2V0RGF0YSgpOiBhbnkge1xyXG4gICAgICAgIGlmICghdGhpcy5lbGVtZW50IHx8IHRoaXMuZWxlbWVudC5sZW5ndGggPCAxKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7fTtcclxuICAgICAgICB9XHJcbiAgICAgICAgbGV0IGRhdGEgPSB7fTtcclxuICAgICAgICBsZXQgYXJnID0gdGhpcy5lbGVtZW50LmF0dHIoJ2RhdGEtZGF0YScpO1xyXG4gICAgICAgIGlmICghYXJnKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBkYXRhO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgYXJncyA9IGFyZy5zcGxpdCgnLCcpO1xyXG4gICAgICAgIGFyZ3MuZm9yRWFjaChmdW5jdGlvbihpdGVtKSB7XHJcbiAgICAgICAgICAgIGxldCBrZXlWYWx1ZSA9IGl0ZW0uc3BsaXQoJzonKTtcclxuICAgICAgICAgICAgbGV0IGtleSA9IGtleVZhbHVlWzBdLnRyaW0oKTtcclxuICAgICAgICAgICAgaWYgKGtleSkge1xyXG4gICAgICAgICAgICAgICAgZGF0YVtrZXldID0ga2V5VmFsdWVbMV0udHJpbSgpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSk7XHJcbiAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHJlcGxhY2UoZGF0YTogT2JqZWN0KTogc3RyaW5nIHtcclxuICAgICAgICBsZXQgaHRtbDogc3RyaW5nID0gdHlwZW9mIHRoaXMub3B0aW9ucy50ZW1wbGF0ZSA9PSAnZnVuY3Rpb24nID8gdGhpcy5vcHRpb25zLnRlbXBsYXRlLmNhbGwodGhpcywgZGF0YSkgOiB0aGlzLm9wdGlvbnMudGVtcGxhdGU7XHJcbiAgICAgICAgZm9yIChsZXQgaSBpbiBkYXRhKSB7XHJcbiAgICAgICAgICAgIGlmIChkYXRhLmhhc093blByb3BlcnR5KGkpKSB7XHJcbiAgICAgICAgICAgICAgICBodG1sID0gaHRtbC5yZXBsYWNlKG5ldyBSZWdFeHAoJ3snICsgaSArICd9JywgJ2cnKSwgZGF0YVtpXSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGh0bWw7XHJcbiAgICB9XHJcbn1cclxuXHJcbmludGVyZmFjZSBVcGxvYWRPcHRpb24ge1xyXG4gICAgW3NldHRpbmc6IHN0cmluZ106IGFueSxcclxuICAgIHVybD86IHN0cmluZywgICAgICAgICAvLyDkuIrkvKDnvZHlnYBcclxuICAgIG5hbWU/OiBzdHJpbmcsICAgICAgICAvLyDkuIrkvKDlkI1cclxuICAgIGlzQXBwZW5kPzogYm9vbGVhbiwgICAgLy/lnKjlkI7pnaLliqDov5jmmK/liY3pnaLliqAg77yM5a+55aSa5Liq5pyJ5pWIXHJcbiAgICB0ZW1wbGF0ZT86IHN0cmluZyB8IEZ1bmN0aW9uLCAgICAvLyDmqKHmnb9cclxuICAgIGdyaWQ/OiBzdHJpbmcsICAgICAgICAvLyDoo4Xovb3lrrnlmahcclxuICAgIGRhdGE/OiBhbnksICAgICAgICAgICAvL+m7mOiupOWAvFxyXG4gICAgdGltZW91dD86IG51bWJlcixcclxuICAgIHJlbW92ZVRhZz86IHN0cmluZywgICAvLyDliKDpmaTmoIflv5dcclxuICAgIHJlbW92ZUNhbGxiYWNrPzogKGV2ZW50T2JqZWN0OiBKUXVlcnlFdmVudE9iamVjdCwgLi4uZXZlbnREYXRhOiBhbnlbXSkgPT4gYW55LCAgLy/liKDpmaTop6blj5Hkuovku7ZcclxuICAgIG11bHRpcGxlPzogYm9vbGVhbiwgICAvLyDmmK/lkKblhYHorrjkuIrkvKDlpJrkuKpcclxuICAgIGZpbGVDbGFzcz86IHN0cmluZywgICAvLyDkuIrkvKDmlofku7ZDbGFzcyDlkI1cclxuICAgIGZpbHRlcj86IHN0cmluZywgICAgICAgLy8g5paH5Lu26L+H5rukXHJcbiAgICBvbmRlYWxmaWxlPzogKGZpbGU6IEZpbGUpID0+IEZvcm1EYXRhIHwgdm9pZCxcclxuICAgIG9uZGVhbGZpbGVzPzogKGZpbGU6IEZpbGVMaXN0KSA9PiBGb3JtRGF0YSB8IHZvaWQsXHJcbiAgICBvbmJlZm9yZT86IChkYXRhOiBGb3JtRGF0YSwgY3VycmVudEVsZW1lbnQ6IEpRdWVyeSkgPT4gYW55LCAgLy/pqozor4HopoHkuIrkvKDnmoTmlofku7ZcclxuICAgIG9uYWZ0ZXI/OiAoZGF0YTogYW55LCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiBhbnksICAgLy/pqozor4HkuIrkvKDov5Tlm57mlbDmja5cclxuICAgIG9uc3VjY2Vzcz86IChkYXRhOiBhbnksIGN1cnJlbnRFbGVtZW50OiBKUXVlcnkpID0+IGJvb2xlYW4gLCAgICAgLy/miJDlip/mt7vliqDlm57mjolcclxuICAgIGR5bmFtaWM/OiBib29sZWFuLCAvL+aYr+WQpuWKqOaAgee7keWumuS4iuS8oOaXtumXtFxyXG4gICAgZ2V0RWxlbWVudD86ICh0YWc6IHN0cmluZywgY3VycmVudEVsZW1lbnQ6IEpRdWVyeSkgPT4gSlF1ZXJ5LCAgIC8v6I635Y+W5a655Zmo55qE5pa55rOVXHJcbiAgICBvbnByb2dyZXNzPzogKGRhdGE6IGFueSkgPT4gdm9pZCwgLy8g5LiK5Lyg6L+b5bqmXHJcbiAgICBhbGxvd011bHRpcGxlPzogYm9vbGVhbiwgICAgIC8vIOaYr+WQpuWFgeiuuOS4iuS8oOS4gOasoeWkmuS4qlxyXG59XHJcblxyXG5jbGFzcyBVcGxvYWREZWZhdWx0T3B0aW9uIGltcGxlbWVudHMgVXBsb2FkT3B0aW9uIHtcclxuICAgIFtzZXR0aW5nOiBzdHJpbmddOiBhbnk7XHJcbiAgICBuYW1lOiBzdHJpbmcgPSAnZmlsZSc7XHJcbiAgICBpc0FwcGVuZDogYm9vbGVhbiA9IHRydWU7XHJcbiAgICB0ZW1wbGF0ZTogc3RyaW5nID0gJ3t1cmx9JztcclxuICAgIC8vZ3JpZDogc3RyaW5nID0gJy56ZEdyaWQnO1xyXG4gICAgcmVtb3ZlVGFnOiBzdHJpbmcgPSAnLmRlbGV0ZSc7XHJcbiAgICByZW1vdmVDYWxsYmFjazogKGV2ZW50T2JqZWN0OiBKUXVlcnlFdmVudE9iamVjdCwgLi4uZXZlbnREYXRhOiBhbnlbXSkgPT4gYW55ID0gZnVuY3Rpb24oKSB7XHJcbiAgICAgICAgJCh0aGlzKS5wYXJlbnQoKS5yZW1vdmUoKTtcclxuICAgIH07XHJcbiAgICBtdWx0aXBsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgYWxsb3dNdWx0aXBsZTogYm9vbGVhbiA9IGZhbHNlO1xyXG4gICAgZGF0YTogYW55ID0ge307XHJcbiAgICBmaWxlQ2xhc3M6IHN0cmluZyA9ICd6ZFVwbG9hZEZpbGUnO1xyXG4gICAgZmlsdGVyOiBzdHJpbmcgPSAnJztcclxuICAgIG9uYWZ0ZXI6IChkYXRhOiBhbnkpID0+IGFueSA9IGZ1bmN0aW9uKGRhdGE6IGFueSkge1xyXG4gICAgICAgIC8vIOmYsuatomFqYXjoh6rliqjovazljJZqc29uXHJcbiAgICAgICAgaWYgKHR5cGVvZiBkYXRhICE9ICdvYmplY3QnKSB7XHJcbiAgICAgICAgICAgIGRhdGEgPSBKU09OLnBhcnNlKGRhdGEpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAoZGF0YS5jb2RlID09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGEuZGF0YTtcclxuICAgICAgICB9XHJcbiAgICAgICAgcmV0dXJuIGZhbHNlO1xyXG4gICAgfTtcclxuICAgIGR5bmFtaWM6IGJvb2xlYW4gPSB0cnVlO1xyXG4gICAgZ2V0RWxlbWVudDogKHRhZzogc3RyaW5nLCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiBKUXVlcnkgPSBmdW5jdGlvbih0YWc6IHN0cmluZyk6IEpRdWVyeSB7XHJcbiAgICAgICAgcmV0dXJuICQodGFnKTtcclxuICAgIH07XHJcbiAgICAvLyBvbmRlYWxmaWxlOiAoZmlsZTogRmlsZSkgPT4gRm9ybURhdGF8IHZvaWQgPSBmdW5jdGlvbihmaWxlOiBGaWxlKSB7XHJcbiAgICAvLyAgICAgaWYoZmlsZS5zaXplLzEwMjQgPiAxMDI1KSB7IC8v5aSn5LqOMU3vvIzov5vooYzljovnvKnkuIrkvKBcclxuICAgIC8vICAgICAgICAgdGhpcy5waG90b0NvbXByZXNzKGZpbGUsIHtcclxuICAgIC8vICAgICAgICAgICAgIHF1YWxpdHk6IDAuMlxyXG4gICAgLy8gICAgICAgICB9LCBmdW5jdGlvbihiYXNlNjRDb2Rlcyl7XHJcbiAgICAvLyAgICAgICAgICAgICAvL2NvbnNvbGUubG9nKFwi5Y6L57yp5ZCO77yaXCIgKyBiYXNlLmxlbmd0aCAvIDEwMjQgKyBcIiBcIiArIGJhc2UpO1xyXG4gICAgLy8gICAgICAgICAgICAgbGV0IGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgIC8vICAgICAgICAgICAgIGxldCBibCA9IHRoaXMuY29udmVydEJhc2U2NFVybFRvQmxvYihiYXNlNjRDb2Rlcyk7XHJcbiAgICAvLyAgICAgICAgICAgICBkYXRhLmFwcGVuZChcImZpbGVcIiwgYmwsIFwiZmlsZV9cIituZXcgRGF0ZSgpLmdldFRpbWUoKStcIi5qcGdcIik7IC8vIOaWh+S7tuWvueixoVxyXG4gICAgLy8gICAgICAgICAgICAgdGhpcy51cGxvYWRGb3JtKGRhdGEpO1xyXG4gICAgLy8gICAgICAgICB9KTtcclxuICAgIC8vICAgICAgICAgcmV0dXJuO1xyXG4gICAgLy8gICAgIH1cclxuICAgIC8vIH1cclxufVxyXG5cclxuXHJcbjsoZnVuY3Rpb24oJDogYW55KSB7XHJcbiAgJC5mbi51cGxvYWQgPSBmdW5jdGlvbihvcHRpb24gPzogVXBsb2FkT3B0aW9uKSB7XHJcbiAgICByZXR1cm4gbmV3IFVwbG9hZCh0aGlzLCBvcHRpb24pOyBcclxuICB9O1xyXG59KShqUXVlcnkpOyJdfQ==
