var __extends = (this && this.__extends) || (function () {
    var extendStatics = Object.setPrototypeOf ||
        ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||
        function (d, b) { for (var p in b) if (b.hasOwnProperty(p)) d[p] = b[p]; };
    return function (d, b) {
        extendStatics(d, b);
        function __() { this.constructor = d; }
        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());
    };
})();
var Eve = /** @class */ (function () {
    function Eve() {
    }
    Eve.prototype.on = function (event, callback) {
        this.options['on' + event] = callback;
        return this;
    };
    Eve.prototype.hasEvent = function (event) {
        return this.options.hasOwnProperty('on' + event);
    };
    Eve.prototype.trigger = function (event) {
        var _a;
        var args = [];
        for (var _i = 1; _i < arguments.length; _i++) {
            args[_i - 1] = arguments[_i];
        }
        var realEvent = 'on' + event;
        if (!this.hasEvent(event)) {
            return;
        }
        return (_a = this.options[realEvent]).call.apply(_a, [this].concat(args));
    };
    return Eve;
}());
/*!
 * jquery.upload - https://github.com/zx648383079/ZoDream.UI
 * Version - 1.0
 * Licensed under the MIT license - http://opensource.org/licenses/MIT
 *
 * Copyright (c) 2017 ZoDream
 */
/**
 * EXAMPLE:
 * $('#upload').upload({
 *      url: 'upload.php',
 *      name: 'file',
 *      template: '{url}',
 *      grid: '.img'
 * });
 */
var Upload = /** @class */ (function (_super) {
    __extends(Upload, _super);
    function Upload(element, option) {
        var _this_1 = _super.call(this) || this;
        _this_1.element = element;
        _this_1.options = $.extend({}, new UploadDefaultOption(), option);
        _this_1.options.data = $.extend({}, _this_1.options.data, _this_1.getData());
        _this_1.getElement = _this_1.options.getElement.bind(_this_1);
        if (_this_1.element) {
            _this_1.addEvent();
        }
        return _this_1;
    }
    Upload.prototype.addEvent = function () {
        var instance = this;
        this.element.click(function () {
            instance.start($(this));
        });
        if (this.options.grid) {
            $(this.options.grid).on('click', this.options.removeTag, this.options.removeCallback);
        }
    };
    Upload.prototype.start = function (currentElement) {
        this.currentElement = currentElement;
        var instance = this;
        var element = $('.' + this.options.fileClass);
        if (element.length < 1) {
            var file = document.createElement('input');
            file.type = 'file';
            file.className = this.options.fileClass;
            file.multiple = this.options.multiple;
            file.accept = this.options.filter;
            document.body.appendChild(file);
            element = $(file).bind('change', function () {
                instance.uploadFiles(this.files);
            }).hide();
        }
        else {
            element.val('');
            element.attr('multiple', this.options.multiple ? 'true' : 'false');
            element.attr('accept', this.options.filter);
            if (this.options.dynamic) {
                element.unbind('change').bind('change', function () {
                    instance.uploadFiles(this.files);
                });
            }
        }
        element.click();
    };
    Upload.prototype.uploadFiles = function (files) {
        if (this.options.allowMultiple) {
            this.uploadMany(files);
            return;
        }
        var instance = this;
        $.each(files, function (i, file) {
            instance.uploadOne(file);
        });
    };
    Upload.prototype.uploadMany = function (files) {
        var instance = this, data;
        if (this.options.ondealfile) {
            data = this.options.ondealfiles.call(this, files);
        }
        else {
            data = new FormData();
            $.each(files, function (i, file) {
                data.append(instance.options.name, file);
            });
        }
        if (this.trigger('before', data, this.currentElement) === false) {
            console.log('before upload is false');
            return;
        }
        this.uploadForm(data, function (data) {
            if (data instanceof Array) {
                $.each(data, function (i, item) {
                    instance.deal($.extend({}, instance.options.data, item));
                });
                return;
            }
            instance.deal($.extend({}, instance.options.data, data));
        });
    };
    Upload.prototype.uploadOne = function (file) {
        var instance = this, data, deal_data = this.trigger('dealfile', file);
        if (deal_data === false) {
            console.log('deal file is false');
            return;
        }
        if (deal_data) {
            data = deal_data;
        }
        else {
            data = new FormData();
            data.append(this.options.name, file);
        }
        if (this.trigger('before', data, this.currentElement) === false) {
            console.log('before upload is false');
            return;
        }
        this.uploadForm(data, function (data) {
            instance.deal($.extend({}, instance.options.data, data));
        });
    };
    Upload.prototype.uploadForm = function (data, cb) {
        var instance = this;
        var opts = {
            url: this.options.url,
            type: 'POST',
            data: data,
            cache: false,
            contentType: false,
            processData: false,
            success: function (data) {
                data = instance.trigger('after', data, instance.currentElement);
                if (data == false) {
                    console.log('after upload is false');
                    return;
                }
                cb && cb(data);
            }
        };
        if (this.options.timeout) {
            opts['timeout'] = this.options.timeout;
        }
        if (this.hasEvent('progress')) {
            opts['xhr'] = function () {
                var xhr = $.ajaxSettings.xhr();
                if (onprogress && xhr.upload) {
                    xhr.upload.addEventListener('progress', this.options.onprogress, false);
                    return xhr;
                }
            };
        }
        $.ajax(opts);
    };
    Upload.prototype.formatFileSize = function (fileSize) {
        var sizeUnitArr = ['Byte', 'KB', 'MB', 'GB'];
        if (fileSize == 0) {
            return "0 KB";
        }
        var i = Math.floor(Math.log(fileSize) / Math.log(1024));
        if (i == 0) {
            return fileSize + sizeUnitArr[i];
        }
        return (fileSize / Math.pow(1024, i)).toFixed(1) + sizeUnitArr[i];
    };
    Upload.prototype.sliceUpload = function (file, cb) {
        var maxLength = 1024 * 1024, _this = this, totalSize = file.size, name, chunks = Math.ceil(totalSize / maxLength), chunk = 0, startUpload = function () {
            var blobFrom = chunk * maxLength, blobTo = Math.min((chunk + 1) * maxLength, totalSize), data = new FormData();
            data.append(_this.options.name, file.slice(blobFrom, blobTo));
            if (name) {
                data.append('name', name);
            }
            data.append('real_name', file.name);
            data.append('total', totalSize + '');
            data.append('status', (chunk == (chunks - 1) ? 2 : (chunk == 0 ? 0 : 1)) + '');
            _this.uploadForm(data, function (res) {
                cb && cb({
                    total: totalSize,
                    size: blobTo
                }, _this.currentElement);
                if (chunk === (chunks - 1)) {
                    _this.deal($.extend({}, _this.options.data, res));
                    return;
                }
                name = res.name;
                chunk++;
                startUpload();
            });
        };
        startUpload();
    };
    /** 图片压缩 start  */
    Upload.prototype.photoCompress = function (file, options, cb) {
        var ready = new FileReader(), instance = this;
        /*开始读取指定的Blob对象或File对象中的内容. 当读取操作完成时,readyState属性的值会成为DONE,如果设置了onloadend事件处理程序,则调用之.同时,result属性中将包含一个data: URL格式的字符串以表示所读取文件的内容.*/
        ready.readAsDataURL(file);
        ready.onload = function () {
            var re = this.result;
            instance._canvasDataURL(re, options, cb);
        };
    };
    Upload.prototype._canvasDataURL = function (path, obj, callback) {
        var img = new Image();
        img.src = path;
        img.onload = function () {
            var that = this;
            // 默认按比例压缩
            var w = that.width, h = that.height, scale = w / h;
            w = obj.width || w;
            h = obj.height || (w / scale);
            var quality = 0.7; // 默认图片质量为0.7
            //生成canvas
            var canvas = document.createElement('canvas'), ctx = canvas.getContext('2d');
            // 创建属性节点
            var anw = document.createAttribute("width");
            anw.nodeValue = w;
            var anh = document.createAttribute("height");
            anh.nodeValue = h;
            canvas.setAttributeNode(anw);
            canvas.setAttributeNode(anh);
            ctx.drawImage(that, 0, 0, w, h);
            // 图像质量
            if (obj.quality && obj.quality <= 1 && obj.quality > 0) {
                quality = obj.quality;
            }
            // quality值越小，所绘制出的图像越模糊
            var base64 = canvas.toDataURL('image/jpeg', quality);
            // 回调函数返回base64的值
            callback(base64);
        };
    };
    /**
     * 将以base64的图片url数据转换为Blob
     * @param urlData
     *            用url方式表示的base64图片数据
     */
    Upload.prototype.convertBase64UrlToBlob = function (urlData) {
        var arr = urlData.split(','), mime = arr[0].match(/:(.*?);/)[1], bstr = atob(arr[1]), n = bstr.length, u8arr = new Uint8Array(n);
        while (n--) {
            u8arr[n] = bstr.charCodeAt(n);
        }
        return new Blob([u8arr], { type: mime });
    };
    /** 压缩处理end  */
    Upload.prototype.deal = function (data) {
        var value = typeof this.options.template == 'function' ? this.options.template.call(this, data) : this.replace(data);
        if (value == false) {
            console.log('template is false');
            return;
        }
        if (false === this.trigger('success', data, this.currentElement)) {
            console.log('success is false');
            return;
        }
        var urlFor = this.options.grid;
        if (this.currentElement && this.currentElement.length > 0) {
            urlFor = this.currentElement.attr('data-grid') || this.options.grid;
        }
        if (!urlFor) {
            console.log('grid element is false');
            return;
        }
        var tags = urlFor.split('|');
        var instance = this;
        tags.forEach(function (tag) {
            var item = instance.getElement(tag, instance.currentElement);
            if (item.length == 0) {
                return;
            }
            item.each(function (i, element) {
                var ele = $(element);
                if (ele.is('input') || ele.is('textarea')) {
                    ele.val(value);
                    return;
                }
                if (ele.is('img')) {
                    ele.attr('src', value);
                    return;
                }
                if (instance.options.isAppend) {
                    ele.append(value);
                }
                else {
                    ele.prepend(value);
                }
            });
        });
    };
    Upload.prototype.getData = function () {
        if (!this.element || this.element.length < 1) {
            return {};
        }
        var data = {};
        var arg = this.element.attr('data-data');
        if (!arg) {
            return data;
        }
        var args = arg.split(',');
        args.forEach(function (item) {
            var keyValue = item.split(':');
            var key = keyValue[0].trim();
            if (key) {
                data[key] = keyValue[1].trim();
            }
        });
        return data;
    };
    Upload.prototype.replace = function (data) {
        var html = typeof this.options.template == 'function' ? this.options.template.call(this, data) : this.options.template;
        for (var i in data) {
            if (data.hasOwnProperty(i)) {
                html = html.replace(new RegExp('{' + i + '}', 'g'), data[i]);
            }
        }
        return html;
    };
    return Upload;
}(Eve));
var UploadDefaultOption = /** @class */ (function () {
    function UploadDefaultOption() {
        this.name = 'file';
        this.isAppend = true;
        this.template = '{url}';
        //grid: string = '.zdGrid';
        this.removeTag = '.delete';
        this.removeCallback = function () {
            $(this).parent().remove();
        };
        this.multiple = false;
        this.allowMultiple = false;
        this.data = {};
        this.fileClass = 'zdUploadFile';
        this.filter = '';
        this.onafter = function (data) {
            // 防止ajax自动转化json
            if (typeof data != 'object') {
                data = JSON.parse(data);
            }
            if (data.code == 0) {
                return data.data;
            }
            return false;
        };
        this.dynamic = true;
        this.getElement = function (tag) {
            return $(tag);
        };
        // ondealfile: (file: File) => FormData| void = function(file: File) {
        //     if(file.size/1024 > 1025) { //大于1M，进行压缩上传
        //         this.photoCompress(file, {
        //             quality: 0.2
        //         }, function(base64Codes){
        //             //console.log("压缩后：" + base.length / 1024 + " " + base);
        //             let data = new FormData();
        //             let bl = this.convertBase64UrlToBlob(base64Codes);
        //             data.append("file", bl, "file_"+new Date().getTime()+".jpg"); // 文件对象
        //             this.uploadForm(data);
        //         });
        //         return;
        //     }
        // }
    }
    return UploadDefaultOption;
}());
;
(function ($) {
    $.fn.upload = function (option) {
        return new Upload(this, option);
    };
})(jQuery);

//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImV2ZW50LnRzIiwianF1ZXJ5LnVwbG9hZC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiOzs7Ozs7Ozs7O0FBQUE7SUFBQTtJQW1CQSxDQUFBO0lBaEJBLGdCQUFBLEdBQUEsVUFBQSxLQUFBLEVBQUEsUUFBQTtRQUNBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxHQUFBLEtBQUEsQ0FBQSxHQUFBLFFBQUEsQ0FBQTtRQUNBLE9BQUEsSUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLHNCQUFBLEdBQUEsVUFBQSxLQUFBO1FBQ0EsT0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLGNBQUEsQ0FBQSxJQUFBLEdBQUEsS0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEscUJBQUEsR0FBQSxVQUFBLEtBQUE7O1FBQUEsY0FBQTthQUFBLFVBQUEsRUFBQSxxQkFBQSxFQUFBLElBQUE7WUFBQSw2QkFBQTs7UUFDQSxJQUFBLFNBQUEsR0FBQSxJQUFBLEdBQUEsS0FBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLElBQUEsQ0FBQSxRQUFBLENBQUEsS0FBQSxDQUFBLEVBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxPQUFBLENBQUEsS0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxZQUFBLElBQUEsU0FBQSxJQUFBLEdBQUE7SUFDQSxDQUFBO0lBQ0EsVUFBQTtBQUFBLENBbkJBLEFBbUJBLElBQUE7QUNuQkE7Ozs7OztHQU1BO0FBQ0E7Ozs7Ozs7O0dBUUE7QUFDQTtJQUFBLDBCQUFBO0lBQ0EsZ0JBQ0EsT0FBQSxFQUNBLE1BQUE7UUFGQSxjQUlBLGlCQUFBLFNBT0E7UUFWQSxlQUFBLEdBQUEsT0FBQSxDQUFBO1FBSUEsT0FBQSxDQUFBLE9BQUEsR0FBQSxDQUFBLENBQUEsTUFBQSxDQUFBLEVBQUEsRUFBQSxJQUFBLG1CQUFBLEVBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTtRQUNBLE9BQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxHQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsRUFBQSxFQUFBLE9BQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLE9BQUEsQ0FBQSxPQUFBLEVBQUEsQ0FBQSxDQUFBO1FBQ0EsT0FBQSxDQUFBLFVBQUEsR0FBQSxPQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLE9BQUEsQ0FBQSxPQUFBLEVBQUE7WUFDQSxPQUFBLENBQUEsUUFBQSxFQUFBLENBQUE7U0FDQTs7SUFDQSxDQUFBO0lBVUEseUJBQUEsR0FBQTtRQUNBLElBQUEsUUFBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxPQUFBLENBQUEsS0FBQSxDQUFBO1lBQ0EsUUFBQSxDQUFBLEtBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQTtZQUNBLENBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLEVBQUEsQ0FBQSxPQUFBLEVBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxTQUFBLEVBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxjQUFBLENBQUEsQ0FBQTtTQUNBO0lBQ0EsQ0FBQTtJQUVBLHNCQUFBLEdBQUEsVUFBQSxjQUFBO1FBQ0EsSUFBQSxDQUFBLGNBQUEsR0FBQSxjQUFBLENBQUE7UUFDQSxJQUFBLFFBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxJQUFBLE9BQUEsR0FBQSxDQUFBLENBQUEsR0FBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQSxDQUFBLENBQUE7UUFDQSxJQUFBLE9BQUEsQ0FBQSxNQUFBLEdBQUEsQ0FBQSxFQUFBO1lBQ0EsSUFBQSxJQUFBLEdBQUEsUUFBQSxDQUFBLGFBQUEsQ0FBQSxPQUFBLENBQUEsQ0FBQTtZQUNBLElBQUEsQ0FBQSxJQUFBLEdBQUEsTUFBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLFNBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFNBQUEsQ0FBQTtZQUNBLElBQUEsQ0FBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLENBQUE7WUFDQSxJQUFBLENBQUEsTUFBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsTUFBQSxDQUFBO1lBQ0EsUUFBQSxDQUFBLElBQUEsQ0FBQSxXQUFBLENBQUEsSUFBQSxDQUFBLENBQUE7WUFDQSxPQUFBLEdBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxRQUFBLEVBQUE7Z0JBQ0EsUUFBQSxDQUFBLFdBQUEsQ0FBQSxJQUFBLENBQUEsS0FBQSxDQUFBLENBQUE7WUFDQSxDQUFBLENBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQTtTQUNBO2FBQUE7WUFDQSxPQUFBLENBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxDQUFBO1lBQ0EsT0FBQSxDQUFBLElBQUEsQ0FBQSxVQUFBLEVBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLENBQUE7WUFDQSxPQUFBLENBQUEsSUFBQSxDQUFBLFFBQUEsRUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsRUFBQTtnQkFDQSxPQUFBLENBQUEsTUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxRQUFBLEVBQUE7b0JBQ0EsUUFBQSxDQUFBLFdBQUEsQ0FBQSxJQUFBLENBQUEsS0FBQSxDQUFBLENBQUE7Z0JBQ0EsQ0FBQSxDQUFBLENBQUE7YUFDQTtTQUNBO1FBQ0EsT0FBQSxDQUFBLEtBQUEsRUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLDRCQUFBLEdBQUEsVUFBQSxLQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLGFBQUEsRUFBQTtZQUNBLElBQUEsQ0FBQSxVQUFBLENBQUEsS0FBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxJQUFBLFFBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxDQUFBLENBQUEsSUFBQSxDQUFBLEtBQUEsRUFBQSxVQUFBLENBQUEsRUFBQSxJQUFBO1lBQ0EsUUFBQSxDQUFBLFNBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLDJCQUFBLEdBQUEsVUFBQSxLQUFBO1FBQ0EsSUFBQSxRQUFBLEdBQUEsSUFBQSxFQUNBLElBQUEsQ0FBQTtRQUNBLElBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxVQUFBLEVBQUE7WUFDQSxJQUFBLEdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxXQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsRUFBQSxLQUFBLENBQUEsQ0FBQTtTQUNBO2FBQUE7WUFDQSxJQUFBLEdBQUEsSUFBQSxRQUFBLEVBQUEsQ0FBQTtZQUNBLENBQUEsQ0FBQSxJQUFBLENBQUEsS0FBQSxFQUFBLFVBQUEsQ0FBQSxFQUFBLElBQUE7Z0JBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxRQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQTtZQUNBLENBQUEsQ0FBQSxDQUFBO1NBQ0E7UUFDQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsY0FBQSxDQUFBLEtBQUEsS0FBQSxFQUFBO1lBQ0EsT0FBQSxDQUFBLEdBQUEsQ0FBQSx3QkFBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1NBQ0E7UUFDQSxJQUFBLENBQUEsVUFBQSxDQUFBLElBQUEsRUFBQSxVQUFBLElBQUE7WUFDQSxJQUFBLElBQUEsWUFBQSxLQUFBLEVBQUE7Z0JBQ0EsQ0FBQSxDQUFBLElBQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxDQUFBLEVBQUEsSUFBQTtvQkFDQSxRQUFBLENBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxNQUFBLENBQUEsRUFBQSxFQUFBLFFBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxFQUFBLElBQUEsQ0FBQSxDQUFBLENBQUE7Z0JBQ0EsQ0FBQSxDQUFBLENBQUE7Z0JBQ0EsT0FBQTthQUNBO1lBQ0EsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsTUFBQSxDQUFBLEVBQUEsRUFBQSxRQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsMEJBQUEsR0FBQSxVQUFBLElBQUE7UUFDQSxJQUFBLFFBQUEsR0FBQSxJQUFBLEVBQ0EsSUFBQSxFQUNBLFNBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFVBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsU0FBQSxLQUFBLEtBQUEsRUFBQTtZQUNBLE9BQUEsQ0FBQSxHQUFBLENBQUEsb0JBQUEsQ0FBQSxDQUFBO1lBQ0EsT0FBQTtTQUNBO1FBQ0EsSUFBQSxTQUFBLEVBQUE7WUFDQSxJQUFBLEdBQUEsU0FBQSxDQUFBO1NBQ0E7YUFBQTtZQUNBLElBQUEsR0FBQSxJQUFBLFFBQUEsRUFBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQTtTQUNBO1FBRUEsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsRUFBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLGNBQUEsQ0FBQSxLQUFBLEtBQUEsRUFBQTtZQUNBLE9BQUEsQ0FBQSxHQUFBLENBQUEsd0JBQUEsQ0FBQSxDQUFBO1lBQ0EsT0FBQTtTQUNBO1FBQ0EsSUFBQSxDQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxJQUFBO1lBQ0EsUUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsTUFBQSxDQUFBLEVBQUEsRUFBQSxRQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsMkJBQUEsR0FBQSxVQUFBLElBQUEsRUFBQSxFQUFBO1FBQ0EsSUFBQSxRQUFBLEdBQUEsSUFBQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLEdBQUE7WUFDQSxHQUFBLEVBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxHQUFBO1lBQ0EsSUFBQSxFQUFBLE1BQUE7WUFDQSxJQUFBLEVBQUEsSUFBQTtZQUNBLEtBQUEsRUFBQSxLQUFBO1lBQ0EsV0FBQSxFQUFBLEtBQUE7WUFDQSxXQUFBLEVBQUEsS0FBQTtZQUNBLE9BQUEsRUFBQSxVQUFBLElBQUE7Z0JBQ0EsSUFBQSxHQUFBLFFBQUEsQ0FBQSxPQUFBLENBQUEsT0FBQSxFQUFBLElBQUEsRUFBQSxRQUFBLENBQUEsY0FBQSxDQUFBLENBQUE7Z0JBQ0EsSUFBQSxJQUFBLElBQUEsS0FBQSxFQUFBO29CQUNBLE9BQUEsQ0FBQSxHQUFBLENBQUEsdUJBQUEsQ0FBQSxDQUFBO29CQUNBLE9BQUE7aUJBQ0E7Z0JBQ0EsRUFBQSxJQUFBLEVBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtZQUNBLENBQUE7U0FDQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsRUFBQTtZQUNBLElBQUEsQ0FBQSxTQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLE9BQUEsQ0FBQTtTQUNBO1FBQ0EsSUFBQSxJQUFBLENBQUEsUUFBQSxDQUFBLFVBQUEsQ0FBQSxFQUFBO1lBQ0EsSUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBO2dCQUNBLElBQUEsR0FBQSxHQUFBLENBQUEsQ0FBQSxZQUFBLENBQUEsR0FBQSxFQUFBLENBQUE7Z0JBQ0EsSUFBQSxVQUFBLElBQUEsR0FBQSxDQUFBLE1BQUEsRUFBQTtvQkFDQSxHQUFBLENBQUEsTUFBQSxDQUFBLGdCQUFBLENBQUEsVUFBQSxFQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxFQUFBLEtBQUEsQ0FBQSxDQUFBO29CQUNBLE9BQUEsR0FBQSxDQUFBO2lCQUNBO1lBQ0EsQ0FBQSxDQUFBO1NBQ0E7UUFDQSxDQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUVBLCtCQUFBLEdBQUEsVUFBQSxRQUFBO1FBQ0EsSUFBQSxXQUFBLEdBQUEsQ0FBQSxNQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsUUFBQSxJQUFBLENBQUEsRUFBQTtZQUNBLE9BQUEsTUFBQSxDQUFBO1NBQ0E7UUFDQSxJQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsS0FBQSxDQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsUUFBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsSUFBQSxDQUFBLElBQUEsQ0FBQSxFQUFBO1lBQ0EsT0FBQSxRQUFBLEdBQUEsV0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBO1NBQ0E7UUFDQSxPQUFBLENBQUEsUUFBQSxHQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsSUFBQSxFQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsT0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLFdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtJQUNBLENBQUE7SUFHQSw0QkFBQSxHQUFBLFVBQUEsSUFBQSxFQUFBLEVBQUE7UUFDQSxJQUFBLFNBQUEsR0FBQSxJQUFBLEdBQUEsSUFBQSxFQUNBLEtBQUEsR0FBQSxJQUFBLEVBQ0EsU0FBQSxHQUFBLElBQUEsQ0FBQSxJQUFBLEVBQ0EsSUFBQSxFQUNBLE1BQUEsR0FBQSxJQUFBLENBQUEsSUFBQSxDQUFBLFNBQUEsR0FBQSxTQUFBLENBQUEsRUFDQSxLQUFBLEdBQUEsQ0FBQSxFQUNBLFdBQUEsR0FBQTtZQUNBLElBQUEsUUFBQSxHQUFBLEtBQUEsR0FBQSxTQUFBLEVBQ0EsTUFBQSxHQUFBLElBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQSxLQUFBLEdBQUEsQ0FBQSxDQUFBLEdBQUEsU0FBQSxFQUFBLFNBQUEsQ0FBQSxFQUNBLElBQUEsR0FBQSxJQUFBLFFBQUEsRUFBQSxDQUFBO1lBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxLQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsS0FBQSxDQUFBLFFBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxJQUFBLEVBQUE7Z0JBQ0EsSUFBQSxDQUFBLE1BQUEsQ0FBQSxNQUFBLEVBQUEsSUFBQSxDQUFBLENBQUE7YUFDQTtZQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsV0FBQSxFQUFBLElBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtZQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsT0FBQSxFQUFBLFNBQUEsR0FBQSxFQUFBLENBQUEsQ0FBQTtZQUNBLElBQUEsQ0FBQSxNQUFBLENBQUEsUUFBQSxFQUFBLENBQUEsS0FBQSxJQUFBLENBQUEsTUFBQSxHQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsS0FBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxHQUFBLEVBQUEsQ0FBQSxDQUFBO1lBQ0EsS0FBQSxDQUFBLFVBQUEsQ0FBQSxJQUFBLEVBQUEsVUFBQSxHQUFBO2dCQUNBLEVBQUEsSUFBQSxFQUFBLENBQUE7b0JBQ0EsS0FBQSxFQUFBLFNBQUE7b0JBQ0EsSUFBQSxFQUFBLE1BQUE7aUJBQ0EsRUFBQSxLQUFBLENBQUEsY0FBQSxDQUFBLENBQUE7Z0JBQ0EsSUFBQSxLQUFBLEtBQUEsQ0FBQSxNQUFBLEdBQUEsQ0FBQSxDQUFBLEVBQUE7b0JBQ0EsS0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBLENBQUEsTUFBQSxDQUFBLEVBQUEsRUFBQSxLQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsRUFBQSxHQUFBLENBQUEsQ0FBQSxDQUFBO29CQUNBLE9BQUE7aUJBQ0E7Z0JBQ0EsSUFBQSxHQUFBLEdBQUEsQ0FBQSxJQUFBLENBQUE7Z0JBQ0EsS0FBQSxFQUFBLENBQUE7Z0JBQ0EsV0FBQSxFQUFBLENBQUE7WUFDQSxDQUFBLENBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQTtRQUNBLFdBQUEsRUFBQSxDQUFBO0lBQ0EsQ0FBQTtJQUdBLGtCQUFBO0lBRUEsOEJBQUEsR0FBQSxVQUFBLElBQUEsRUFBQSxPQUFBLEVBQUEsRUFBQTtRQUNBLElBQUEsS0FBQSxHQUFBLElBQUEsVUFBQSxFQUFBLEVBQ0EsUUFBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLG1JQUFBO1FBQ0EsS0FBQSxDQUFBLGFBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtRQUNBLEtBQUEsQ0FBQSxNQUFBLEdBQUE7WUFDQSxJQUFBLEVBQUEsR0FBQSxJQUFBLENBQUEsTUFBQSxDQUFBO1lBQ0EsUUFBQSxDQUFBLGNBQUEsQ0FBQSxFQUFBLEVBQUEsT0FBQSxFQUFBLEVBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBO0lBQ0EsQ0FBQTtJQUNBLCtCQUFBLEdBQUEsVUFBQSxJQUFBLEVBQUEsR0FBQSxFQUFBLFFBQUE7UUFDQSxJQUFBLEdBQUEsR0FBQSxJQUFBLEtBQUEsRUFBQSxDQUFBO1FBQ0EsR0FBQSxDQUFBLEdBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxHQUFBLENBQUEsTUFBQSxHQUFBO1lBQ0EsSUFBQSxJQUFBLEdBQUEsSUFBQSxDQUFBO1lBQ0EsVUFBQTtZQUNBLElBQUEsQ0FBQSxHQUFBLElBQUEsQ0FBQSxLQUFBLEVBQ0EsQ0FBQSxHQUFBLElBQUEsQ0FBQSxNQUFBLEVBQ0EsS0FBQSxHQUFBLENBQUEsR0FBQSxDQUFBLENBQUE7WUFDQSxDQUFBLEdBQUEsR0FBQSxDQUFBLEtBQUEsSUFBQSxDQUFBLENBQUE7WUFDQSxDQUFBLEdBQUEsR0FBQSxDQUFBLE1BQUEsSUFBQSxDQUFBLENBQUEsR0FBQSxLQUFBLENBQUEsQ0FBQTtZQUNBLElBQUEsT0FBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBLGFBQUE7WUFDQSxVQUFBO1lBQ0EsSUFBQSxNQUFBLEdBQUEsUUFBQSxDQUFBLGFBQUEsQ0FBQSxRQUFBLENBQUEsRUFDQSxHQUFBLEdBQUEsTUFBQSxDQUFBLFVBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQTtZQUNBLFNBQUE7WUFDQSxJQUFBLEdBQUEsR0FBQSxRQUFBLENBQUEsZUFBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBO1lBQ0EsR0FBQSxDQUFBLFNBQUEsR0FBQSxDQUFBLENBQUE7WUFDQSxJQUFBLEdBQUEsR0FBQSxRQUFBLENBQUEsZUFBQSxDQUFBLFFBQUEsQ0FBQSxDQUFBO1lBQ0EsR0FBQSxDQUFBLFNBQUEsR0FBQSxDQUFBLENBQUE7WUFDQSxNQUFBLENBQUEsZ0JBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtZQUNBLE1BQUEsQ0FBQSxnQkFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO1lBQ0EsR0FBQSxDQUFBLFNBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQSxFQUFBLENBQUEsRUFBQSxDQUFBLEVBQUEsQ0FBQSxDQUFBLENBQUE7WUFDQSxPQUFBO1lBQ0EsSUFBQSxHQUFBLENBQUEsT0FBQSxJQUFBLEdBQUEsQ0FBQSxPQUFBLElBQUEsQ0FBQSxJQUFBLEdBQUEsQ0FBQSxPQUFBLEdBQUEsQ0FBQSxFQUFBO2dCQUNBLE9BQUEsR0FBQSxHQUFBLENBQUEsT0FBQSxDQUFBO2FBQ0E7WUFDQSx3QkFBQTtZQUNBLElBQUEsTUFBQSxHQUFBLE1BQUEsQ0FBQSxTQUFBLENBQUEsWUFBQSxFQUFBLE9BQUEsQ0FBQSxDQUFBO1lBQ0EsaUJBQUE7WUFDQSxRQUFBLENBQUEsTUFBQSxDQUFBLENBQUE7UUFDQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBQ0E7Ozs7T0FJQTtJQUNBLHVDQUFBLEdBQUEsVUFBQSxPQUFBO1FBQ0EsSUFBQSxHQUFBLEdBQUEsT0FBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsRUFBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLEtBQUEsQ0FBQSxTQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsRUFDQSxJQUFBLEdBQUEsSUFBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxFQUFBLENBQUEsR0FBQSxJQUFBLENBQUEsTUFBQSxFQUFBLEtBQUEsR0FBQSxJQUFBLFVBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtRQUNBLE9BQUEsQ0FBQSxFQUFBLEVBQUE7WUFDQSxLQUFBLENBQUEsQ0FBQSxDQUFBLEdBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTtTQUNBO1FBQ0EsT0FBQSxJQUFBLElBQUEsQ0FBQSxDQUFBLEtBQUEsQ0FBQSxFQUFBLEVBQUEsSUFBQSxFQUFBLElBQUEsRUFBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsZUFBQTtJQUVBLHFCQUFBLEdBQUEsVUFBQSxJQUFBO1FBQ0EsSUFBQSxLQUFBLEdBQUEsT0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLFFBQUEsSUFBQSxVQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxDQUFBLElBQUEsQ0FBQSxJQUFBLEVBQUEsSUFBQSxDQUFBLENBQUEsQ0FBQSxDQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBLENBQUE7UUFDQSxJQUFBLEtBQUEsSUFBQSxLQUFBLEVBQUE7WUFDQSxPQUFBLENBQUEsR0FBQSxDQUFBLG1CQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsS0FBQSxLQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsU0FBQSxFQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsY0FBQSxDQUFBLEVBQUE7WUFDQSxPQUFBLENBQUEsR0FBQSxDQUFBLGtCQUFBLENBQUEsQ0FBQTtZQUNBLE9BQUE7U0FDQTtRQUNBLElBQUEsTUFBQSxHQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxDQUFBO1FBQ0EsSUFBQSxJQUFBLENBQUEsY0FBQSxJQUFBLElBQUEsQ0FBQSxjQUFBLENBQUEsTUFBQSxHQUFBLENBQUEsRUFBQTtZQUNBLE1BQUEsR0FBQSxJQUFBLENBQUEsY0FBQSxDQUFBLElBQUEsQ0FBQSxXQUFBLENBQUEsSUFBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQTtTQUNBO1FBQ0EsSUFBQSxDQUFBLE1BQUEsRUFBQTtZQUNBLE9BQUEsQ0FBQSxHQUFBLENBQUEsdUJBQUEsQ0FBQSxDQUFBO1lBQ0EsT0FBQTtTQUNBO1FBQ0EsSUFBQSxJQUFBLEdBQUEsTUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsUUFBQSxHQUFBLElBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxHQUFBO1lBQ0EsSUFBQSxJQUFBLEdBQUEsUUFBQSxDQUFBLFVBQUEsQ0FBQSxHQUFBLEVBQUEsUUFBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBO1lBQ0EsSUFBQSxJQUFBLENBQUEsTUFBQSxJQUFBLENBQUEsRUFBQTtnQkFDQSxPQUFBO2FBQ0E7WUFDQSxJQUFBLENBQUEsSUFBQSxDQUFBLFVBQUEsQ0FBQSxFQUFBLE9BQUE7Z0JBQ0EsSUFBQSxHQUFBLEdBQUEsQ0FBQSxDQUFBLE9BQUEsQ0FBQSxDQUFBO2dCQUNBLElBQUEsR0FBQSxDQUFBLEVBQUEsQ0FBQSxPQUFBLENBQUEsSUFBQSxHQUFBLENBQUEsRUFBQSxDQUFBLFVBQUEsQ0FBQSxFQUFBO29CQUNBLEdBQUEsQ0FBQSxHQUFBLENBQUEsS0FBQSxDQUFBLENBQUE7b0JBQ0EsT0FBQTtpQkFDQTtnQkFDQSxJQUFBLEdBQUEsQ0FBQSxFQUFBLENBQUEsS0FBQSxDQUFBLEVBQUE7b0JBQ0EsR0FBQSxDQUFBLElBQUEsQ0FBQSxLQUFBLEVBQUEsS0FBQSxDQUFBLENBQUE7b0JBQ0EsT0FBQTtpQkFDQTtnQkFDQSxJQUFBLFFBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxFQUFBO29CQUNBLEdBQUEsQ0FBQSxNQUFBLENBQUEsS0FBQSxDQUFBLENBQUE7aUJBQ0E7cUJBQUE7b0JBQ0EsR0FBQSxDQUFBLE9BQUEsQ0FBQSxLQUFBLENBQUEsQ0FBQTtpQkFDQTtZQUNBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsd0JBQUEsR0FBQTtRQUNBLElBQUEsQ0FBQSxJQUFBLENBQUEsT0FBQSxJQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsTUFBQSxHQUFBLENBQUEsRUFBQTtZQUNBLE9BQUEsRUFBQSxDQUFBO1NBQ0E7UUFDQSxJQUFBLElBQUEsR0FBQSxFQUFBLENBQUE7UUFDQSxJQUFBLEdBQUEsR0FBQSxJQUFBLENBQUEsT0FBQSxDQUFBLElBQUEsQ0FBQSxXQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxHQUFBLEVBQUE7WUFDQSxPQUFBLElBQUEsQ0FBQTtTQUNBO1FBQ0EsSUFBQSxJQUFBLEdBQUEsR0FBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtRQUNBLElBQUEsQ0FBQSxPQUFBLENBQUEsVUFBQSxJQUFBO1lBQ0EsSUFBQSxRQUFBLEdBQUEsSUFBQSxDQUFBLEtBQUEsQ0FBQSxHQUFBLENBQUEsQ0FBQTtZQUNBLElBQUEsR0FBQSxHQUFBLFFBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQSxJQUFBLEVBQUEsQ0FBQTtZQUNBLElBQUEsR0FBQSxFQUFBO2dCQUNBLElBQUEsQ0FBQSxHQUFBLENBQUEsR0FBQSxRQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxFQUFBLENBQUE7YUFDQTtRQUNBLENBQUEsQ0FBQSxDQUFBO1FBQ0EsT0FBQSxJQUFBLENBQUE7SUFDQSxDQUFBO0lBRUEsd0JBQUEsR0FBQSxVQUFBLElBQUE7UUFDQSxJQUFBLElBQUEsR0FBQSxPQUFBLElBQUEsQ0FBQSxPQUFBLENBQUEsUUFBQSxJQUFBLFVBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLENBQUEsSUFBQSxDQUFBLElBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxRQUFBLENBQUE7UUFDQSxLQUFBLElBQUEsQ0FBQSxJQUFBLElBQUEsRUFBQTtZQUNBLElBQUEsSUFBQSxDQUFBLGNBQUEsQ0FBQSxDQUFBLENBQUEsRUFBQTtnQkFDQSxJQUFBLEdBQUEsSUFBQSxDQUFBLE9BQUEsQ0FBQSxJQUFBLE1BQUEsQ0FBQSxHQUFBLEdBQUEsQ0FBQSxHQUFBLEdBQUEsRUFBQSxHQUFBLENBQUEsRUFBQSxJQUFBLENBQUEsQ0FBQSxDQUFBLENBQUEsQ0FBQTthQUNBO1NBQ0E7UUFDQSxPQUFBLElBQUEsQ0FBQTtJQUNBLENBQUE7SUFDQSxhQUFBO0FBQUEsQ0FoVkEsQUFnVkEsQ0FoVkEsR0FBQSxHQWdWQTtBQTJCQTtJQUFBO1FBRUEsU0FBQSxHQUFBLE1BQUEsQ0FBQTtRQUNBLGFBQUEsR0FBQSxJQUFBLENBQUE7UUFDQSxhQUFBLEdBQUEsT0FBQSxDQUFBO1FBQ0EsMkJBQUE7UUFDQSxjQUFBLEdBQUEsU0FBQSxDQUFBO1FBQ0EsbUJBQUEsR0FBQTtZQUNBLENBQUEsQ0FBQSxJQUFBLENBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQSxNQUFBLEVBQUEsQ0FBQTtRQUNBLENBQUEsQ0FBQTtRQUNBLGFBQUEsR0FBQSxLQUFBLENBQUE7UUFDQSxrQkFBQSxHQUFBLEtBQUEsQ0FBQTtRQUNBLFNBQUEsR0FBQSxFQUFBLENBQUE7UUFDQSxjQUFBLEdBQUEsY0FBQSxDQUFBO1FBQ0EsV0FBQSxHQUFBLEVBQUEsQ0FBQTtRQUNBLFlBQUEsR0FBQSxVQUFBLElBQUE7WUFDQSxpQkFBQTtZQUNBLElBQUEsT0FBQSxJQUFBLElBQUEsUUFBQSxFQUFBO2dCQUNBLElBQUEsR0FBQSxJQUFBLENBQUEsS0FBQSxDQUFBLElBQUEsQ0FBQSxDQUFBO2FBQ0E7WUFDQSxJQUFBLElBQUEsQ0FBQSxJQUFBLElBQUEsQ0FBQSxFQUFBO2dCQUNBLE9BQUEsSUFBQSxDQUFBLElBQUEsQ0FBQTthQUNBO1lBQ0EsT0FBQSxLQUFBLENBQUE7UUFDQSxDQUFBLENBQUE7UUFDQSxZQUFBLEdBQUEsSUFBQSxDQUFBO1FBQ0EsZUFBQSxHQUFBLFVBQUEsR0FBQTtZQUNBLE9BQUEsQ0FBQSxDQUFBLEdBQUEsQ0FBQSxDQUFBO1FBQ0EsQ0FBQSxDQUFBO1FBQ0Esc0VBQUE7UUFDQSxnREFBQTtRQUNBLHFDQUFBO1FBQ0EsMkJBQUE7UUFDQSxvQ0FBQTtRQUNBLHVFQUFBO1FBQ0EseUNBQUE7UUFDQSxpRUFBQTtRQUNBLG9GQUFBO1FBQ0EscUNBQUE7UUFDQSxjQUFBO1FBQ0Esa0JBQUE7UUFDQSxRQUFBO1FBQ0EsSUFBQTtJQUNBLENBQUE7SUFBQSwwQkFBQTtBQUFBLENBM0NBLEFBMkNBLElBQUE7QUFHQSxDQUFBO0FBQUEsQ0FBQSxVQUFBLENBQUE7SUFDQSxDQUFBLENBQUEsRUFBQSxDQUFBLE1BQUEsR0FBQSxVQUFBLE1BQUE7UUFDQSxPQUFBLElBQUEsTUFBQSxDQUFBLElBQUEsRUFBQSxNQUFBLENBQUEsQ0FBQTtJQUNBLENBQUEsQ0FBQTtBQUNBLENBQUEsQ0FBQSxDQUFBLE1BQUEsQ0FBQSxDQUFBIiwiZmlsZSI6ImpxdWVyeS51cGxvYWQuanMiLCJzb3VyY2VzQ29udGVudCI6WyJhYnN0cmFjdCBjbGFzcyBFdmUge1xyXG4gICAgcHVibGljIG9wdGlvbnM6IGFueTtcclxuXHJcbiAgICBwdWJsaWMgb24oZXZlbnQ6IHN0cmluZywgY2FsbGJhY2s6IEZ1bmN0aW9uKTogdGhpcyB7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zWydvbicgKyBldmVudF0gPSBjYWxsYmFjaztcclxuICAgICAgICByZXR1cm4gdGhpcztcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgaGFzRXZlbnQoZXZlbnQ6IHN0cmluZyk6IGJvb2xlYW4ge1xyXG4gICAgICAgIHJldHVybiB0aGlzLm9wdGlvbnMuaGFzT3duUHJvcGVydHkoJ29uJyArIGV2ZW50KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdHJpZ2dlcihldmVudDogc3RyaW5nLCAuLi4gYXJnczogYW55W10pIHtcclxuICAgICAgICBsZXQgcmVhbEV2ZW50ID0gJ29uJyArIGV2ZW50O1xyXG4gICAgICAgIGlmICghdGhpcy5oYXNFdmVudChldmVudCkpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gdGhpcy5vcHRpb25zW3JlYWxFdmVudF0uY2FsbCh0aGlzLCAuLi5hcmdzKTtcclxuICAgIH1cclxufSIsIi8qIVxyXG4gKiBqcXVlcnkudXBsb2FkIC0gaHR0cHM6Ly9naXRodWIuY29tL3p4NjQ4MzgzMDc5L1pvRHJlYW0uVUlcclxuICogVmVyc2lvbiAtIDEuMFxyXG4gKiBMaWNlbnNlZCB1bmRlciB0aGUgTUlUIGxpY2Vuc2UgLSBodHRwOi8vb3BlbnNvdXJjZS5vcmcvbGljZW5zZXMvTUlUXHJcbiAqXHJcbiAqIENvcHlyaWdodCAoYykgMjAxNyBab0RyZWFtXHJcbiAqL1xyXG4vKipcclxuICogRVhBTVBMRTpcclxuICogJCgnI3VwbG9hZCcpLnVwbG9hZCh7XHJcbiAqICAgICAgdXJsOiAndXBsb2FkLnBocCcsXHJcbiAqICAgICAgbmFtZTogJ2ZpbGUnLFxyXG4gKiAgICAgIHRlbXBsYXRlOiAne3VybH0nLFxyXG4gKiAgICAgIGdyaWQ6ICcuaW1nJ1xyXG4gKiB9KTtcclxuICovXHJcbmNsYXNzIFVwbG9hZCBleHRlbmRzIEV2ZSB7XHJcbiAgICBjb25zdHJ1Y3RvcihcclxuICAgICAgICBwdWJsaWMgZWxlbWVudD86IEpRdWVyeSxcclxuICAgICAgICBvcHRpb24/OiBVcGxvYWRPcHRpb25cclxuICAgICkge1xyXG4gICAgICAgIHN1cGVyKCk7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zID0gJC5leHRlbmQoe30sIG5ldyBVcGxvYWREZWZhdWx0T3B0aW9uKCksIG9wdGlvbik7XHJcbiAgICAgICAgdGhpcy5vcHRpb25zLmRhdGEgPSAkLmV4dGVuZCh7fSwgdGhpcy5vcHRpb25zLmRhdGEsIHRoaXMuZ2V0RGF0YSgpKTtcclxuICAgICAgICB0aGlzLmdldEVsZW1lbnQgPSB0aGlzLm9wdGlvbnMuZ2V0RWxlbWVudC5iaW5kKHRoaXMpO1xyXG4gICAgICAgIGlmICh0aGlzLmVsZW1lbnQpIHtcclxuICAgICAgICAgICAgdGhpcy5hZGRFdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgb3B0aW9uczogVXBsb2FkT3B0aW9uO1xyXG5cclxuICAgIHB1YmxpYyBzdWNjZXNzOiAoZGF0YTogYW55LCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiBib29sZWFuO1xyXG5cclxuICAgIHB1YmxpYyBnZXRFbGVtZW50OiAodGFnOiBzdHJpbmcsIGN1cnJlbnRFbGVtZW50OiBKUXVlcnkpID0+IEpRdWVyeTtcclxuXHJcbiAgICBwcml2YXRlIGN1cnJlbnRFbGVtZW50OiBKUXVlcnk7XHJcblxyXG4gICAgcHVibGljIGFkZEV2ZW50KCkge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgdGhpcy5lbGVtZW50LmNsaWNrKGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5zdGFydCgkKHRoaXMpKTtcclxuICAgICAgICB9KTtcclxuICAgICAgICBpZiAodGhpcy5vcHRpb25zLmdyaWQpIHtcclxuICAgICAgICAgICAgJCh0aGlzLm9wdGlvbnMuZ3JpZCkub24oJ2NsaWNrJywgdGhpcy5vcHRpb25zLnJlbW92ZVRhZywgdGhpcy5vcHRpb25zLnJlbW92ZUNhbGxiYWNrKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHN0YXJ0KGN1cnJlbnRFbGVtZW50PzogSlF1ZXJ5KSB7XHJcbiAgICAgICAgdGhpcy5jdXJyZW50RWxlbWVudCA9IGN1cnJlbnRFbGVtZW50O1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgbGV0IGVsZW1lbnQgPSAkKCcuJyArIHRoaXMub3B0aW9ucy5maWxlQ2xhc3MpO1xyXG4gICAgICAgIGlmIChlbGVtZW50Lmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgbGV0IGZpbGUgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdpbnB1dCcpO1xyXG4gICAgICAgICAgICBmaWxlLnR5cGUgPSAnZmlsZSc7XHJcbiAgICAgICAgICAgIGZpbGUuY2xhc3NOYW1lID0gdGhpcy5vcHRpb25zLmZpbGVDbGFzcztcclxuICAgICAgICAgICAgZmlsZS5tdWx0aXBsZSA9IHRoaXMub3B0aW9ucy5tdWx0aXBsZTtcclxuICAgICAgICAgICAgZmlsZS5hY2NlcHQgPSB0aGlzLm9wdGlvbnMuZmlsdGVyO1xyXG4gICAgICAgICAgICBkb2N1bWVudC5ib2R5LmFwcGVuZENoaWxkKGZpbGUpO1xyXG4gICAgICAgICAgICBlbGVtZW50ID0gJChmaWxlKS5iaW5kKCdjaGFuZ2UnLCBmdW5jdGlvbigpIHtcclxuICAgICAgICAgICAgICAgIGluc3RhbmNlLnVwbG9hZEZpbGVzKHRoaXMuZmlsZXMpO1xyXG4gICAgICAgICAgICB9KS5oaWRlKCk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgZWxlbWVudC52YWwoJycpO1xyXG4gICAgICAgICAgICBlbGVtZW50LmF0dHIoJ211bHRpcGxlJywgdGhpcy5vcHRpb25zLm11bHRpcGxlID8gJ3RydWUnIDogJ2ZhbHNlJyk7XHJcbiAgICAgICAgICAgIGVsZW1lbnQuYXR0cignYWNjZXB0JywgdGhpcy5vcHRpb25zLmZpbHRlcik7XHJcbiAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuZHluYW1pYykge1xyXG4gICAgICAgICAgICAgICAgZWxlbWVudC51bmJpbmQoJ2NoYW5nZScpLmJpbmQoJ2NoYW5nZScsIGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGluc3RhbmNlLnVwbG9hZEZpbGVzKHRoaXMuZmlsZXMpO1xyXG4gICAgICAgICAgICAgICAgfSk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9XHJcbiAgICAgICAgZWxlbWVudC5jbGljaygpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGxvYWRGaWxlcyhmaWxlcykge1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMuYWxsb3dNdWx0aXBsZSkge1xyXG4gICAgICAgICAgICB0aGlzLnVwbG9hZE1hbnkoZmlsZXMpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXM7XHJcbiAgICAgICAgJC5lYWNoKGZpbGVzLCBmdW5jdGlvbihpLCBmaWxlKSB7XHJcbiAgICAgICAgICAgIGluc3RhbmNlLnVwbG9hZE9uZShmaWxlKTtcclxuICAgICAgICB9KTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgdXBsb2FkTWFueShmaWxlcykge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXMsXHJcbiAgICAgICAgICAgIGRhdGE6IEZvcm1EYXRhO1xyXG4gICAgICAgIGlmICh0aGlzLm9wdGlvbnMub25kZWFsZmlsZSkge1xyXG4gICAgICAgICAgICBkYXRhID0gdGhpcy5vcHRpb25zLm9uZGVhbGZpbGVzLmNhbGwodGhpcywgZmlsZXMpO1xyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGRhdGEgPSBuZXcgRm9ybURhdGEoKTtcclxuICAgICAgICAgICAgJC5lYWNoKGZpbGVzLCBmdW5jdGlvbihpLCBmaWxlKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmFwcGVuZChpbnN0YW5jZS5vcHRpb25zLm5hbWUsIGZpbGUpO1xyXG4gICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKHRoaXMudHJpZ2dlcignYmVmb3JlJywgZGF0YSwgdGhpcy5jdXJyZW50RWxlbWVudCkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmUgdXBsb2FkIGlzIGZhbHNlJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGxvYWRGb3JtKGRhdGEsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEgaW5zdGFuY2VvZiBBcnJheSkge1xyXG4gICAgICAgICAgICAgICAgJC5lYWNoKGRhdGEsIGZ1bmN0aW9uKGksIGl0ZW0pIHtcclxuICAgICAgICAgICAgICAgICAgICBpbnN0YW5jZS5kZWFsKCQuZXh0ZW5kKHt9LCBpbnN0YW5jZS5vcHRpb25zLmRhdGEsIGl0ZW0pKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGluc3RhbmNlLmRlYWwoJC5leHRlbmQoe30sIGluc3RhbmNlLm9wdGlvbnMuZGF0YSwgZGF0YSkpO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyB1cGxvYWRPbmUoZmlsZTogRmlsZSkge1xyXG4gICAgICAgIGxldCBpbnN0YW5jZSA9IHRoaXMsXHJcbiAgICAgICAgICAgIGRhdGE6IEZvcm1EYXRhLFxyXG4gICAgICAgICAgICBkZWFsX2RhdGEgPSB0aGlzLnRyaWdnZXIoJ2RlYWxmaWxlJywgZmlsZSk7XHJcbiAgICAgICAgaWYgKGRlYWxfZGF0YSA9PT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2RlYWwgZmlsZSBpcyBmYWxzZScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkZWFsX2RhdGEpIHtcclxuICAgICAgICAgICAgZGF0YSA9IGRlYWxfZGF0YTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICBkYXRhID0gbmV3IEZvcm1EYXRhKCk7XHJcbiAgICAgICAgICAgIGRhdGEuYXBwZW5kKHRoaXMub3B0aW9ucy5uYW1lLCBmaWxlKTtcclxuICAgICAgICB9XHJcbiAgICAgICAgXHJcbiAgICAgICAgaWYgKHRoaXMudHJpZ2dlcignYmVmb3JlJywgZGF0YSwgdGhpcy5jdXJyZW50RWxlbWVudCkgPT09IGZhbHNlKSB7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKCdiZWZvcmUgdXBsb2FkIGlzIGZhbHNlJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgdGhpcy51cGxvYWRGb3JtKGRhdGEsIGZ1bmN0aW9uKGRhdGEpIHtcclxuICAgICAgICAgICAgaW5zdGFuY2UuZGVhbCgkLmV4dGVuZCh7fSwgaW5zdGFuY2Uub3B0aW9ucy5kYXRhLCBkYXRhKSk7XHJcbiAgICAgICAgfSk7XHJcbiAgICB9XHJcblxyXG4gICAgcHVibGljIHVwbG9hZEZvcm0oZGF0YTogRm9ybURhdGEsIGNiPzogKGRhdGE6IGFueSk9PnZvaWQpIHtcclxuICAgICAgICBsZXQgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIGxldCBvcHRzID0ge1xyXG4gICAgICAgICAgICB1cmw6IHRoaXMub3B0aW9ucy51cmwsXHJcbiAgICAgICAgICAgIHR5cGU6J1BPU1QnLFxyXG4gICAgICAgICAgICBkYXRhOiBkYXRhLFxyXG4gICAgICAgICAgICBjYWNoZTogZmFsc2UsXHJcbiAgICAgICAgICAgIGNvbnRlbnRUeXBlOiBmYWxzZSwgICAgLy/kuI3lj6/nvLpcclxuICAgICAgICAgICAgcHJvY2Vzc0RhdGE6IGZhbHNlLCAgICAvL+S4jeWPr+e8ulxyXG4gICAgICAgICAgICBzdWNjZXNzOiBmdW5jdGlvbihkYXRhKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhID0gaW5zdGFuY2UudHJpZ2dlcignYWZ0ZXInLCBkYXRhLCBpbnN0YW5jZS5jdXJyZW50RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZGF0YSA9PSBmYWxzZSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGNvbnNvbGUubG9nKCdhZnRlciB1cGxvYWQgaXMgZmFsc2UnKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBjYiAmJiBjYihkYXRhKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH07XHJcbiAgICAgICAgaWYgKHRoaXMub3B0aW9ucy50aW1lb3V0KSB7XHJcbiAgICAgICAgICAgIG9wdHNbJ3RpbWVvdXQnXSA9IHRoaXMub3B0aW9ucy50aW1lb3V0O1xyXG4gICAgICAgIH1cclxuICAgICAgICBpZiAodGhpcy5oYXNFdmVudCgncHJvZ3Jlc3MnKSkge1xyXG4gICAgICAgICAgICBvcHRzWyd4aHInXSA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgICAgICBsZXQgeGhyID0gJC5hamF4U2V0dGluZ3MueGhyKCk7XHJcbiAgICAgICAgICAgICAgICBpZihvbnByb2dyZXNzICYmIHhoci51cGxvYWQpIHtcclxuICAgICAgICAgICAgICAgICAgICB4aHIudXBsb2FkLmFkZEV2ZW50TGlzdGVuZXIoJ3Byb2dyZXNzJyAsIHRoaXMub3B0aW9ucy5vbnByb2dyZXNzLCBmYWxzZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHhocjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9XHJcbiAgICAgICAgJC5hamF4KG9wdHMpO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBmb3JtYXRGaWxlU2l6ZShmaWxlU2l6ZSk6IHN0cmluZyB7XHJcbiAgICAgICAgbGV0IHNpemVVbml0QXJyID0gWydCeXRlJywnS0InLCdNQicsJ0dCJ107XHJcbiAgICAgICAgaWYgKGZpbGVTaXplID09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIFwiMCBLQlwiO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgaSA9IE1hdGguZmxvb3IoTWF0aC5sb2coZmlsZVNpemUpIC8gTWF0aC5sb2coMTAyNCkpO1xyXG4gICAgICAgIGlmIChpID09IDApIHtcclxuICAgICAgICAgICAgcmV0dXJuIGZpbGVTaXplICsgc2l6ZVVuaXRBcnJbaV07XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiAoZmlsZVNpemUgLyBNYXRoLnBvdygxMDI0LCBpKSkudG9GaXhlZCgxKSArIHNpemVVbml0QXJyW2ldO1xyXG4gICAgfVxyXG5cclxuXHJcbiAgICBwdWJsaWMgc2xpY2VVcGxvYWQoZmlsZTogRmlsZSwgY2I/OiAoZGF0YTogYW55LCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiB2b2lkKSB7XHJcbiAgICAgICAgbGV0IG1heExlbmd0aCA9IDEwMjQgKiAxMDI0LFxyXG4gICAgICAgICAgICBfdGhpcyA9IHRoaXMsXHJcbiAgICAgICAgICAgIHRvdGFsU2l6ZSA9IGZpbGUuc2l6ZSxcclxuICAgICAgICAgICAgbmFtZTogc3RyaW5nLFxyXG4gICAgICAgICAgICBjaHVua3MgPSBNYXRoLmNlaWwodG90YWxTaXplIC8gbWF4TGVuZ3RoKSxcclxuICAgICAgICAgICAgY2h1bmsgPSAwLFxyXG4gICAgICAgICAgICBzdGFydFVwbG9hZCA9IGZ1bmN0aW9uKCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGJsb2JGcm9tID0gY2h1bmsgKiBtYXhMZW5ndGgsXHJcbiAgICAgICAgICAgICAgICAgICAgYmxvYlRvID0gTWF0aC5taW4oKGNodW5rICsgMSkgKiBtYXhMZW5ndGgsIHRvdGFsU2l6ZSksXHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoX3RoaXMub3B0aW9ucy5uYW1lLCBmaWxlLnNsaWNlKGJsb2JGcm9tLCBibG9iVG8pKTtcclxuICAgICAgICAgICAgICAgIGlmIChuYW1lKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ25hbWUnLCBuYW1lKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGRhdGEuYXBwZW5kKCdyZWFsX25hbWUnLCBmaWxlLm5hbWUpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ3RvdGFsJywgdG90YWxTaXplICsgJycpO1xyXG4gICAgICAgICAgICAgICAgZGF0YS5hcHBlbmQoJ3N0YXR1cycsIChjaHVuayA9PSAoY2h1bmtzIC0gMSkgPyAyIDogKGNodW5rID09IDAgPyAwIDogMSkpICsgJycpO1xyXG4gICAgICAgICAgICAgICAgX3RoaXMudXBsb2FkRm9ybShkYXRhLCAocmVzKSA9PiB7XHJcbiAgICAgICAgICAgICAgICAgICAgY2IgJiYgY2Ioe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0b3RhbDogdG90YWxTaXplLFxyXG4gICAgICAgICAgICAgICAgICAgICAgICBzaXplOiBibG9iVG9cclxuICAgICAgICAgICAgICAgICAgICB9LCBfdGhpcy5jdXJyZW50RWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKGNodW5rID09PSAoY2h1bmtzIC0gMSkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgX3RoaXMuZGVhbCgkLmV4dGVuZCh7fSwgX3RoaXMub3B0aW9ucy5kYXRhLCByZXMpKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBuYW1lID0gcmVzLm5hbWU7XHJcbiAgICAgICAgICAgICAgICAgICAgY2h1bmsgKys7XHJcbiAgICAgICAgICAgICAgICAgICAgc3RhcnRVcGxvYWQoKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgICAgICB9O1xyXG4gICAgICAgIHN0YXJ0VXBsb2FkKCk7XHJcbiAgICB9XHJcblxyXG5cclxuICAgIC8qKiDlm77niYfljovnvKkgc3RhcnQgICovXHJcblxyXG4gICAgcHVibGljIHBob3RvQ29tcHJlc3MoZmlsZTogRmlsZSwgb3B0aW9uczogYW55LCBjYjogKGRhdGE6IHN0cmluZykgPT4gdm9pZCl7XHJcbiAgICAgICAgbGV0IHJlYWR5ID0gbmV3IEZpbGVSZWFkZXIoKSxcclxuICAgICAgICAgICAgaW5zdGFuY2UgPSB0aGlzO1xyXG4gICAgICAgIC8q5byA5aeL6K+75Y+W5oyH5a6a55qEQmxvYuWvueixoeaIlkZpbGXlr7nosaHkuK3nmoTlhoXlrrkuIOW9k+ivu+WPluaTjeS9nOWujOaIkOaXtixyZWFkeVN0YXRl5bGe5oCn55qE5YC85Lya5oiQ5Li6RE9ORSzlpoLmnpzorr7nva7kuoZvbmxvYWRlbmTkuovku7blpITnkIbnqIvluo8s5YiZ6LCD55So5LmLLuWQjOaXtixyZXN1bHTlsZ7mgKfkuK3lsIbljIXlkKvkuIDkuKpkYXRhOiBVUkzmoLzlvI/nmoTlrZfnrKbkuLLku6XooajnpLrmiYDor7vlj5bmlofku7bnmoTlhoXlrrkuKi9cclxuICAgICAgICByZWFkeS5yZWFkQXNEYXRhVVJMKGZpbGUpO1xyXG4gICAgICAgIHJlYWR5Lm9ubG9hZCA9IGZ1bmN0aW9uKCl7XHJcbiAgICAgICAgICAgIGxldCByZSA9IHRoaXMucmVzdWx0O1xyXG4gICAgICAgICAgICBpbnN0YW5jZS5fY2FudmFzRGF0YVVSTChyZSwgb3B0aW9ucywgY2IpXHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG4gICAgcHJpdmF0ZSBfY2FudmFzRGF0YVVSTChwYXRoOiBzdHJpbmcsIG9iajogYW55LCBjYWxsYmFjazogKGRhdGE6IHN0cmluZykgPT4gdm9pZCl7XHJcbiAgICAgICAgbGV0IGltZyA9IG5ldyBJbWFnZSgpO1xyXG4gICAgICAgIGltZy5zcmMgPSBwYXRoO1xyXG4gICAgICAgIGltZy5vbmxvYWQgPSBmdW5jdGlvbigpe1xyXG4gICAgICAgICAgICBsZXQgdGhhdDogSW1hZ2UgPSB0aGlzO1xyXG4gICAgICAgICAgICAvLyDpu5jorqTmjInmr5TkvovljovnvKlcclxuICAgICAgICAgICAgbGV0IHcgPSB0aGF0LndpZHRoLFxyXG4gICAgICAgICAgICAgICAgaCA9IHRoYXQuaGVpZ2h0LFxyXG4gICAgICAgICAgICAgICAgc2NhbGUgPSB3IC8gaDtcclxuICAgICAgICAgICAgdyA9IG9iai53aWR0aCB8fCB3O1xyXG4gICAgICAgICAgICBoID0gb2JqLmhlaWdodCB8fCAodyAvIHNjYWxlKTtcclxuICAgICAgICAgICAgbGV0IHF1YWxpdHkgPSAwLjc7ICAvLyDpu5jorqTlm77niYfotKjph4/kuLowLjdcclxuICAgICAgICAgICAgLy/nlJ/miJBjYW52YXNcclxuICAgICAgICAgICAgbGV0IGNhbnZhcyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2NhbnZhcycpLFxyXG4gICAgICAgICAgICAgICAgY3R4ID0gY2FudmFzLmdldENvbnRleHQoJzJkJyk7XHJcbiAgICAgICAgICAgIC8vIOWIm+W7uuWxnuaAp+iKgueCuVxyXG4gICAgICAgICAgICBsZXQgYW53ID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKFwid2lkdGhcIik7XHJcbiAgICAgICAgICAgIGFudy5ub2RlVmFsdWUgPSB3O1xyXG4gICAgICAgICAgICBsZXQgYW5oID0gZG9jdW1lbnQuY3JlYXRlQXR0cmlidXRlKFwiaGVpZ2h0XCIpO1xyXG4gICAgICAgICAgICBhbmgubm9kZVZhbHVlID0gaDtcclxuICAgICAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZU5vZGUoYW53KTtcclxuICAgICAgICAgICAgY2FudmFzLnNldEF0dHJpYnV0ZU5vZGUoYW5oKTtcclxuICAgICAgICAgICAgY3R4LmRyYXdJbWFnZSh0aGF0LCAwLCAwLCB3LCBoKTtcclxuICAgICAgICAgICAgLy8g5Zu+5YOP6LSo6YePXHJcbiAgICAgICAgICAgIGlmKG9iai5xdWFsaXR5ICYmIG9iai5xdWFsaXR5IDw9IDEgJiYgb2JqLnF1YWxpdHkgPiAwKXtcclxuICAgICAgICAgICAgICAgIHF1YWxpdHkgPSBvYmoucXVhbGl0eTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAvLyBxdWFsaXR55YC86LaK5bCP77yM5omA57uY5Yi25Ye655qE5Zu+5YOP6LaK5qih57OKXHJcbiAgICAgICAgICAgIGxldCBiYXNlNjQgPSBjYW52YXMudG9EYXRhVVJMKCdpbWFnZS9qcGVnJywgcXVhbGl0eSk7XHJcbiAgICAgICAgICAgIC8vIOWbnuiwg+WHveaVsOi/lOWbnmJhc2U2NOeahOWAvFxyXG4gICAgICAgICAgICBjYWxsYmFjayhiYXNlNjQpO1xyXG4gICAgICAgIH1cclxuICAgIH1cclxuICAgIC8qKlxyXG4gICAgICog5bCG5LulYmFzZTY055qE5Zu+54mHdXJs5pWw5o2u6L2s5o2i5Li6QmxvYlxyXG4gICAgICogQHBhcmFtIHVybERhdGFcclxuICAgICAqICAgICAgICAgICAg55SodXJs5pa55byP6KGo56S655qEYmFzZTY05Zu+54mH5pWw5o2uXHJcbiAgICAgKi9cclxuICAgIHB1YmxpYyBjb252ZXJ0QmFzZTY0VXJsVG9CbG9iKHVybERhdGE6IHN0cmluZyl7XHJcbiAgICAgICAgdmFyIGFyciA9IHVybERhdGEuc3BsaXQoJywnKSwgbWltZSA9IGFyclswXS5tYXRjaCgvOiguKj8pOy8pWzFdLFxyXG4gICAgICAgICAgICBic3RyID0gYXRvYihhcnJbMV0pLCBuID0gYnN0ci5sZW5ndGgsIHU4YXJyID0gbmV3IFVpbnQ4QXJyYXkobik7XHJcbiAgICAgICAgd2hpbGUobi0tKXtcclxuICAgICAgICAgICAgdThhcnJbbl0gPSBic3RyLmNoYXJDb2RlQXQobik7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIHJldHVybiBuZXcgQmxvYihbdThhcnJdLCB7dHlwZTptaW1lfSk7XHJcbiAgICB9XHJcblxyXG4gICAgLyoqIOWOi+e8qeWkhOeQhmVuZCAgKi9cclxuXHJcbiAgICBwdWJsaWMgZGVhbChkYXRhOiBhbnkpIHtcclxuICAgICAgICBsZXQgdmFsdWUgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnRlbXBsYXRlID09ICdmdW5jdGlvbicgPyB0aGlzLm9wdGlvbnMudGVtcGxhdGUuY2FsbCh0aGlzLCBkYXRhKSA6IHRoaXMucmVwbGFjZShkYXRhKTtcclxuICAgICAgICBpZiAodmFsdWUgPT0gZmFsc2UpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ3RlbXBsYXRlIGlzIGZhbHNlJyk7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKGZhbHNlID09PSB0aGlzLnRyaWdnZXIoJ3N1Y2Nlc3MnLCBkYXRhLCB0aGlzLmN1cnJlbnRFbGVtZW50KSkge1xyXG4gICAgICAgICAgICBjb25zb2xlLmxvZygnc3VjY2VzcyBpcyBmYWxzZScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB1cmxGb3IgPSB0aGlzLm9wdGlvbnMuZ3JpZDtcclxuICAgICAgICBpZiAodGhpcy5jdXJyZW50RWxlbWVudCAmJiB0aGlzLmN1cnJlbnRFbGVtZW50Lmxlbmd0aCA+IDApIHtcclxuICAgICAgICAgICAgdXJsRm9yID0gdGhpcy5jdXJyZW50RWxlbWVudC5hdHRyKCdkYXRhLWdyaWQnKSB8fCB0aGlzLm9wdGlvbnMuZ3JpZDtcclxuICAgICAgICB9XHJcbiAgICAgICAgaWYgKCF1cmxGb3IpIHtcclxuICAgICAgICAgICAgY29uc29sZS5sb2coJ2dyaWQgZWxlbWVudCBpcyBmYWxzZScpO1xyXG4gICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCB0YWdzID0gdXJsRm9yLnNwbGl0KCd8Jyk7XHJcbiAgICAgICAgbGV0IGluc3RhbmNlID0gdGhpcztcclxuICAgICAgICB0YWdzLmZvckVhY2goZnVuY3Rpb24odGFnKSB7XHJcbiAgICAgICAgICAgIGxldCBpdGVtID0gaW5zdGFuY2UuZ2V0RWxlbWVudCh0YWcsIGluc3RhbmNlLmN1cnJlbnRFbGVtZW50KTtcclxuICAgICAgICAgICAgaWYgKGl0ZW0ubGVuZ3RoID09IDApIHtcclxuICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBpdGVtLmVhY2goZnVuY3Rpb24oaSwgZWxlbWVudCkge1xyXG4gICAgICAgICAgICAgICAgbGV0IGVsZSA9ICQoZWxlbWVudCk7XHJcbiAgICAgICAgICAgICAgICBpZiAoZWxlLmlzKCdpbnB1dCcpIHx8IGVsZS5pcygndGV4dGFyZWEnKSkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZS52YWwodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGlmIChlbGUuaXMoJ2ltZycpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgZWxlLmF0dHIoJ3NyYycsIHZhbHVlKTtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm47XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBpZiAoaW5zdGFuY2Uub3B0aW9ucy5pc0FwcGVuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGVsZS5hcHBlbmQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBlbGUucHJlcGVuZCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH0pO1xyXG4gICAgfVxyXG5cclxuICAgIHB1YmxpYyBnZXREYXRhKCk6IGFueSB7XHJcbiAgICAgICAgaWYgKCF0aGlzLmVsZW1lbnQgfHwgdGhpcy5lbGVtZW50Lmxlbmd0aCA8IDEpIHtcclxuICAgICAgICAgICAgcmV0dXJuIHt9O1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgZGF0YSA9IHt9O1xyXG4gICAgICAgIGxldCBhcmcgPSB0aGlzLmVsZW1lbnQuYXR0cignZGF0YS1kYXRhJyk7XHJcbiAgICAgICAgaWYgKCFhcmcpIHtcclxuICAgICAgICAgICAgcmV0dXJuIGRhdGE7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGxldCBhcmdzID0gYXJnLnNwbGl0KCcsJyk7XHJcbiAgICAgICAgYXJncy5mb3JFYWNoKGZ1bmN0aW9uKGl0ZW0pIHtcclxuICAgICAgICAgICAgbGV0IGtleVZhbHVlID0gaXRlbS5zcGxpdCgnOicpO1xyXG4gICAgICAgICAgICBsZXQga2V5ID0ga2V5VmFsdWVbMF0udHJpbSgpO1xyXG4gICAgICAgICAgICBpZiAoa2V5KSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhW2tleV0gPSBrZXlWYWx1ZVsxXS50cmltKCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICB9KTtcclxuICAgICAgICByZXR1cm4gZGF0YTtcclxuICAgIH1cclxuXHJcbiAgICBwdWJsaWMgcmVwbGFjZShkYXRhOiBPYmplY3QpOiBzdHJpbmcge1xyXG4gICAgICAgIGxldCBodG1sOiBzdHJpbmcgPSB0eXBlb2YgdGhpcy5vcHRpb25zLnRlbXBsYXRlID09ICdmdW5jdGlvbicgPyB0aGlzLm9wdGlvbnMudGVtcGxhdGUuY2FsbCh0aGlzLCBkYXRhKSA6IHRoaXMub3B0aW9ucy50ZW1wbGF0ZTtcclxuICAgICAgICBmb3IgKGxldCBpIGluIGRhdGEpIHtcclxuICAgICAgICAgICAgaWYgKGRhdGEuaGFzT3duUHJvcGVydHkoaSkpIHtcclxuICAgICAgICAgICAgICAgIGh0bWwgPSBodG1sLnJlcGxhY2UobmV3IFJlZ0V4cCgneycgKyBpICsgJ30nLCAnZycpLCBkYXRhW2ldKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gaHRtbDtcclxuICAgIH1cclxufVxyXG5cclxuaW50ZXJmYWNlIFVwbG9hZE9wdGlvbiB7XHJcbiAgICBbc2V0dGluZzogc3RyaW5nXTogYW55LFxyXG4gICAgdXJsPzogc3RyaW5nLCAgICAgICAgIC8vIOS4iuS8oOe9keWdgFxyXG4gICAgbmFtZT86IHN0cmluZywgICAgICAgIC8vIOS4iuS8oOWQjVxyXG4gICAgaXNBcHBlbmQ/OiBib29sZWFuLCAgICAvL+WcqOWQjumdouWKoOi/mOaYr+WJjemdouWKoCDvvIzlr7nlpJrkuKrmnInmlYhcclxuICAgIHRlbXBsYXRlPzogc3RyaW5nIHwgRnVuY3Rpb24sICAgIC8vIOaooeadv1xyXG4gICAgZ3JpZD86IHN0cmluZywgICAgICAgIC8vIOijhei9veWuueWZqFxyXG4gICAgZGF0YT86IGFueSwgICAgICAgICAgIC8v6buY6K6k5YC8XHJcbiAgICB0aW1lb3V0PzogbnVtYmVyLFxyXG4gICAgcmVtb3ZlVGFnPzogc3RyaW5nLCAgIC8vIOWIoOmZpOagh+W/l1xyXG4gICAgcmVtb3ZlQ2FsbGJhY2s/OiAoZXZlbnRPYmplY3Q6IEpRdWVyeUV2ZW50T2JqZWN0LCAuLi5ldmVudERhdGE6IGFueVtdKSA9PiBhbnksICAvL+WIoOmZpOinpuWPkeS6i+S7tlxyXG4gICAgbXVsdGlwbGU/OiBib29sZWFuLCAgIC8vIOaYr+WQpuWFgeiuuOS4iuS8oOWkmuS4qlxyXG4gICAgZmlsZUNsYXNzPzogc3RyaW5nLCAgIC8vIOS4iuS8oOaWh+S7tkNsYXNzIOWQjVxyXG4gICAgZmlsdGVyPzogc3RyaW5nLCAgICAgICAvLyDmlofku7bov4fmu6RcclxuICAgIG9uZGVhbGZpbGU/OiAoZmlsZTogRmlsZSkgPT4gRm9ybURhdGEgfCB2b2lkLFxyXG4gICAgb25kZWFsZmlsZXM/OiAoZmlsZTogRmlsZUxpc3QpID0+IEZvcm1EYXRhIHwgdm9pZCxcclxuICAgIG9uYmVmb3JlPzogKGRhdGE6IEZvcm1EYXRhLCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiBhbnksICAvL+mqjOivgeimgeS4iuS8oOeahOaWh+S7tlxyXG4gICAgb25hZnRlcj86IChkYXRhOiBhbnksIGN1cnJlbnRFbGVtZW50OiBKUXVlcnkpID0+IGFueSwgICAvL+mqjOivgeS4iuS8oOi/lOWbnuaVsOaNrlxyXG4gICAgb25zdWNjZXNzPzogKGRhdGE6IGFueSwgY3VycmVudEVsZW1lbnQ6IEpRdWVyeSkgPT4gYm9vbGVhbiAsICAgICAvL+aIkOWKn+a3u+WKoOWbnuaOiVxyXG4gICAgZHluYW1pYz86IGJvb2xlYW4sIC8v5piv5ZCm5Yqo5oCB57uR5a6a5LiK5Lyg5pe26Ze0XHJcbiAgICBnZXRFbGVtZW50PzogKHRhZzogc3RyaW5nLCBjdXJyZW50RWxlbWVudDogSlF1ZXJ5KSA9PiBKUXVlcnksICAgLy/ojrflj5blrrnlmajnmoTmlrnms5VcclxuICAgIG9ucHJvZ3Jlc3M/OiAoZGF0YTogYW55KSA9PiB2b2lkLCAvLyDkuIrkvKDov5vluqZcclxuICAgIGFsbG93TXVsdGlwbGU/OiBib29sZWFuLCAgICAgLy8g5piv5ZCm5YWB6K645LiK5Lyg5LiA5qyh5aSa5LiqXHJcbn1cclxuXHJcbmNsYXNzIFVwbG9hZERlZmF1bHRPcHRpb24gaW1wbGVtZW50cyBVcGxvYWRPcHRpb24ge1xyXG4gICAgW3NldHRpbmc6IHN0cmluZ106IGFueTtcclxuICAgIG5hbWU6IHN0cmluZyA9ICdmaWxlJztcclxuICAgIGlzQXBwZW5kOiBib29sZWFuID0gdHJ1ZTtcclxuICAgIHRlbXBsYXRlOiBzdHJpbmcgPSAne3VybH0nO1xyXG4gICAgLy9ncmlkOiBzdHJpbmcgPSAnLnpkR3JpZCc7XHJcbiAgICByZW1vdmVUYWc6IHN0cmluZyA9ICcuZGVsZXRlJztcclxuICAgIHJlbW92ZUNhbGxiYWNrOiAoZXZlbnRPYmplY3Q6IEpRdWVyeUV2ZW50T2JqZWN0LCAuLi5ldmVudERhdGE6IGFueVtdKSA9PiBhbnkgPSBmdW5jdGlvbigpIHtcclxuICAgICAgICAkKHRoaXMpLnBhcmVudCgpLnJlbW92ZSgpO1xyXG4gICAgfTtcclxuICAgIG11bHRpcGxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBhbGxvd011bHRpcGxlOiBib29sZWFuID0gZmFsc2U7XHJcbiAgICBkYXRhOiBhbnkgPSB7fTtcclxuICAgIGZpbGVDbGFzczogc3RyaW5nID0gJ3pkVXBsb2FkRmlsZSc7XHJcbiAgICBmaWx0ZXI6IHN0cmluZyA9ICcnO1xyXG4gICAgb25hZnRlcjogKGRhdGE6IGFueSkgPT4gYW55ID0gZnVuY3Rpb24oZGF0YTogYW55KSB7XHJcbiAgICAgICAgLy8g6Ziy5q2iYWpheOiHquWKqOi9rOWMlmpzb25cclxuICAgICAgICBpZiAodHlwZW9mIGRhdGEgIT0gJ29iamVjdCcpIHtcclxuICAgICAgICAgICAgZGF0YSA9IEpTT04ucGFyc2UoZGF0YSk7XHJcbiAgICAgICAgfVxyXG4gICAgICAgIGlmIChkYXRhLmNvZGUgPT0gMCkge1xyXG4gICAgICAgICAgICByZXR1cm4gZGF0YS5kYXRhO1xyXG4gICAgICAgIH1cclxuICAgICAgICByZXR1cm4gZmFsc2U7XHJcbiAgICB9O1xyXG4gICAgZHluYW1pYzogYm9vbGVhbiA9IHRydWU7XHJcbiAgICBnZXRFbGVtZW50OiAodGFnOiBzdHJpbmcsIGN1cnJlbnRFbGVtZW50OiBKUXVlcnkpID0+IEpRdWVyeSA9IGZ1bmN0aW9uKHRhZzogc3RyaW5nKTogSlF1ZXJ5IHtcclxuICAgICAgICByZXR1cm4gJCh0YWcpO1xyXG4gICAgfTtcclxuICAgIC8vIG9uZGVhbGZpbGU6IChmaWxlOiBGaWxlKSA9PiBGb3JtRGF0YXwgdm9pZCA9IGZ1bmN0aW9uKGZpbGU6IEZpbGUpIHtcclxuICAgIC8vICAgICBpZihmaWxlLnNpemUvMTAyNCA+IDEwMjUpIHsgLy/lpKfkuo4xTe+8jOi/m+ihjOWOi+e8qeS4iuS8oFxyXG4gICAgLy8gICAgICAgICB0aGlzLnBob3RvQ29tcHJlc3MoZmlsZSwge1xyXG4gICAgLy8gICAgICAgICAgICAgcXVhbGl0eTogMC4yXHJcbiAgICAvLyAgICAgICAgIH0sIGZ1bmN0aW9uKGJhc2U2NENvZGVzKXtcclxuICAgIC8vICAgICAgICAgICAgIC8vY29uc29sZS5sb2coXCLljovnvKnlkI7vvJpcIiArIGJhc2UubGVuZ3RoIC8gMTAyNCArIFwiIFwiICsgYmFzZSk7XHJcbiAgICAvLyAgICAgICAgICAgICBsZXQgZGF0YSA9IG5ldyBGb3JtRGF0YSgpO1xyXG4gICAgLy8gICAgICAgICAgICAgbGV0IGJsID0gdGhpcy5jb252ZXJ0QmFzZTY0VXJsVG9CbG9iKGJhc2U2NENvZGVzKTtcclxuICAgIC8vICAgICAgICAgICAgIGRhdGEuYXBwZW5kKFwiZmlsZVwiLCBibCwgXCJmaWxlX1wiK25ldyBEYXRlKCkuZ2V0VGltZSgpK1wiLmpwZ1wiKTsgLy8g5paH5Lu25a+56LGhXHJcbiAgICAvLyAgICAgICAgICAgICB0aGlzLnVwbG9hZEZvcm0oZGF0YSk7XHJcbiAgICAvLyAgICAgICAgIH0pO1xyXG4gICAgLy8gICAgICAgICByZXR1cm47XHJcbiAgICAvLyAgICAgfVxyXG4gICAgLy8gfVxyXG59XHJcblxyXG5cclxuOyhmdW5jdGlvbigkOiBhbnkpIHtcclxuICAkLmZuLnVwbG9hZCA9IGZ1bmN0aW9uKG9wdGlvbiA/OiBVcGxvYWRPcHRpb24pIHtcclxuICAgIHJldHVybiBuZXcgVXBsb2FkKHRoaXMsIG9wdGlvbik7IFxyXG4gIH07XHJcbn0pKGpRdWVyeSk7Il19
