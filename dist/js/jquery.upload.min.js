var __extends=this&&this.__extends||function(){var n=function(t,e){return(n=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&(t[o]=e[o])})(t,e)};return function(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Class extends value "+String(e)+" is not a constructor or null");function o(){this.constructor=t}n(t,e),t.prototype=null===e?Object.create(e):(o.prototype=e.prototype,new o)}}(),__spreadArray=this&&this.__spreadArray||function(t,e){for(var o=0,n=e.length,i=t.length;o<n;o++,i++)t[i]=e[o];return t},Eve=function(){function t(){}return t.prototype.on=function(t,e){return this.options["on"+t]=e,this},t.prototype.hasEvent=function(t){return this.options.hasOwnProperty("on"+t)},t.prototype.trigger=function(t){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];var n="on"+t;if(this.hasEvent(t))return(n=this.options[n]).call.apply(n,__spreadArray([this],e))},t}(),Upload=function(n){function t(t,e){var o=n.call(this)||this;return o.element=t,o.options=$.extend({},new UploadDefaultOption,e),o.options.data=$.extend({},o.options.data,o.getData()),o.getElement=o.options.getElement.bind(o),o.element&&o.addEvent(),o}return __extends(t,n),t.prototype.addEvent=function(){var t=this;this.element.on("click",function(){t.start($(this))}),this.options.grid&&$(this.options.grid).on("click",this.options.removeTag,this.options.removeCallback)},t.prototype.start=function(t){this.currentElement=t;var e=this,o=$("."+this.options.fileClass);o.length<1?((t=document.createElement("input")).type="file",t.className=this.options.fileClass,t.multiple=this.options.multiple,t.accept=this.options.filter,document.body.appendChild(t),o=$(t).on("change",function(){e.uploadFiles(this.files)}).hide()):(o.val(""),o.attr("multiple",this.options.multiple?"true":"false"),o.attr("accept",this.options.filter),this.options.dynamic&&o.off("change").on("change",function(){e.uploadFiles(this.files)})),o.trigger("click")},t.prototype.uploadFiles=function(t){var o;this.options.allowMultiple?this.uploadMany(t):(o=this,$.each(t,function(t,e){o.uploadOne(e)}))},t.prototype.uploadMany=function(t){var o,n=this;this.options.ondealfile?o=this.options.ondealfiles.call(this,t):(o=new FormData,$.each(t,function(t,e){o.append(n.options.name,e)})),!1!==this.trigger("before",o,this.currentElement)?this.uploadForm(o,function(t){t instanceof Array?$.each(t,function(t,e){n.deal($.extend({},n.options.data,e))}):n.deal($.extend({},n.options.data,t))}):console.log("before upload is false")},t.prototype.uploadOne=function(t){var e,o=this,n=this.trigger("dealfile",t);!1!==n?(n?e=n:(e=new FormData).append(this.options.name,t),!1!==this.trigger("before",e,this.currentElement)?this.uploadForm(e,function(t){o.deal($.extend({},o.options.data,t))}):console.log("before upload is false")):console.log("deal file is false")},t.prototype.uploadForm=function(t,e){var o=this,t={url:this.options.url,type:"POST",data:t,cache:!1,contentType:!1,processData:!1,success:function(t){0!=(t=o.trigger("after",t,o.currentElement))?e&&e(t):console.log("after upload is false")}};this.options.timeout&&(t.timeout=this.options.timeout),o.options.onprogress&&(t.xhr=function(){var t=$.ajaxSetup({}).xhr();return o.options.onprogress&&t.upload&&t.upload.addEventListener("progress",o.options.onprogress,!1),t}),$.ajax(t)},t.prototype.formatFileSize=function(t){var e=["Byte","KB","MB","GB"];if(0==t)return"0 KB";var o=Math.floor(Math.log(t)/Math.log(1024));return 0==o?t+e[o]:(t/Math.pow(1024,o)).toFixed(1)+e[o]},t.prototype.sliceUpload=function(n,i){var a,r=1048576,s=this,l=n.size,p=Math.ceil(l/r),c=0,u=function(){var t=c*r,e=Math.min((c+1)*r,l),o=new FormData;o.append(s.options.name,n.slice(t,e)),a&&o.append("name",a),o.append("real_name",n.name),o.append("total",l+""),o.append("status",(c==p-1?2:0==c?0:1)+""),s.uploadForm(o,function(t){i&&i({total:l,size:e},s.currentElement),c!==p-1?(a=t.name,c++,u()):s.deal($.extend({},s.options.data,t))})};u()},t.prototype.photoCompress=function(t,e,o){var n=new FileReader,i=this;n.readAsDataURL(t),n.onload=function(){var t=this.result;i._canvasDataURL(t,e,o)}},t.prototype._canvasDataURL=function(t,s,l){var e=new Image;e.src=t,e.onload=function(){var t=(e=this.width)/(o=this.height),e=s.width||e,o=s.height||e/t,n=.7,i=document.createElement("canvas"),a=i.getContext("2d"),r=document.createAttribute("width");r.nodeValue=e+"";t=document.createAttribute("height");t.nodeValue=o+"",i.setAttributeNode(r),i.setAttributeNode(t),a.drawImage(this,0,0,e,o),s.quality&&s.quality<=1&&0<s.quality&&(n=s.quality);n=i.toDataURL("image/jpeg",n);l(n)}},t.prototype.convertBase64UrlToBlob=function(t){for(var e=t.split(","),t=e[0].match(/:(.*?);/)[1],o=atob(e[1]),n=o.length,i=new Uint8Array(n);n--;)i[n]=o.charCodeAt(n);return new Blob([i],{type:t})},t.prototype.deal=function(t){var o,n="function"==typeof this.options.template?this.options.template.call(this,t):this.replace(t);0!=n?!1!==this.trigger("success",t,this.currentElement)?(t=this.options.grid,(t=this.currentElement&&0<this.currentElement.length?this.currentElement.attr("data-grid")||this.options.grid:t)?(t=t.split("|"),o=this,t.forEach(function(t){t=o.getElement(t,o.currentElement);0!=t.length&&t.each(function(t,e){e=$(e);e.is("input")||e.is("textarea")?e.val(n):e.is("img")?e.attr("src",n):o.options.isAppend?e.append(n):e.prepend(n)})})):console.log("grid element is false")):console.log("success is false"):console.log("template is false")},t.prototype.getData=function(){if(!this.element||this.element.length<1)return{};var o={},t=this.element.attr("data-data");return t&&t.split(",").forEach(function(t){var e=t.split(":"),t=e[0].trim();t&&(o[t]=e[1].trim())}),o},t.prototype.replace=function(t){var e,o="function"==typeof this.options.template?this.options.template.call(this,t):this.options.template;for(e in t)t.hasOwnProperty(e)&&(o=o.replace(new RegExp("{"+e+"}","g"),t[e]));return o},t}(Eve),UploadDefaultOption=function(){this.name="file",this.isAppend=!0,this.template="{url}",this.removeTag=".delete",this.removeCallback=function(){$(this).parent().remove()},this.multiple=!1,this.allowMultiple=!1,this.data={},this.fileClass="zdUploadFile",this.filter="",this.onafter=function(t){return 0==(t="object"!=typeof t?JSON.parse(t):t).code&&t.data},this.dynamic=!0,this.getElement=function(t){return $(t)}};jQuery.fn.upload=function(t){return new Upload(this,t)};